function IndexCtrl(t,e,i,o,n,a,s,r,l,c){function u(n){i.get("/api/lists/"+d+"/"+t.p+h).then(function(i){n?(e.ad_counter=0,t.posts=[],addPostsToScope(i.data.posts,t,e.show_featured_banner,t.show_native)):addPostsToScope(i.data.posts,t,e.show_featured_banner,t.show_native),r.setHrefLang(o.current.canonical_path),addPagingMeta(i.data.posts,t.defaultPage,p,r),t.paginationMessage=i.data.meta.summary,t.ready=!0},function(t){console.log(t),r.setStatusCode(404),r.setCanonical("/404")})}r.init(),e.Page=r,e.show_banner=!0,e.show_featured_banner=!0,e.large_container=!0,t.p=o.current.params.page?parseInt(o.current.params.page):1,t.defaultPage=o.current.params.page?parseInt(o.current.params.page):1,t.loadingInfinite=!1;var d=o.current.default_sort;t.sort=d,t.page="homepage";var p=o.current.international_canonical_path;if(p||(p=o.current.canonical_path),n.search().s)return void n.url("/search/"+n.search().s);n.search().purgetool&&(e.show_purge_tool=!0,e.purge_tool_urls=["/api/lists/new/","/api/lists/clicks_score_amazon_available/","/api/lists/clicks_score_amazon_available/{x}/?max=20&min=0","/api/lists/clicks_score_amazon_available/{x}/?max=20"]),"new"!=d&&(e.show_featured_banner=!1),"clicks_score_month"!=d&&"clicks_score_week"!=d||(t.hide_ssna=!0),t.country=$("body").attr("data-country");var h="";"US"!=t.country&&(h="?country="+t.country),o.current.country&&(h="?country="+o.current.country,t.country=o.current.country),t.show_native=!0,t.show_hide_nsfw=!1,t.handle_nsfw_preference=function(){1==a.get("nsfw")?t.nsfw=!0:t.nsfw=!1},t.handle_nsfw_preference(),t.$watch("nsfw",function(e,i){a.put("nsfw",t.nsfw?1:0)}),"clicks_score_amazon_available"!=d&&"random"!=d||(t.show_native=!1,t.show_hide_nsfw=!0,t.handle_nsfw_preference()),t.show_editorial=!1,t.show_banner&&(t.show_editorial=!0),t.native_ads_container=[],console.log("SORT: "+d),e.country=t.country,e.finished_loading_feature=!1,i.get("/api/lists/featured").then(function(i){console.log(i.data),i.data&&i.data.feature&&i.data.feature[0]&&(t.featured_post=i.data.feature[0],e.featured_post=t.featured_post,t.featured_post.link.includes("giveaway")&&t.load_editorial_giveaway(),e.featured_post.link=e.featured_post.link.split("?")[0],e.featured_post.utm_campaign?e.featured_post.link+="?utm_source=thisiswhyimbroke.com&utm_medium=referral&utm_campaign="+e.featured_post.utm_campaign+"&utm_content=top":e.featured_post.link+="?utm_source=thisiswhyimbroke.com&utm_medium=referral&utm_campaign=feature&utm_content=top"),e.finished_loading_feature=!0,t.p=1,u(!1)},function(t){}),t.load_editorial_giveaway=function(){var o=e.featured_post.link.match("/giveaway(.*)");if(o){var n=o[1].replace("/","");i.get("/api/giveaway/"+n).then(function(t){e.featured_post.giveaway_data=t.data.giveaway},function(e){t.error="Giveaway could not be found."})}},i.get("/api/user/native_ad/").then(function(e){t.native_ads=e.data.ads},function(t){}),e.finished_loading_banner=!1,i.get("/api/banner/").then(function(i){!i.data.banner.uk_link||"uk"!=e.country.toLowerCase()&&"gb"!=e.country.toLowerCase()?i.data.banner.ca_link&&"ca"==e.country.toLowerCase()&&(i.data.banner.link=i.data.banner.ca_link):i.data.banner.link=i.data.banner.uk_link,e.banner=i.data.banner,t.banner=i.data.banner,e.finished_loading_banner=!0,window.apply_subtags_simple(t.banner)},function(t){}),t.nextPage=function(){return t.disable_infinite_scroll?void(t.infinite_finished=!0):void(t.loadingInfinite||(console.log("Loading infintie page "+t.p),t.p+=1,i.get("/api/lists/"+d+"/"+t.p+h).success(function(i,o,n,a){addPostsToScope(i.posts,t,e.show_featured_banner,t.show_native),t.loadingInfinite=!1,i.posts&&i.posts.length<1&&(t.infinite_finished=!0)}),t.loadingInfinite=!0))},t.$watch("first_time_viewer",function(i,n){1==i&&"/"==o.current.canonical_path&&(t.posts=[],d="clicks_score_amazon_available",t.sort="clicks_score_amazon_available",t.p=1,e.show_featured_banner=!1,u(!0),"clicks_score_amazon_available"==d&&(t.show_native=!1,t.show_hide_nsfw=!0,t.handle_nsfw_preference()))}),t.$watch("dynamicSort",function(e,i){console.log("Dynamic sort change was detected"),t.dynamicSort&&(t.posts=[],d=t.dynamicSort,t.sort=t.dynamicSort,t.p=1,t.show_native=!0,t.native_ads_container=[],t.native_ad_count=0,u(!0))}),r.setTitle("ThisIsWhyImBroke :: The Internet's Mall"),r.setMetaDescription("ThisIsWhyImBroke is where you'll find cool and unique gift ideas. You'll never give a boring gift again with our never ending list of amazing products."),r.setIndex(),t.renderHtml=function(t){return c.trustAsHtml(t)},t.track_impressions=!0}function GiftsCtrl(t,e,i,o,n,a,s,r,l){function c(){i.get("/api/gifts/"+d+"/"+g+"/"+t.p+"/?"+f).then(function(e){var i=e.data;addPostsToScope(i.posts,t,!1,!1,!1,5),t.category=i.category;var o=a.current.params.parent_list;if(i.category&&!o&&(o=i.category.slug),i.category&&i.category.parent_slug&&(o=i.category.parent_slug),t.parent_slug=o,"all"==d){r.setTitle("Gifts | ThisIsWhyImBroke.com");var n="/gifts/";r.setMetaDescription("ThisIsWhyImBroke is where you'll find cool and unique gift ideas. You'll never give a boring gift again with our never ending list of amazing products."),m=n}else{r.setTitle(t.category.name+" | ThisIsWhyImBroke.com"),t.category.description?r.setMetaDescription(t.category.description):r.setMetaDescription("ThisIsWhyImBroke is where you'll find cool and unique gift ideas. You'll never give a boring gift again with our never ending list of amazing products.");var n="/"+a.current.params.list+"/";i.category.parent_slug&&i.category.slug!=i.category.parent_slug&&(n="/"+i.category.parent_slug+n),n="/gifts"+n,m=n}a.current.params.country&&(m="/"+a.current.params.country+n),r.setHrefLang(n),console.log(n),addPagingMeta(e.data.posts,t.defaultPage,m,r),t.paginationMessage=e.data.meta.summary,t.ready=!0},function(t){r.setStatusCode(404),r.setCanonical("/404")})}function u(e,o,n,a){n&&(t.p=1,p=n,h=o?o:0,i.get("/api/gifts/"+d+"/"+g+"/"+t.p+"/?max="+p+"&min="+h+f).success(function(e,i,o,n){t.posts=[],addPostsToScope(e.posts,t)}))}r.init(),t.p=a.current.params.page?parseInt(a.current.params.page):1,t.defaultPage=a.current.params.page?parseInt(a.current.params.page):1,t.loadingInfinite=!1,t.prime_message_enabled=!1;var d=a.current.params.list,p=150,h=0,g=a.current.default_sort;t.country=$("body").attr("data-country");var f="";"US"!=t.country&&(f="&country="+t.country),a.current.params.country&&(f="&country="+a.current.params.country,t.country=a.current.params.country),d||(d="all"),e.country=t.country,a.current.params.sort&&(g=a.current.params.sort),g||(g="new"),t.sort=g,t.sorting=!0;var m;t.changeSort=function(e){"US"!=t.country.toUpperCase()?o.url("/"+t.country.toLowerCase()+"/gifts/"+d+"/sort/"+e+"/"):o.url("/gifts/"+d+"/sort/"+e+"/")},t.handle_nsfw_preference=function(){1==n.get("nsfw")?t.nsfw=!0:t.nsfw=!1},t.handle_nsfw_preference(),t.$watch("dynamicSort",function(e,i){console.log("Dynamic sort change was detected"),t.dynamicSort&&(console.log("Dynamic sort change was not empty"),t.sort=t.dynamicSort,g=t.sort,t.posts=[],t.p=0,t.nextPage(!0))}),i.get("/api/lists/featured").then(function(i){i.data&&i.data.feature&&i.data.feature[0]&&(t.featured_post=i.data.feature[0],e.featured_post=t.featured_post,t.featured_post.link.includes("giveaway")&&t.load_editorial_giveaway(),e.featured_post.link=e.featured_post.link.replace("&utm_medium=referral","&utm_medium=referral&utm_campaign=feature")),e.finished_loading_feature=!0,t.p=1,c(!1)},function(t){}),t.load_editorial_giveaway=function(){var o=e.featured_post.link.match("/giveaway(.*)");if(o){var n=o[1].replace("/","");i.get("/api/giveaway/"+n).then(function(t){e.featured_post.giveaway_data=t.data.giveaway},function(e){t.error="Giveaway could not be found."})}},t.nextPage=function(e){if(t.disable_infinite_scroll)return void(t.infinite_finished=!0);t.p+=1;var o="/api/gifts/"+d+"/"+g+"/"+t.p+"/?max="+p+"&min="+h+f;i.get(o).success(function(i,o,n,a){e&&(t.posts=[]),addPostsToScope(i.posts,t,!1,!1,!1,5),i.posts.length<1&&(t.infinite_finished=!0)})},t.slider={value:p,min:h,options:{floor:20,ceil:150,step:10,translate:function(t,e,i){return"ceil"!==i&&t<149?"$"+t:"Max"},onChange:u}},r.setIndex(),t.renderHtml=function(t){return l.trustAsHtml(t)},t.renderDescHtml=function(t){return t&&t.length>110&&(t=t.substr(0,107),t+="..."),l.trustAsHtml(t)},t.track_impressions=!0}function PriceCtrl(t,e,i,o,n,a,s,r,l){function c(e,o,n,a){n&&(t.p=1,d=n,p=o,i.get("/api/lists/"+u+"/"+t.p+"/?max="+d+"&min="+p+h).success(function(e,i,o,n){t.posts=[],addPostsToScope(e.posts,t)}))}r.init(),e.Page=r,e.show_banner=!0,e.large_container=!0,t.p=n.current.params.page?parseInt(n.current.params.page):1,t.defaultPage=n.current.params.page?parseInt(n.current.params.page):1,t.loadingInfinite=!1;var u=n.current.default_sort;n.current.params.sort&&(u=n.current.params.sort),t.sort=u,t.sorting=!0,t.page="price-range";var d=20,p=0;n.current.params.to&&(d=n.current.params.to),n.current.params.from&&(p=n.current.params.from),t.min_price=p,console.log(n.current.params.from),t.country=$("body").attr("data-country");var h="";"US"!=t.country&&(h="&country="+t.country),n.current.params.country&&(h="&country="+n.current.params.country,t.country=n.current.params.country);var g=n.current.canonical_path;n.current.params.country&&(g="/"+n.current.params.country+n.current.canonical_path),e.country=t.country,t.show_native=!0,t.show_hide_nsfw=!0,t.handle_nsfw_preference=function(){1==a.get("nsfw")?t.nsfw=!0:t.nsfw=!1},t.handle_nsfw_preference(),t.$watch("nsfw",function(e,i){a.put("nsfw",t.nsfw?1:0)}),e.finished_loading_feature=!1,i.get("/api/lists/featured").then(function(o){console.log(o.data),o.data&&o.data.feature&&o.data.feature[0]&&(t.featured_post=o.data.feature[0],e.featured_post=t.featured_post,e.featured_post.link=e.featured_post.link.replace("&utm_medium=referral","&utm_medium=referral&utm_campaign=feature")),e.finished_loading_feature=!0,i.get("/api/lists/"+u+"/"+t.p+"/?max="+d+h).success(function(e,i,o,a){addPostsToScope(e.posts,t,!0),r.setTitle("Gifts Under $"+d+" | ThisIsWhyImBroke.com"),r.setMetaDescription("ThisIsWhyImBroke is where you'll find cool and unique gift ideas. You'll never give a boring gift again with our never ending list of amazing products."),r.setHrefLang(n.current.canonical_path),addPagingMeta(e.posts,t.defaultPage,g,r),t.paginationMessage=e.meta.summary,t.ready=!0})},function(t){}),t.nextPage=function(){if(t.disable_infinite_scroll)return void(t.infinite_finished=!0);if(!t.loadingInfinite){t.p+=1;var e="/api/lists/"+u+"/"+t.p+"/?max="+d+"&min="+p+h;i.get(e).success(function(e,i,o,n){addPostsToScope(e.posts,t,!0),t.loadingInfinite=!1}),t.loadingInfinite=!0}},t.changeSort=function(t){o.url(g+t)},t.slider={value:d,options:{floor:0,ceil:150,step:10,translate:function(t,e,i){return"ceil"!==i&&t<149?"$"+t:"Max"},onChange:c}},t.$watch("dynamicSort",function(e,i){t.dynamicSort&&(t.changeSort(t.dynamicSort),t.posts=[])}),r.setIndex(),t.renderHtml=function(t){return l.trustAsHtml(t)},i.get("/api/banner/").then(function(i){!i.data.banner.uk_link||"uk"!=e.country.toLowerCase()&&"gb"!=e.country.toLowerCase()?i.data.banner.ca_link&&"ca"==e.country.toLowerCase()&&(i.data.banner.link=i.data.banner.ca_link):i.data.banner.link=i.data.banner.uk_link,e.banner=i.data.banner,t.banner=i.data.banner,e.finished_loading_banner=!0,window.apply_subtags_simple(t.banner)},function(t){}),t.renderHtml=function(t){return l.trustAsHtml(t)},t.track_impressions=!0}function PostCtrl(t,e,i,o,n,a,s,r,l,c){function u(e){i.get("/api/related/"+e+"/1/?items=100"+g).then(function(e){return 1==window.no_related?(f=!0,void t.nextPage()):(addPostsToScope(e.data.posts,t,!1,!1,!0,4),f=!0,void t.nextPage())},function(t){console.log(t)})}l.init(),l.setPostFooter();var d,p=n.current.params.slug,h=!1;t.url=o.absUrl(),t.country=$("body").attr("data-country");var g="";"US"!=t.country&&(g="&country="+t.country),n.current.country&&(g="&country="+n.current.country,t.country=n.current.country),"y"==o.search().scroll&&(t.hide_extra_images=!0),e.country=t.country,t.handle_nsfw_preference=function(){1==a.get("nsfw")?t.nsfw=!0:t.nsfw=!1},t.handle_nsfw_preference(),i.get("/api/posts/"+p+"/?size=large"+g).then(function(e){function i(){t.post.subtagged?window.location.href=a.link:(console.log("Waiting for subtag"),c(function(){i()},200))}var a=e.data.post;"US"!=t.country&&a.link.indexOf("amazon")>=0&&!(a.link.indexOf("georiot")>=0)&&("GB"==t.country.toUpperCase()||"UK"==t.country.toUpperCase()?a.link="https://www.amazon.co.uk/s/?field-keywords="+a.title+"&tag=097-uk-21":"CA"==t.country.toUpperCase()&&(a.link="https://www.amazon.ca/s/?field-keywords="+a.title+"&tag=097-ca-20")),t.post=a,d=a.id,c(function(){u(a.id)},500);var s="/"+a.slug+"/";n.current.country&&(s="/"+n.current.country+s),l.setTitle(a.title),l.setCanonical(s),l.setHrefLang("/"+a.slug+"/"),l.setOpenGraph({title:a.title,url:o.absUrl(),description:a.content,image:a.images[0].src,type:"article",imageWidth:a.images[0].width,imageHeight:a.images[0].height}),l.setMetaDescription(t.post.content),l.setMetaKeywords(t.post.title),l.setIndex(),t.post.fuzzy_match&&(l.setRedirect("/"+a.slug+"/"),l.setStatusCode(301)),t.ready=!0,"y"==o.search().r&&i()},function(t){l.setStatusCode(404),l.setCanonical("/404"),h=!0});var f=!1;i.get("/api/lists/featured").then(function(i){i.data&&i.data.feature&&i.data.feature[0]&&(t.featured_post=i.data.feature[0],e.featured_post=t.featured_post,t.featured_post.link.includes("giveaway")&&t.load_editorial_giveaway(),e.featured_post.link=e.featured_post.link.replace("&utm_medium=referral","&utm_medium=referral&utm_campaign=feature")),e.finished_loading_feature=!0,t.p=1},function(t){}),t.load_editorial_giveaway=function(){var o=e.featured_post.link.match("/giveaway(.*)");if(o){var n=o[1].replace("/","");i.get("/api/giveaway/"+n).then(function(t){e.featured_post.giveaway_data=t.data.giveaway},function(e){t.error="Giveaway could not be found."})}},t.renderHtml=function(t){return r.trustAsHtml(t)};var m=1;t.infinite_finished=!1,t.related_items=[],t.sort="related_items_clicks_score_amazon_available";var v=!1;t.nextPage=function(){function e(){t.post||h?o():(console.log("Waiting for post"),c(function(){e()},200))}function o(){v=!0;var e="/api/lists/clicks_score_amazon_available/";window.relatedInfinite&&(e=window.relatedInfinite);var o=e+m+"/?country="+t.country;i.get(o).success(function(e,i,o,n){if(v=!1,e.posts.length<1&&(t.infinite_finished=!0),t.posts&&t.posts instanceof Array)for(var a=0;a<e.posts.length;a++)t.posts.push(e.posts[a]);else t.posts=e.posts}),m+=1}if(t.disable_infinite_scroll)return void(t.infinite_finished=!0);if(!v&&f){if(t.infinite_finished||h)return void console.log("Finished infinite scrolling");e(),window.next_page=o}}}function WishlistCtrl(t,e,i,o,n,a,s,r){r.init();var l=n.current.params.user_id,c=1,u=$("body").attr("data-country"),d="";"US"!=u&&(d="&country="+u),t.url=o.absUrl(),t.$watch("auth_finished",function(n){return!l&&e.is_logged_in?void o.path("/wishlist/"+e.user_id).replace():(l==e.user_id?(r.setTitle("My Wish List"),t.title="My Wish List",t.own_wishlist=!0,t.wishlist_username=e.username):i.get("/api/user/info/"+l).success(function(e,i,o,n){r.setTitle(e.username+"'s Wish List"),t.title=e.username+"'s Wish List",t.wishlist_username=e.username}),r.setMetaDescription("View my wishlist from ThisIsWhyImBroke and enjoy going broke while buying all of these amazing gifts for me!"),void(t.ready=!0))}),t.infinite_finished=!1,i.get("/api/user/wishlist/"+l+"/"+c+"/?now="+(new Date).getTime()+d).success(function(e,i,o,n){addPostsToScope(e.posts,t)}),t.nextPage=function(){t.infinite_finished||(c+=1,i.get("/api/user/wishlist/"+l+"/"+c+"/?now="+(new Date).getTime()+d).success(function(e,i,o,n){e.posts.length<1&&(console.log("Scrolling finished"),t.infinite_finished=!0),addPostsToScope(e.posts,t,!1,!1,!0)}))},r.setOpenGraph({title:"My Wishlist On ThisIsWhyImBroke",url:o.absUrl(),description:"This is my collection of my favorite products that I want. Have a look and buy me something!",image:o.protocol()+"://"+o.host()+"/assets/images/fb-thumbnail.jpg",type:"article",imageWidth:560,imageHeight:341}),r.setIndex(),t.renderHtml=function(t){return $sce.trustAsHtml(t)}}function ModifyWishlistCtrl(t,e,i,o,n,a,s,r,l,c){t.flash=r,t.removeWishlist=function(i){return o.is_logged_in?(console.log("Removing item "+i.id),i.saved=!1,o.wishlist_count-=1,void e({method:"POST",url:"/api/user/wishlist/remove",data:{post_id:i.id}}).success(function(t){})):void t.loginRegisterModal(!0,"Register to save "+i.title+" to your wishlist",i)},t.addWishlist=function(i){return console.log("Add wishlist called"),o.is_logged_in?(i.saved=!0,o.wishlist_count+=1,void e({method:"POST",url:"/api/user/wishlist/add",data:{post_id:i.id}}).success(function(t){})):void t.loginRegisterModal(!0,"Login or Register to save "+i.title+" to your wishlist",i)},t.loginRegisterModal=function(e,i,n){console.log("Scope.signup() called"),c.showModal({templateUrl:"partials/login-register-modal",controller:"LoginRegisterModalCtrl",inputs:{message:i,login:e}}).then(function(i){i.element.modal(),e?s(function(){$("#loginEmail").focus()},500):s(function(){$("#registerEmail").focus()},500),i.close.then(function(e){$(".modal-backdrop").remove(),n&&s(function(){o.is_logged_in&&t.addWishlist(n)},500)})})}}function GiveawayEntryCtrl(t,e,i,o,n,a,s,r,l,c){t.flash=r,t.openModal=function(t,e,i,o){c.showModal({templateUrl:"partials/giveaway-modal",controller:"GiveawayEntryModalCtrl",inputs:{message:e,giveaway_url:t,email:o}}).then(function(t){t.element.modal(),t.close.then(function(t){$(".modal-backdrop").remove()})})}}function GiveawayEntryModalCtrl(t,e,i,o,n,a,s,r,l,c,u,d,p){var h=p.match("/giveaway(.*)");if(h){var g=h[1].replace("/","");e.get("/api/giveaway/"+g).then(function(e){t.giveaway=e.data.giveaway},function(e){t.error="Giveaway could not be found."}),t.close=function(t){console.log("close"),u(t,0)},t.renderHtml=function(t){return c.trustAsHtml(t)}}}function NewsletterCTACtrl(t,e,i,o,n,a,s,r){t.subscribe_newsletter=function(e){console.log(e);var i=s.subscribe(e);i.then(function(t){o.newsletter_signup_success=!0;var e=new Date,i=new Date(e.getFullYear()+10,e.getMonth(),e.getDate());r.put("hide_newsletter_cta","true",{expires:i})},function(e){t.error="We could not subscribe you :( please make sure you don't already have an account"})},t.close=function(e){t.turn_off_newsletter_cta()},t.turn_off_newsletter_cta=function(){var t=new Date,e=new Date(t.getFullYear()+10,t.getMonth(),t.getDate());r.put("hide_newsletter_cta","true",{expires:e}),o.hide_newsletter_cta=!0}}function ConfirmSubscriptionCtrl(t,e,i,o,n,a,s,r,l,c){c.init(),t.ready=!1,o.show_banner=!1;var u=n.current.params.code;console.log(u),e({method:"POST",url:"/api/user/confirm_subscribe",data:{code:u}}).success(function(e){t.ready=!0})}function ModifyAdWishlistCtrl(t,e,i,o,n,a,s,r,l,c){t.flash=r,t.removeWishlist=function(i){return o.is_logged_in?(console.log("Removing item "+i.id),i.saved=!1,o.wishlist_count-=1,void e({method:"POST",url:"/api/user/native_ad/remove",data:{ad_id:i.id}}).success(function(t){})):void t.loginRegisterModal(!0,"Register to save "+i.title+" to your wishlist",i)},t.addWishlist=function(i){return console.log("Add wishlist called"),o.is_logged_in?(i.saved=!0,o.wishlist_count+=1,void e({method:"POST",url:"/api/user/native_ad/add",data:{ad_id:i.id}}).success(function(t){})):void t.loginRegisterModal(!0,"Login or Register to save "+i.title+" to your wishlist",i)},t.loginRegisterModal=function(e,i,n){console.log("Scope.signup() called"),c.showModal({templateUrl:"partials/login-register-modal",controller:"LoginRegisterModalCtrl",inputs:{message:i,login:e}}).then(function(i){i.element.modal(),e?s(function(){$("#loginEmail").focus()},500):s(function(){$("#registerEmail").focus()},500),i.close.then(function(e){$(".modal-backdrop").remove(),n&&s(function(){o.is_logged_in&&t.addWishlist(n)},500)})})}}function LoginRegisterModalCtrl(t,e,i,o,n,a,s,r,l,c,u){t.message=c,t.login=u,t.country=$("body").attr("data-country");var d=["AD","AL","AT","AX","BA","BE","BG","BY","CH","CZ","DE","DK","EE","ES","FI","FO","FR","GB","UK","GG","GI","GR","HR","HU","IE","IM","IS","IT","JE","LI","LT","LU","LV","MC","MD","ME","MK","MT","NL","NO","PL","PT","RO","RS","RU","SE","SI","SJ","SK","SM","UA","VA"];d.indexOf(t.country)>-1&&(t.display_newsletter_choice=!0),t.register_submit=function(){var e=s.register(t.registerData);e.then(function(e){console.log(t.registerData);var i=s.logIn(t.registerData);i.then(function(t){$(".modal-register-post").css("display","block"),$(".modal-register").css("display","none"),s.isLoggedIn()},function(e){t.error=e})},function(e){t.error=e})},t.login_submit=function(){console.log(t.loginData);var e=s.logIn(t.loginData);e.then(function(e){r.remove("session_id"),r.remove("user_id"),s.isLoggedIn(),t.message="Success",t.error=void 0,t.close()},function(e){t.error="Your username or password was incorrect."})},t.close=function(t){console.log("close"),l(t,0)},t.switchToLogin=function(){$("#loginEmail").focus(),t.login=!0},t.switchToRegister=function(){$("#registerEmail").focus(),t.login=!1}}function PurchaseNotificationCtrl(t,e,i,o,n,a,s,r,l,c){t.closePurchaseNotifications=function(){console.log("Disabled purchase notifications"),l.put("disable_purchase_notification",!0),$("#purchase-notification").addClass("fade"),c.cancel(window.purchase_notification_timer);try{window.optimizely.push(["trackEvent","purchasenotification_close"])}catch(t){console.log(t.message)}}}function SearchCtrl(t,e,i,o,n,a,s,r,l,c){function u(i){d=i,p=1,e.get("/api/search/"+d+"/"+p+g).success(function(e,i,o,n){addPostsToScope(e.posts,t),e.posts.length<1&&(t.message="No results found. :("),l.setTitle("Search: "+d),l.setCanonical("/search/"+d),t.ready=!0})}l.init();var d=n.current?n.current.params.search_term:"",p=1;t.infinite_finished=!1,"redirect"==d&&r.s&&i.url("/search/"+r.s);var h=$("body").attr("data-country"),g="?country="+h;r.lookup&&(g+="&lookup=true"),u(d),t.nextPage=function(){t.infinite_finished||(p+=1,e.get("/api/search/"+d+"/"+p+"/"+g).success(function(e,i,o,n){addPostsToScope(e.posts,t),e.posts.length<1&&(t.infinite_finished=!0)}))},l.setIndex(),t.renderHtml=function(t){return c.trustAsHtml(t)}}function SearchPartialCtrl(t,e,i,o,n,a,s,r){function l(t){console.log(i),i.dev&&o.url("/search/"+t+"?dev=yes"),i.lookup?o.url("/search/"+t+"?lookup=yes"):o.url("/search/"+t)}t.search=l}function RegisterCtrl(t,e,i,o,n,a,s,r){r.init(),t.submit=function(){var e=s.register(t.registerData);e.then(function(e){var i=s.logIn(t.registerData);i.then(function(t){s.isLoggedIn(),a.history.back()},function(e){t.error=e})},function(e){t.error=e})},r.setTitle("Register"),r.setIndex(),t.ready=!0}function LogInCtrl(t,e,i,o,n,a,s,r,l,c){c.init(),t.flash=l,t.submit=function(){var e=r.logIn(t.loginData);e.then(function(e){a.remove("session_id"),a.remove("session_id_v2"),a.remove("subtag_session_v2"),a.remove("user_id"),r.isLoggedIn(),t.message="Success",t.error=void 0,window.referrer_url&&window.referrer_url.indexOf("/forgot")!==-1&&window.referrer_url.indexOf("/reset")!==-1?s.history.back():o.url("/")},function(e){t.error="Your username or password was incorrect."})},c.setTitle("Log In"),c.setIndex(),t.ready=!0}function LogOutCtrl(t,e,i,o,n,a,s,r,l){i.get("/api/user/logout/?now="+(new Date).getTime()).success(function(t,e,i,o){a.remove("session_id"),a.remove("session_id_v2"),a.remove("subtag_session_v2"),a.remove("user_id"),r.isLoggedIn(),s.history.back()}),l.setNoIndex(),t.ready=!0}function ProfileCtrl(t,e,i,o,n,a,s,r,l,c){l.init(),t.flash=c,t.changeData={},t.$watch("auth_finished",function(i){if(i&&!e.is_logged_in&&(c.setMessage("Please register or log into your account first"),o.url("/")),i&&e.is_logged_in&&(t.show_form=!0,t.changeData.email=e.email,e.dob)){t.changeData.dob=e.dob,t.changeData.dob=new Date(t.changeData.dob);var n=new Date;t.changeData.dob.setHours(0,n.getTimezoneOffset()+120,0,0)}}),t.submit=function(){t.show_form=!1,t.changeData.dob&&(console.log(t.changeData.dob),t.changeData.dob.setHours(0,(new Date).getTimezoneOffset()+120,0,0),t.changeData.dob=s("date")(t.changeData.dob,"yyyy-MM-dd"),console.log(t.changeData.dob)),console.log("Submitted..."),console.log(t.changeData.dob),i({method:"POST",url:"/api/user/profile",data:$.param(t.changeData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?t.error=e.data.meta.error:(t.message="Your details were updated successfully",r.isLoggedIn())},function(e){t.error="Your details could not be updated"})},t.deletion=function(){t.show_form=!1,t.message="We are processing your deletion request and will notify you by email when it is completed. ",i({method:"POST",url:"/api/user/delete",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status&&(t.error=e.data.meta.error)},function(e){t.error="Your details could not be updated"})},l.setTitle("My Profile"),l.setIndex(),t.ready=!0}function ForgotCtrl(t,e,i,o,n,a,s,r,l){r.init(),t.flash=l,t.submit=function(){i({method:"POST",url:"/api/user/forgot",data:$.param(t.resetData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?t.error=e.data.meta.error:t.message=e.data.meta.message},function(e){t.error="We could not find a user with that email"})},r.setTitle("Forgot My Password"),r.setIndex(),t.ready=!0}function ResetCtrl(t,e,i,o,n,a,s,r,l){r.init();var c=n.current.params.reset_code;t.submit=function(){i({method:"POST",url:"/api/user/reset",data:$.param({password:t.resetData.password,reset_code:c}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?t.error=e.data.meta.error:t.message=e.data.meta.message},function(e){t.error="Your password could not be changed."})},r.setTitle("Reset My Password"),r.setIndex(),t.ready=!0}function BlogCtrl(t,e,i,o,n,a,s,r,l){i.get("/api/blog/").success(function(e,i,o,n){t.blogPosts=e.posts})}function BlogPostCtrl(t,e,i,o,n,a,s,r,l,c){var u=n.current.params.slug;r.init(),i.get("/api/blog/"+u).success(function(e,i,n,a){t.blogPost=e.post,t.posts=e.post.posts,t.url=o.protocol()+"://"+o.host()+"/blog/"+e.post.slug;var s=t.blogPost.src?t.blogPost.src:t.blogPost.image,l=380,c=640;s&&s.indexOf("640x533")!==-1&&(l=533),r.setOpenGraph({title:t.blogPost.title,url:o.absUrl(),description:t.blogPost.content,image:s,type:"article",imageWidth:c,imageHeight:l})}),i.get("/api/blog/").success(function(e,i,o,n){t.blogPosts=e.posts}),t.renderHtml=function(t){return c.trustAsHtml(t)}}function GiveawayListCtrl(t,e,i,o,n,a,s,r,l,c){r.init(),r.setTitle("Giveaways"),t.ready=!0;var u=n.current.params.page?n.current.params.page:1;t.page=parseInt(u),i.get("/api/giveaways/"+u).then(function(e){t.posts=e.data.giveaways,(!t.posts||t.posts.length<1)&&(t.error="There are no more"),t.posts.length<5&&(t.no_next_page=!0),console.log(t.giveaways)},function(t){r.setStatusCode(404),r.setCanonical("/404"),error=!0}),t.renderHtml=function(t){return c.trustAsHtml(t)}}function GiveawayCtrl(t,e,i,o,n,a,s,r,l,c){r.init();var u=n.current.params.slug;t.url=o.absUrl(),i.get("/api/giveaway/"+u).then(function(e){t.giveaway=e.data.giveaway,r.setTitle(t.giveaway.title+" Giveaway"),r.setOpenGraph({title:t.giveaway.title,url:o.absUrl(),description:t.giveaway.content,image:t.giveaway.image,type:"article",imageWidth:300,imageHeight:250})},function(t){r.setStatusCode(404),r.setCanonical("/404"),error=!0}),t.renderHtml=function(t){return c.trustAsHtml(t)},t.$watch("auth_finished",function(i){i&&!e.is_logged_in?t.show_widget=!1:t.show_widget=!0}),t.$watch("is_logged_in",function(i){e.is_logged_in?t.show_widget=!0:t.show_widget=!1}),t.ready=!0}function SimpleCtrl(t,e,i,o,n,a,s,r){r.init(),t.location=o,r.setIndex(),t.ready=!0}function ErrorCtrl(t,e,i,o,n,a,s,r){r.init(),r.setNoIndex(),r.setCanonical("/404"),r.setStatusCode("404"),t.ready=!0}function UnitedAirlinesCtrl(t,e,i,o,n,a,s,r){r.init(),r.setCanonical("/88-4"),t.ready=!0}function Advertising(t,e,i,o,n,a,s,r,l,c,u,d,p){d.init(),d.setCanonical("/ssna"),e.hide_support_button=!0,s.scrollTo(0,0),t.plans=[{name:"Basic $149",id:1,value:"Basic $149"},{name:"Premium $299",id:2,value:"Premium $299"},{name:"Platinum $999",id:3,value:"Platinum $999"}],t.testimonials=[{name:"Kimberly Corkum",image:"image3.jpg",company:"BurgaBox",link:"https://www.burgabox.com",testimonial:"ThisIsWhyImBroke not only significantly increased our website traffic, but also opened up the floodgates to amazing opportunities with interested investors, new customers, and other media placements. The overall burst of energy that TIWIB brought to BurgaBox was a sonic boom for our young company."},{name:"John Kyle",image:"image1.jpg",company:"Grow The Fuck Up Book",link:"https://www.amazon.com/dp/1511720247/?tag=097-20",testimonial:"TIWIB helped my book become a #1 Best Seller on Amazon within a matter of hours. The revenue generated from visibility on the site was absolutely overwhelming."},{name:"Jeffrey Simon",image:"image5.jpg",company:"Dropstop",link:"https://www.buydropstop.com/",testimonial:"This Is Why I'm Broke helped Drop Stop get noticed in a big way. The hits to our website and Amazon listing as well as accompanying sales were amazing! And whatâ€™s even more amazing, it kept on going for YEARS after the original post. Folks still tell us that's where they discovered our invention."},{name:"Tyler Ward",image:"image6.jpg",company:"PrankCandles",link:"http://www.PrankCandles.com",testimonial:"TIWIB drove 5 figures of sales and substantial traffic for over the year after it posted. It was the gift that kept giving because we ended up being highly rated on one of their categories so the sales continued for us for way longer than what we expected."},{name:"Isaac Lavi",image:"image4.jpg",company:"The Right Cup",link:"http://www.therightcup.com/",testimonial:"As a young company with a unique product, ThisIsWhyImBroke is where you wanna be. It is a great platform to help creators of cool, innovative and interesting products."},{name:"Karol Krupa",image:"image2.jpg",company:"RAFINO Coffee Grinding System",link:"https://www.kickstarter.com/projects/rafino/the-rafino-coffee-grind-refining-system",testimonial:"Getting listed on the front page was a big deal for us! Not only did it add credibility to our product but the number of eyeballs that saw, clicked and visited our site was huge!"},{name:"Cale Switzer",image:"image7.jpg",company:"Drive Stein",link:"https://drivestein.com",testimonial:"After we launched our product we had our doubts that it would actually sell after numerous failed marketing ventures. The day it went on TIWIB everything changed - sales came rolling in daily and I don't think Drive Stein would be here today without it."},{name:"Howie Busch",image:"image8.jpg",company:"DudeRobe",link:"https://duderobe.com",testimonial:"I paid for & ran the test for my product, DudeRobe, but had no idea what to expect. It tested well and resulted in enough sales to pay for itself in just a single day."},{name:"Brendan McAuley",image:"image9.jpg",company:"Chippo Golf",link:"https://chippogolf.com/",testimonial:"We were pumped when we saw all the traffic TIWIB drove to our Kickstarter Campaign. TIWIB definitely played a big part in helping us crush our intial Kickstarter goal by almost 20x!"},{name:"Howie Busch",image:"image10.png",company:"Zero Fucks Coins",link:"https://www.zerofuckscoin.com/",testimonial:"Our feature on TIWIB was the driving force to growing Zero Fucks Coins to what it is today. From that single post, we saw a 1,200% increase in sales overnight, and received countless other features from other websites that picked up the tip from TIWIB. "},{name:"Jordon Schultz",image:"image11.jpg",company:"Mother Of All Bombs Cup",link:"https://moabcups.com",testimonial:"Pitching my product on ThisIsWhyImBroke was the best $250 I've ever spent. A major social media marketing company found us on ThisIsWhyImBroke and the product went viral! 5 million+ views within a week! They found me here!"
}],l.put("cv-tiw007-clickout","showed"),t.scrollTo=function(t){$("html, body").animate({scrollTop:$(document).height()},"slow")},t.submit=function(){i.get("/api/user/start_funnel").success(function(e,i,n,a){t.temp_ad_id=e.id,o.path("/product-pitch/create/"+t.temp_ad_id+"/new")})},t.ready=!0}function CreativeCtrl(t,e,i,o,n,a,s,r,l,c){r.init(),t.ready=!0,e.hide_support_button=!0;var u=n.current.params.creative,d=n.current.params.temp_id;e.hide_header=!0,t.cropper={},t.cropper.sourceImage=null,t.cropper.croppedImage=null,t.bounds={},t.bounds.left=0,t.bounds.right=300,t.bounds.top=250,t.bounds.bottom=0,t.$watch("cropper.croppedImage",function(e){e&&(t.post.image=e,t.uploaded_image=!0)}),t.$watch("post.content",function(e,i){e&&e.length>250&&(t.post.content=e.substring(0,250))}),t.$watch("post.title",function(e,i){e&&e.length>40&&(t.post.title=e.substring(0,40))}),t.$watch("post.price",function(e,i){e&&e.length>0&&(t.post.price=e.replace(/[^0-9.]/g,""))}),t.clear_image=function(){console.log("Cleared image"),t.cropper.sourceImage=null,t.cropper={},t.uploaded_image=!1,t.bounds={},t.bounds.left=0,t.bounds.right=300,t.bounds.top=250,t.bounds.bottom=0},t.validate_url=function(t){var e="http://",i="https://";t.link&&t.link.substr(0,e.length)!==e&&t.link.substr(0,i.length)!==i&&(t.link=e+t.link,console.log("Added http prefix"))},"new"==u?(t.post={title:"",image:"/assets/images/300x250placeholder.jpg",content:"",price:"",link:""},n.current.params.campaign&&(t.post.campaign=n.current.params.campaign.toString().replace("x101",""),t.post.campaign=parseInt(t.post.campaign,36))):i.get("/api/user/creative/"+u).success(function(e,i,o,n){t.post=e.creative,t.ready=!0}),t.uploading=!1,t.open_upload=function(){$("#upload-image").click()},t.uploadedFile=function(e){t.currentFile=e.files[0];var i=new FileReader;i.onload=function(i){t.gif_source=i.target.result,console.log(t.image_source),t.$apply(function(t){t.files=e.files})},i.readAsDataURL(e.files[0])},t.boost_post_id=null,t.convert_to_boost=function(e){console.log("Convert to boost fired"),e?t.convert_error=null:t.convert_error="Please provide a post id",i({method:"POST",url:"/api/user/admin-convert-to-boost/",data:$.param({ad_id:u,post_id:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.convert_message="Success"})},t.submit=function(){return t.message=!1,"/assets/images/300x250placeholder.jpg"==t.post.image?void(t.image_error="Please upload an image"):t.post.price?t.post.link?(t.post.link&&(t.post.link=t.post.link.replace(/tag=([^&|^\n]+)/g,"tag=047-20")),t.uploading=!0,void("new"!=u||d?d?i({method:"POST",url:"/api/user/creative/temporary/"+d,data:$.param(t.post),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return"success"!=e.data.meta.status?void(t.error=e.data.meta.error):void i({method:"POST",url:"/api/user/creative/crop_image/"+d,data:$.param({source_image:t.cropper.sourceImage,crop_top:t.bounds.top,crop_bottom:t.bounds.bottom,crop_right:t.bounds.right,crop_left:t.bounds.left}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){o.path("/product-pitch/confirmation/"+d),t.uploading=!1},function(e){o.path("/product-pitch/confirmation/"+d),t.uploading=!1})},function(e){t.error="Product could not be submitted."}):(t.gif_source&&(t.post.gif=t.gif_source),i({method:"POST",url:"/api/user/admin-creative/"+t.post.id,data:$.param(t.post),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.uploading=!1,t.cropper.sourceImage=null,t.cropper.croppedImage=null,"success"!=e.data.meta.status?t.error=e.data.meta.error:(t.message="Your changes have been saved.",n.reload())},function(e){t.error="Product could not be submitted."})):i({method:"POST",url:"/api/user/creative",data:$.param(t.post),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return t.uploading=!1,"success"!=e.data.meta.status?void(t.error=e.data.meta.error):(t.message=e.data.meta.message,void(e.data.campaign_id?t.post.campaign?o.path("/product-pitch/dashboard/"):(c.eventTrack("creation",{category:"ssna",label:"creation"}),o.path("/product-pitch/confirmation/"+e.data.campaign_id)):t.error="Campaign could not be created."))},function(e){t.error="Product could not be submitted."}))):void(t.price_error="Please provide a link"):void(t.price_error="Please enter a price")}}function EditorialSetupCtrl(t,e,i,o,n,a,s,r,l,c,u,d){r.init(),t.ready=!1,e.hide_header=!0,t.featured_post={};var p=prompt("Please enter your password:","");if(null==p||""==p)o.path("/");else{t.featured_post.password=p;var h=parseInt(t.featured_post.password,36);0x35ee5973426ddc00==h?t.ready=!0:o.path("/")}t.featured_post.title="",t.featured_post.editorial_image="/assets/images/editorial-test.jpg",t.featured_post.content="",t.featured_post.is_giveaway=!1,t.renderHtml=function(t){return d.trustAsHtml(t)},t.cropper={},t.cropper.sourceImage=null,t.cropper.croppedImage=null,t.bounds={},t.bounds.left=0,t.bounds.right=300,t.bounds.top=250,t.bounds.bottom=0,t.$watch("cropper.croppedImage",function(e){e&&(t.featured_post.editorial_image=e,t.uploaded_image=!0)}),t.$watch("featured_post.content",function(e,i){e&&e.length>250&&(t.featured_post.content=e.substring(0,250))}),t.$watch("featured_post.title",function(e,i){e&&e.length>40&&(t.featured_post.title=e.substring(0,40))}),t.$watch("featured_post.price",function(e,i){e&&e.length>0&&(t.featured_post.price=e.replace(/[^0-9.]/g,""))}),t.open_upload=function(){$("#upload-image").click()},t.submit=function(){return t.featured_post.link?t.featured_post.title?t.featured_post.content?t.featured_post.price?t.featured_post.sponsor_label?t.featured_post.editorial_image&&"/assets/images/editorial-test.jpg"!=t.featured_post.editorial_image?(t.uploading=!0,t.error=!1,void i({method:"POST",url:"/api/user/editorial-setup",data:$.param(t.featured_post),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return t.uploading=!1,"success"!=e.data.meta.status?void(t.error=e.data.meta.error):(t.message="Your creative has been drafted! Please follow up with your brand development representative to continue.",void(t.complete=!0))},function(e){t.error="Product could not be submitted."})):void(t.error="Please upload an image"):void(t.error="Please provide a brand name"):void(t.error="Please provide a link"):void(t.error="Please provide a description"):void(t.error="Please provide a title"):void(t.error="Please provide a link")}}function ConfirmationCtrl(t,e,i,o,n,a,s,r,l,c,u){var d=n.current.params.campaign;t.ready=!1,r.init(),t.$watch("auth_finished",function(i){return e.is_logged_in&&e.auth_finished?(u.eventTrack("signup",{category:"ssna",label:"skip"}),void t.activate_campaign()):void(1==e.auth_finished&&(t.ready=!0))}),t.login_submit=function(){var e=s.logIn(t.loginData);e.then(function(e){s.isLoggedIn(),t.message="Success",t.login_error=void 0,u.eventTrack("signup",{category:"ssna",label:"logged-in"}),t.activate_campaign()},function(e){t.login_error="Your username or password was incorrect."})},t.register_submit=function(){var e=s.register(t.registerData);e.then(function(e){var i=s.logIn(t.registerData);i.then(function(e){s.isLoggedIn(),u.eventTrack("signup",{category:"ssna",label:"registered"}),t.activate_campaign()},function(e){t.register_error=e})},function(e){t.register_error=e})},t.activate_campaign=function(){i({method:"POST",url:"/api/user/activate_advertiser",data:$.param({temp_id:d}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?t.error=e.data.meta.error:(t.message=e.data.meta.message,t.campaign=e.data.campaign,o.path("/product-pitch/payment/x10"+t.campaign))},function(e){t.error="Could not activate advertiser."})}}function PaymentCtrl(t,e,i,o,n,a,s,r,l,c,u){function d(){if(Stripe&&paypal){c.cancel(m),h=Stripe("pk_live_ddYWADioygXAKOYIMNtGkR3M"),f=h.elements();var e={base:{iconColor:"#666EE8",color:"#31325F",lineHeight:"40px",fontWeight:300,fontFamily:"Helvetica Neue",fontSize:"15px","::placeholder":{color:"#CFD7E0"}}},i=f.create("cardNumber",{style:e});i.mount("#card-number-element"),g=i;var n=f.create("cardExpiry",{style:e});n.mount("#card-expiry-element");var a=f.create("cardCvc",{style:e});a.mount("#card-cvc-element");var s=f.create("postalCode",{style:e});s.mount("#postal-code-element");var r="/api/user/campaign/"+p+"/create_paypal/",l="/api/user/campaign/"+p+"/activate_paypal/";t.discount_token&&(r+="?token="+t.discount_token),paypal.Button.render({env:"production",commit:!0,locale:"en_US",style:{size:"medium",color:"gold",shape:"rect",label:"checkout",tagline:!1},payment:function(){return t.error=!1,paypal.request.post(r).then(function(t){return console.log(t),t.id})},onAuthorize:function(e){return paypal.request.post(l,{paymentID:e.paymentID,payerID:e.payerID}).then(function(e){e&&"approved"==e.state?(u.eventTrack("payment",{category:"ssna",label:"payment"}),o.path("/product-pitch/dashboard/"),t.message=e.data.meta.message):(t.error="There was a problem processing your paypal payment",t.submitted=!1)})}},"#paypal-button")}}r.init(),t.$watch("auth_finished",function(t){!e.is_logged_in&&e.auth_finished&&o.path("/login/")});var p=n.current.params.campaign.replace("x10","");e.hide_header=!0,t.submitted=!1,i.get("/api/user/campaign/"+p+"/creative/newest").success(function(e,i,o,n){t.campaign=e.creative,t.ready=!0});var h,g,f,m=c(d,200);t.fee="$249",t.discount_token="",o.search().token&&(t.discount_token=o.search().token,t.discounted_cost=!0,t.fee="$186.75"),t.show_paypal_error=function(){t.error="Please confirm you have read and agree to the terms and conditions"},t.submit=function(){if(!t.accept_conditions)return void(t.error="Please confirm you have read and agree to the terms and conditions");t.submitted=!0,t.error=null;document.getElementById("payment-form");h.createToken(g).then(function(e){if(e.error){var n=document.getElementById("card-errors");n.textContent=e.error.message,t.submitted=!1}else{var a=e.token.id;i({method:"POST",url:"/api/user/campaign/"+p+"/activate/",data:$.param({stripe_ref:a,discount_token:t.discount_token}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?(t.error=e.data.meta.error,t.submitted=!1):(u.eventTrack("payment",{category:"ssna",label:"payment"}),o.path("/product-pitch/dashboard/"),t.message=e.data.meta.message)},function(e){t.error="There was a problem processing your card."})}})}}function DashboardCtrl(t,e,i,o,n,a,s,r,l,c,u,d){u.init(),t.ready=!1,e.show_banner=!1,e.large_container=!1,e.hide_header=!0,e.hide_support_button=!0,u.setTitle("Product Dashboard"),t.$watch("auth_finished",function(t){if(!e.is_logged_in&&e.auth_finished)return void o.path("/ssna")}),t.getNumber=function(t){return new Array(t)};var p=s(function(){console.log("got data"),t.getdata(!0)}.bind(this),5e3);t.$on("$destroy",function(){s.cancel(p)});var h="/api/user/my-campaigns/";n.current.global&&(h="/api/user/all-campaigns/",t.admin=!0),t.getdata=function(e){i.get(h).success(function(i,o,n,a){t.ready=!0,e?angular.forEach(t.campaigns,function(e,o){angular.forEach(i.campaigns,function(i,n){if(e.id==i.id){t.campaigns[o].click_performance=i.click_performance,t.campaigns[o].expected_saves=i.expected_saves,t.campaigns[o].expected_clicks=i.expected_clicks,t.campaigns[o].save_performance=i.save_performance,t.campaigns[o].status!=i.status&&(t.campaigns[o]=i);var a=i.performance,s=t.campaigns[o].performance;a||(a=0),s||(s=0),a.toFixed(1)!=s.toFixed(1)&&(console.log("Performance changed"),t.campaigns[o].performance_changed=!0,l(function(){t.campaigns[o].performance_changed=!1,t.campaigns[o].performance=i.performance},400)),t.campaigns[o].impressions!=i.impressions&&(t.campaigns[o].impressions_changed=!0,l(function(){t.campaigns[o].impressions_changed=!1,t.campaigns[o].impressions=i.impressions},400)),t.campaigns[o].clicks!=i.clicks&&(t.campaigns[o].clicks_changed=!0,l(function(){t.campaigns[o].clicks_changed=!1,t.campaigns[o].clicks=i.clicks},400));var r=i.ctr,c=t.campaigns[o].ctr;r||(r=0),c||(c=0),c.toFixed(1)!=r.toFixed(1)&&(t.campaigns[o].ctr_changed=!0,l(function(){t.campaigns[o].ctr_changed=!1,t.campaigns[o].ctr=i.ctr},400)),t.campaigns[o].saves!=i.saves&&(t.campaigns[o].saves_changed=!0,l(function(){t.campaigns[o].saves_changed=!1,t.campaigns[o].saves=i.saves},400))}})}):t.campaigns=i.campaigns})},t.pause=function(e){i({method:"POST",url:"/api/user/creative/"+e.id+"/pause/",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.getdata()})},t.resume=function(e){i({method:"POST",url:"/api/user/creative/"+e.id+"/resume/",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.getdata()})},t.get_needle_rotation=function(t){return t<-99?-90:t>99?90:.9*t},t.getdata(!1),t.clamp=function(t,e,i){return t<e?e:t>i?i:t}}function DropoffsCtrl(t,e,i,o,n,a,s,r,l,c,u,d){u.init(),t.ready=!1,e.show_banner=!1,e.large_container=!0,u.setTitle("Dropoffs"),t.base_url=o.protocol()+"://"+o.host();var p=n.current.params.page?n.current.params.page:1;t.page=parseInt(p),t.$watch("auth_finished",function(t){if(!e.is_logged_in&&e.auth_finished)return void o.path("/ssna")}),i.get("/api/user/campaign/dropoffs/"+p).success(function(e,i,o,n){t.dropoffs=e.dropoffs}),t.get_discount_url=function(t){t.fetching_discount=!0,i.get("/api/user/campaign/discount_token/"+t.id).success(function(e,i,n,a){t.fetching_discount=!1,t.discount=e.token,t.discount_url=o.protocol()+"://"+o.host()+"/product-pitch/payment/x10"+t.id+"?token="+e.token})},t.send_discount=function(e){e.sending_discount=!0,i({method:"POST",url:"/api/user/campaign/dropoffs/send_discount",data:$.param(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(o){e.sent_discount=!0,e.sending_discount=!1,i.get("/api/user/campaign/dropoffs/"+t.page).success(function(e,i,o,n){t.dropoffs=e.dropoffs})},function(t){})},t.disqualify=function(e){e.sending_disqualified=!0,i({method:"POST",url:"/api/user/campaign/dropoffs/disqualify",data:$.param(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(o){i.get("/api/user/campaign/dropoffs/"+t.page).success(function(i,o,n,a){t.dropoffs=i.dropoffs,e.sending_disqualified=!1})},function(t){})}}function AdminApproveCtrl(t,e,i,o,n,a,s,r,l,c,u){t.ready=!0,e.show_banner=!1,e.large_container=!1,i.get("/api/user/creative/unapproved/all").success(function(e,i,o,n){t.creatives=e.creatives}),t.approve=function(t){i({method:"POST",url:"/api/user/creative/"+t.id+"/approve/",data:$.param({}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.status="running"},function(t){})},t.disapprove=function(t){console.log("Scope.signup() called"),u.showModal({templateUrl:"partials/disapprove-modal",controller:"DisapproveModalCtrl",inputs:{creative:t}}).then(function(t){t.element.modal(),s(function(){$("#reason").focus()},500),t.close.then(function(t){$(".modal-backdrop").remove()})})}}function DisapproveModalCtrl(t,e,i,o,n,a,s,r,l,c,u,d){t.submit=function(){i({method:"POST",url:"/api/user/creative/"+u.id+"/disapprove/",data:$.param({reason:t.reason}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){u.status="disapproved",t.close()},function(t){})},t.close=function(t){console.log("close"),c(t,0)}}function TempSubmitCtrl(t,e,i,o,n,a,s,r,l){r.init(),r.setTitle("Sorry submission is temporarily down"),t.submit=function(){if(!t.ssnaSignup.email)return void(t.error="Please provide a valid email address.");var e=t.ssnaSignup.email;i({method:"POST",url:"/api/user/ssnaleads",data:$.param({name:"",email:e,link:"",plan:""}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.submitted=!0,t.message="Thank you"},function(t){})},r.setIndex(),t.ready=!0}function SubmitCtrl(t,e,i,o,n,a,s,r,l){r.init(),t.show_form=!0,t.$watch("auth_finished",function(t){t&&!e.is_logged_in&&o.url("/login/")}),t.submit=function(){return t.error="",t.submitData&&t.submitData.purchaseLink&&t.submitData.productTitle?(t.submitData.productPrice&&(t.submitData.productPrice=t.submitData.productPrice.replace("$","")),e.is_logged_in?(t.show_form=!1,void i({method:"POST",url:"/api/submit",data:$.param({image:t.images,title:t.submitData.productTitle,link:t.submitData.purchaseLink,price:t.submitData.productPrice,description:t.submitData.productDescription}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?t.error=e.data.meta.error:t.message=e.data.meta.message},function(e){t.error="Product could not be submitted."})):void(t.error="Please log in to an account before submitting posts.")):void(t.error="Please fill out all the required fields.")},t.images=[],t.addImage=function(e){console.log("added image "+e),t.images.indexOf(e)!==-1||t.images.push(e),t.submitData.bulkUpload=null},r.setTitle("Submit a product"),r.setIndex(),t.ready=!0}function ContactCtrl(t,e,i,o,n,a,s,r){r.init(),t.show_form=!0,e.show_banner=!1,t.contactData={},t.contactData.type="General question/inquiry",a.scrollTo(0,0),t.submit=function(){return t.contactData&&t.contactData.name&&t.contactData.email&&t.contactData.message&&t.contactData.type?void i({method:"POST",url:"/api/contact/",data:$.param({name:t.contactData.name,email:t.contactData.email,message:t.contactData.message,type:t.contactData.type}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?t.error=e.data.meta.error:(t.message="Thank you for contacting us.",t.error=""),t.show_form=!1},function(e){t.error="Your password could not be changed."}):void(t.error="Please fill out all required fields.")},t.ready=!0}function AffiliateCtrl(t,e,i,o,n,a,s,r){r.init(),e.hide_header=!0,t.$watch("auth_finished",function(i){i&&!e.is_logged_in&&o.url("/login/");var n="";o.search().tag&&(n="?tag="+o.search().tag),t.param=n,t.get_data()}),t.get_data=function(){i.get("/api/user/affiliate/"+t.param).success(function(e,i,o,n){if(e&&e.meta&&"error"==e.meta.status)return t.error=!0,t.error_title="Access denied",void(t.error_message="You do not have access to view this page");e&&e.processing&&1==e.processing&&(t.error=!0,t.error_title="Reports Updating",t.error_message="Your reports are currently updating, please check back in a few minutes."),t.data=e.earnings,t.payments=e.payments,t.order_total=0,t.shipped_total=0,t.sales_total=0,t.commission_total=0,t.sorted_data=[];var a,s=0;t.totals=[],angular.forEach(t.data,function(e,i){a||(a=e.year_month),t.order_total+=e.ordered_units,t.shipped_total+=e.shipped_units,t.sales_total+=e.sales_amount,t.commission_total+=e.commission,a!=e.year_month&&(s+=1),t.sorted_data[s]||(t.sorted_data[s]=[]),t.sorted_data[s].push(e),a=e.year_month}),angular.forEach(t.sorted_data,function(e,i){var o=0,n=0,a=0,s=0;angular.forEach(e,function(t,e){o+=t.ordered_units,n+=t.shipped_units,a+=t.sales_amount,s+=t.commission}),t.totals[i]={},t.totals[i].order_total=o,t.totals[i].shipped_total=n,t.totals[i].sales_total=a,t.totals[i].commission_total=s}),console.log(t.totals),t.payments&&t.payments.length>0&&(t.aff_user_id=t.payments[0].user_id)})},t.update_ref=function(t,e){console.log(t),console.log(e),i({method:"POST",url:"/api/user/affiliate/ref/",data:$.param({ref:e,id:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){})},t.delete_payment=function(e){var o=t.payments.indexOf(e);t.payments.splice(o,1),i({method:"POST",url:"/api/user/affiliate/payment/delete/",data:$.param({id:e.id}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){})},t.add_payment=function(e,o){i({method:"POST",url:"/api/user/affiliate/payment/",data:$.param({user_id:t.aff_user_id,amount:e,ref:o}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.get_data()})},t.ready=!0}function AdminBoostChecklistCtrl(t,e,i,o,n,a,s,r,l,c){l.init(),t.ready=!0,t.$watch("auth_finished",function(t){!t||e.is_logged_in&&e.access||o.url("/login/")}),t.get_data=function(){i.get("/api/user/boosted-checklist/").then(function(e){t.posts=e.data.posts}),i.get("/api/user/boosted/").then(function(e){t.upcoming_posts=e.data.posts,angular.forEach(t.upcoming_posts,function(t,e){t.real_start=new Date(t.start)})})},t.get_data(),t.check_facebook=function(t){i({method:"POST",url:"/api/user/boosted-checklist/"+t.id+"/flags",data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){})},t.check_newsletter=function(t){i({method:"POST",url:"/api/user/boosted-checklist/"+t.id+"/flags",data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){})},t.check_instagram=function(t){i({method:"POST",url:"/api/user/boosted-checklist/"+t.id+"/flags",data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){})},t.submit=function(e){i({method:"POST",url:"/api/user/boosted/change-date",data:$.param(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.get_data()})}}function BoostCtrl(t,e,i,o,n,a,s,r,l,c){function u(){vanillacalendar&&(s.cancel(v),vanillacalendar.init())}function d(){if(t.get_date()){var e=t.get_year()+"-"+t.get_month()+"-"+t.get_date();t.boosted_dates&&t.boosted_dates.indexOf(e)>-1?t.selected_bad_date=!0:e==t.get_todays_date()?t.selected_bad_date=!0:t.disallowed_dates&&t.disallowed_dates.indexOf(e)>-1?t.selected_bad_date=!0:t.selected_bad_date=!1}else t.selected_bad_date=!1}function p(){if(Stripe){s.cancel(w),g=Stripe("pk_live_ddYWADioygXAKOYIMNtGkR3M"),m=g.elements();var t={base:{iconColor:"#666EE8",color:"#31325F",lineHeight:"40px",fontWeight:300,fontFamily:"Helvetica Neue",fontSize:"15px","::placeholder":{color:"#CFD7E0"}}},e=m.create("cardNumber",{style:t});e.mount("#card-number-element"),f=e;var i=m.create("cardExpiry",{style:t});i.mount("#card-expiry-element");var o=m.create("cardCvc",{style:t});o.mount("#card-cvc-element");var n=m.create("postalCode",{style:t});n.mount("#postal-code-element"),console.log("Stripe loaded")}}l.init();var h=n.current.params.slug;t.email="",t.email_confirm="",t.disallowed_dates=["2017-11-02","2017-11-03","2017-11-04","2017-11-05","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-11","2017-11-12","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-18","2017-11-19","2017-11-20","2017-11-21","2017-11-22","2017-11-23"],i.get("/api/posts/"+h+"/").then(function(e){t.post=e.data.post}),i.get("/api/user/boosted-disallowed/").then(function(e){t.boosted_dates=e.data.dates}),t.get_month=function(){var t=new Date($("#date_selected").text());if(t)return t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1},t.get_date=function(){var t=new Date($("#date_selected").text());if(t)return t.getDate()<10?"0"+t.getDate():t.getDate()},t.get_year=function(){var t=new Date($("#date_selected").text());if(t)return t.getFullYear()},t.get_todays_date=function(){var t=new Date,e=t.getDate(),i=t.getMonth()+1,o=t.getFullYear();return e<10&&(e="0"+e),i<10&&(i="0"+i),t=o+"-"+i+"-"+e},t.get_price=function(){if($("#date_selected").text()){var t=new Date($("#date_selected").text()),e=o.search().token;return 10==t.getMonth()&&t.getDate()>23?"$849":11==t.getMonth()&&t.getDate()<25?"$849":"wXdHkdG1we"==e?"$400":"$498"}return"Please select a date"},t.renderHtml=function(t){return c.trustAsHtml(t)};var g,f,m,v=s(u,200);t.selected_bad_date=!1;var w=(s(d,200),s(p,200));t.submit=function(){if(!t.selected_bad_date){if(!e.is_logged_in){if(!t.email||!t.email_confirm)return void(t.error="Please fill out the email form");if(t.email!=t.email_confirm)return void(t.error="The emails you typed do not match")}t.submitted=!0,t.error=null;var n=t.get_month(),a=t.get_date(),s=t.get_year();if(!a||!s)return t.error="Please enter a date for your post to be boosted",void(t.submitted=!1);document.getElementById("payment-form");g.createToken(f).then(function(e){if(e.error){var r=document.getElementById("card-errors");r.textContent=e.error.message,t.submitted=!1}else{var l=e.token.id;i({method:"POST",url:"/api/user/boost/"+h,data:$.param({stripe_ref:l,month:n,year:s,date:a,email:t.email,param_token:o.search().token}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"!=e.data.meta.status?(t.error=e.data.meta.error,t.submitted=!1):(t.success=!0,t.submitted=!1,t.message="Thank you for your payment")},function(e){t.error="There was a problem processing your card."})}})}}}function UnlistedContentCtrl(t,e,i,o,n,a,s,r){r.init(),t.$watch("auth_finished",function(t){t&&!e.is_logged_in&&o.url("/login/")}),t.ready=!0,t.cropper={},t.cropper.sourceImage=null,t.cropper.croppedImage=null,t.bounds={},t.bounds.left=0,t.bounds.right=640,t.bounds.top=534,t.bounds.bottom=0;var l=n.current.params.id;t.$watch("cropper.croppedImage",function(e){e&&(t.post.image=e,t.uploaded_image=!0)}),t.$watch("post.content",function(e,i){e&&e.length>250&&(t.post.content=e.substring(0,250))}),t.$watch("post.title",function(e,i){e&&e.length>40&&(t.post.title=e.substring(0,40)),t.post.title&&(t.post.slug=t.slugify(t.post.title))}),t.$watch("post.price",function(e,i){e&&e.length>0&&(t.post.price=e.replace(/[^0-9.]/g,""))}),t.slugify=function(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},t.validate_url=function(t){var e="http://",i="https://";t.link&&t.link.substr(0,e.length)!==e&&t.link.substr(0,i.length)!==i&&(t.link=e+t.link,console.log("Added http prefix"))},"new"==l?(t.post={title:"",slug:"",image:"/assets/images/300x250placeholder.jpg",content:"",price:"",link:"",upload_type:"image"},n.current.params.campaign&&(t.post.campaign=n.current.params.campaign.toString().replace("x101",""),t.post.campaign=parseInt(t.post.campaign,36))):i.get("/api/user/unlisted-content/"+creative_id).success(function(e,i,o,n){t.post=e.creative,t.ready=!0}),t.uploading=!1,t.open_upload=function(){$("#upload-image").click()},t.submit=function(){if(t.message=!1,"/assets/images/300x250placeholder.jpg"==t.post.image&&!t.post.embed)return void(t.image_error="Please upload an image or paste embed code");if(!t.post.price)return void(t.price_error="Please enter a price");if(!t.post.link)return void(t.price_error="Please provide a link");if(t.post.link&&(t.post.link=t.post.link.replace(/tag=([^&|^\n]+)/g,"tag=047-20")),t.post.embed){var e=/(src|width|height)=["']([^"']*)["']/gi;t.post.embed.replace(e,function(e,i,o){console.log(i),console.log(o),"width"==i&&(t.post.embed=t.post.embed.replace('width="'+o+'"','width="100%"')),"height"==i&&(t.post.embed=t.post.embed.replace('height="'+o+'"','height="100%"'))})}t.uploading=!0,"new"==l?i({method:"POST",url:"/api/user/unlisted-content/create",data:$.param(t.post),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.uploading=!1,t.error=null,"success"!=e.data.meta.status?t.error=e.data.meta.error:(t.message="Your changes have been saved.",o.url("/"+t.post.slug))},function(e){t.error="Product could not be submitted."}):i({method:"POST",url:"/api/user/creative/"+t.post.id,data:$.param(t.post),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){t.uploading=!1,t.cropper.sourceImage=null,t.cropper.croppedImage=null,t.error=null,"success"!=e.data.meta.status?t.error=e.data.meta.error:t.message="Your changes have been saved."},function(e){t.error="Product could not be submitted."})}}function PitchPostCtrl(t,e,i,o,n,a,s,r,l){r.init(),r.setTitle("Pitch Post"),t.post={},t.post.title="** Title **",t.post.priority="Normal",t.post.images=[],t.$watch("auth_finished",function(t){!t||e.is_logged_in&&e.access||o.url("/login/")}),t.saveImage=function(e){e&&(t.post.images.push(e),t.post.load_next_image="",console.log("Handled enter key"))},t.submit=function(){return t.post.title?(t.submitted=!0,void i({method:"POST",url:"/api/user/pitchpost",data:$.param({title:t.post.title,comments:t.post.content,link:t.post.link,priority:t.post.priority,images:t.post.images}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){var e=t.data.post_id;a.location.href="http://wordpress.thisiswhyimbroke.com/wp-admin/post.php?post="+e+"&action=edit"},function(t){})):void(t.error="Please provide a valid title.")},r.setNoIndex(),t.ready=!0}function addPostsToScope(t,e,i,o,n,a){function s(t,i){e.posts.splice.apply(e.posts,[t,0].concat(i))}if(!(!t||!t instanceof Array||t.length<1)){if(t[0].sort&&t[0].sort!=e.sort&&!n)return void console.log("Posts discarded due to sort change");if(o&&1==t[0].page){var r={ad:!0,native_ad:!0,ad_id:0,type:"ad",page:1};e.native_ads_container.push(r),t.splice.apply(t,[7,0].concat(r))}if(o&&2==t[0].page){var r={ad:!0,native_ad:!0,ad_id:1,type:"ad",page:2};e.native_ads_container.push(r),t.splice.apply(t,[3,0].concat(r))}if(o&&2==t[0].page){var r={ad:!0,native_ad:!0,ad_id:2,type:"ad",page:2};e.native_ads_container.push(r),t.splice.apply(t,[12,0].concat(r)),e.loaded_native_container=!0}if(o&&3==t[0].page){var r={ad:!0,native_ad:!0,ad_id:3,type:"ad",page:3};e.native_ads_container.push(r),t.splice.apply(t,[7,0].concat(r)),e.loaded_native_container=!0}if(o&&4==t[0].page){var r={ad:!0,native_ad:!0,ad_id:4,type:"ad",page:4};e.native_ads_container.push(r),t.splice.apply(t,[3,0].concat(r)),e.loaded_native_container=!0}if(o&&4==t[0].page){var r={ad:!0,native_ad:!0,ad_id:5,type:"ad",page:4};e.native_ads_container.push(r),t.splice.apply(t,[12,0].concat(r)),e.loaded_native_container=!0}if(o&&5==t[0].page){var l={type:"cta",page:5};t.splice.apply(t,[7,0].concat(l))}if(o&&6==t[0].page){var c={type:"newsletter-cta",page:6};t.splice.apply(t,[3,0].concat(c))}if(a&&1==t[0].page&&(5==a&&$rootScope.featured_post&&$rootScope.featured_post.display_gifts||4==a&&$rootScope.featured_post&&$rootScope.featured_post.display_related)&&($rootScope.featured_post.page=1,t.splice.apply(t,[a,0].concat($rootScope.featured_post))),e.posts&&e.posts instanceof Array){for(var u=t[0].page,d=0;d<e.posts.length;d++){if(u==e.posts[d].page)return void console.log("A duplicated page");if(e.posts[d].page>u)return void s(d,t)}for(var p=0;p<t.length;p++)e.posts.push(t[p])}else e.posts=t}}function addPagingMeta(t,e,i,o){var n=parseInt(e);t.length<1?(o.setStatusCode(404),o.setCanonical("/404"),o.setRelPrev(i+"page/"+(n-1))):parseInt(e)>1?(o.setRelNext(i+"page/"+(n+1)),o.setRelPrev(i+"page/"+(n-1)),o.setCanonical(i+"page/"+n)):(o.setRelNext(i+"page/"+(n+1)),o.setCanonical(i))}function simpleMatch(t,e){return t=t.replace("http://","").replace("https://","").replace("www.",""),t=t.indexOf("?")>-1?t.substring(0,t.indexOf("?")):t,t=t.lastIndexOf("/")==t.length-1?t.substring(0,t.lastIndexOf("/")):t,e=e.replace("http://","").replace("https://","").replace("www.",""),e=e.indexOf("?")>-1?e.substring(0,e.indexOf("?")):e,e=e.lastIndexOf("/")==e.length-1?e.substring(0,e.lastIndexOf("/")):e,t==e}function exactMatch(t,e){return t=t.replace("http://","").replace("https://","").replace("www.","").replace("/?","?"),t=t.lastIndexOf("/")==t.length-1?t.substring(0,t.lastIndexOf("/")):t,e=e.replace("http://","").replace("https://","").replace("www.","").replace("/?","?"),e=e.lastIndexOf("/")==e.length-1?e.substring(0,e.lastIndexOf("/")):e,t==e}function substringMatch(t,e){return t=t.lastIndexOf("/")==t.length-1?t.substring(0,t.lastIndexOf("/")):t,e=e.lastIndexOf("/")==e.length-1?e.substring(0,e.lastIndexOf("/")):e,t.indexOf(e)!=-1}function regexMatch(t,e){return null!==t.match(e)}function formatDate(t){var e=["January","February","March","April","May","June","July","August","September","October","November","December"],i=t.getDate(),o=t.getMonth(),n=t.getFullYear();return i+" "+e[o]+" "+n}function getUrlParameter(t){var e,i,o=decodeURIComponent(window.location.search.substring(1)),n=o.split("&");for(i=0;i<n.length;i++)if(e=n[i].split("="),e[0]===t)return void 0===e[1]||e[1]}GiftsCtrl.$inject=["$scope","$rootScope","$http","$location","$cookies","$route","AuthService","Page","$sce"],
IndexCtrl.$inject=["$scope","$rootScope","$http","$route","$location","$cookies","AuthService","Page","$timeout","$sce"],PriceCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$cookies","AuthService","Page","$sce"],WishlistCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page"],SearchCtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","AuthService","$routeParams","Page","$sce"],LogInCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$cookies","$window","AuthService","flash","Page"],LogOutCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$cookies","$window","AuthService","Page"],RegisterCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page"],ErrorCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page"],ContactCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page"],SimpleCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page"],ProfileCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","$filter","AuthService","Page","flash"],ForgotCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash"],Advertising.$inject=["$scope","$rootScope","$http","$location","$timeout","$route","$window","$anchorScroll","$cookies","$analytics","AuthService","Page","$interval"],CreativeCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","$analytics"],ConfirmationCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","$interval","$analytics"],PaymentCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","$interval","$analytics"],DashboardCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","$interval","$filter","$timeout","AuthService","Page","flash"],DropoffsCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","$interval","$filter","$timeout","AuthService","Page","flash"],EditorialSetupCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","$interval","$analytics","$sce"],AdminApproveCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","$timeout","AuthService","Page","flash","ModalService"],UnlistedContentCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page"],ResetCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash"],ConfirmSubscriptionCtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","$timeout","flash","AuthService","Page"],BlogCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash"],BoostCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","$interval","AuthService","Page","$sce"],AdminBoostChecklistCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","$interval","AuthService","Page","$sce"],AffiliateCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page"],BlogPostCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","$sce"],GiveawayListCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","$sce"],PostCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$cookies","AuthService","$sce","Page","$timeout"],GiveawayCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","$sce"],PitchPostCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash"],ModifyWishlistCtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","$timeout","flash","AuthService","ModalService"],GiveawayEntryCtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","$timeout","flash","AuthService","ModalService"],GiveawayEntryModalCtrl.$inject=["$scope","$http","$location","$timeout","$rootScope","$route","$window","AuthService","$cookies","$sce","close","message","giveaway_url"],NewsletterCTACtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","AuthService","$cookies"],ModifyAdWishlistCtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","$timeout","flash","AuthService","ModalService"],LoginRegisterModalCtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","AuthService","$cookies","close","message","login"],PurchaseNotificationCtrl.$inject=["$scope","$http","$location","$rootScope","$route","$window","flash","AuthService","$cookies","$interval"],SearchPartialCtrl.$inject=["$scope","$http","$routeParams","$location","$rootScope","$route","$window","AuthService"],DisapproveModalCtrl.$inject=["$scope","$rootScope","$http","$location","$route","$window","AuthService","Page","flash","close","creative","ModalService"],!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["angular"],e):"object"==typeof module&&module.exports?module.exports=e(require("angular")):e(t.angular)}(this,function(t){"use strict";var e=t.module("rzModule",[]).factory("RzSliderOptions",function(){var e={floor:0,ceil:null,step:1,precision:0,minRange:null,maxRange:null,minLimit:null,maxLimit:null,id:null,translate:null,getLegend:null,stepsArray:null,draggableRange:!1,draggableRangeOnly:!1,showSelectionBar:!1,showSelectionBarEnd:!1,showSelectionBarFromValue:null,hidePointerLabels:!1,hideLimitLabels:!1,readOnly:!1,disabled:!1,interval:350,showTicks:!1,showTicksValues:!1,ticksTooltip:null,ticksValuesTooltip:null,vertical:!1,getSelectionBarColor:null,getPointerColor:null,keyboardSupport:!0,scale:1,enforceStep:!0,enforceRange:!1,noSwitching:!1,onlyBindHandles:!1,onStart:null,onChange:null,onEnd:null,rightToLeft:!1,boundPointerLabels:!0},i={},o={};return o.options=function(e){t.extend(i,e)},o.getOptions=function(o){return t.extend({},e,i,o)},o}).factory("rzThrottle",["$timeout",function(t){return function(e,i,o){var n,a,s,r=Date.now||function(){return(new Date).getTime()},l=null,c=0;o=o||{};var u=function(){c=r(),l=null,s=e.apply(n,a),n=a=null};return function(){var d=r(),p=i-(d-c);return n=this,a=arguments,0>=p?(t.cancel(l),l=null,c=d,s=e.apply(n,a),n=a=null):l||o.trailing===!1||(l=t(u,p)),s}}}]).factory("RzSlider",["$timeout","$document","$window","$compile","RzSliderOptions","rzThrottle",function(e,i,o,n,a,s){var r=function(t,e){this.scope=t,this.lowValue=0,this.highValue=0,this.sliderElem=e,this.range=void 0!==this.scope.rzSliderModel&&void 0!==this.scope.rzSliderHigh,this.dragging={active:!1,value:0,difference:0,offset:0,lowLimit:0,highLimit:0},this.positionProperty="left",this.dimensionProperty="width",this.handleHalfDim=0,this.maxPos=0,this.precision=0,this.step=1,this.tracking="",this.minValue=0,this.maxValue=0,this.valueRange=0,this.intermediateTicks=!1,this.initHasRun=!1,this.firstKeyDown=!1,this.internalChange=!1,this.fullBar=null,this.selBar=null,this.minH=null,this.maxH=null,this.flrLab=null,this.ceilLab=null,this.minLab=null,this.maxLab=null,this.cmbLab=null,this.ticks=null,this.init()};return r.prototype={init:function(){var e,i,n=this,a=function(){n.calcViewDimensions()};this.applyOptions(),this.syncLowValue(),this.range&&this.syncHighValue(),this.initElemHandles(),this.manageElementsStyle(),this.setDisabledState(),this.calcViewDimensions(),this.setMinAndMax(),this.addAccessibility(),this.updateCeilLab(),this.updateFloorLab(),this.initHandles(),this.manageEventsBindings(),this.scope.$on("reCalcViewDimensions",a),t.element(o).on("resize",a),this.initHasRun=!0,e=s(function(){n.onLowHandleChange()},n.options.interval),i=s(function(){n.onHighHandleChange()},n.options.interval),this.scope.$on("rzSliderForceRender",function(){n.resetLabelsValue(),e(),n.range&&i(),n.resetSlider()}),this.scope.$watch("rzSliderOptions()",function(t,e){t!==e&&(n.applyOptions(),n.syncLowValue(),n.range&&n.syncHighValue(),n.resetSlider())},!0),this.scope.$watch("rzSliderModel",function(t,i){n.internalChange||t!==i&&e()}),this.scope.$watch("rzSliderHigh",function(t,e){n.internalChange||t!==e&&(null!=t&&i(),(n.range&&null==t||!n.range&&null!=t)&&(n.applyOptions(),n.resetSlider()))}),this.scope.$on("$destroy",function(){n.unbindEvents(),t.element(o).off("resize",a)})},findStepIndex:function(e){for(var i=0,o=0;o<this.options.stepsArray.length;o++){var n=this.options.stepsArray[o];if(n===e){i=o;break}if(t.isObject(n)&&n.value===e){i=o;break}}return i},syncLowValue:function(){this.options.stepsArray?this.lowValue=this.findStepIndex(this.scope.rzSliderModel):this.lowValue=this.scope.rzSliderModel},syncHighValue:function(){this.options.stepsArray?this.highValue=this.findStepIndex(this.scope.rzSliderHigh):this.highValue=this.scope.rzSliderHigh},getStepValue:function(e){var i=this.options.stepsArray[e];return t.isObject(i)?i.value:i},applyLowValue:function(){this.options.stepsArray?this.scope.rzSliderModel=this.getStepValue(this.lowValue):this.scope.rzSliderModel=this.lowValue},applyHighValue:function(){this.options.stepsArray?this.scope.rzSliderHigh=this.getStepValue(this.highValue):this.scope.rzSliderHigh=this.highValue},onLowHandleChange:function(){this.syncLowValue(),this.range&&this.syncHighValue(),this.setMinAndMax(),this.updateLowHandle(this.valueToOffset(this.lowValue)),this.updateSelectionBar(),this.updateTicksScale(),this.updateAriaAttributes(),this.range&&this.updateCmbLabel()},onHighHandleChange:function(){this.syncLowValue(),this.syncHighValue(),this.setMinAndMax(),this.updateHighHandle(this.valueToOffset(this.highValue)),this.updateSelectionBar(),this.updateTicksScale(),this.updateCmbLabel(),this.updateAriaAttributes()},applyOptions:function(){var e;e=this.scope.rzSliderOptions?this.scope.rzSliderOptions():{},this.options=a.getOptions(e),this.options.step<=0&&(this.options.step=1),this.range=void 0!==this.scope.rzSliderModel&&void 0!==this.scope.rzSliderHigh,this.options.draggableRange=this.range&&this.options.draggableRange,this.options.draggableRangeOnly=this.range&&this.options.draggableRangeOnly,this.options.draggableRangeOnly&&(this.options.draggableRange=!0),this.options.showTicks=this.options.showTicks||this.options.showTicksValues,this.scope.showTicks=this.options.showTicks,t.isNumber(this.options.showTicks)&&(this.intermediateTicks=!0),this.options.showSelectionBar=this.options.showSelectionBar||this.options.showSelectionBarEnd||null!==this.options.showSelectionBarFromValue,this.options.stepsArray?this.parseStepsArray():(this.options.translate?this.customTrFn=this.options.translate:this.customTrFn=function(t){return String(t)},this.options.getLegend&&(this.getLegend=this.options.getLegend)),this.options.vertical&&(this.positionProperty="bottom",this.dimensionProperty="height")},parseStepsArray:function(){this.options.floor=0,this.options.ceil=this.options.stepsArray.length-1,this.options.step=1,this.options.translate?this.customTrFn=this.options.translate:this.customTrFn=function(t){return t},this.getLegend=function(e){var i=this.options.stepsArray[e];return t.isObject(i)?i.legend:null}},resetSlider:function(){this.manageElementsStyle(),this.addAccessibility(),this.setMinAndMax(),this.updateCeilLab(),this.updateFloorLab(),this.unbindEvents(),this.manageEventsBindings(),this.setDisabledState(),this.calcViewDimensions()},initElemHandles:function(){t.forEach(this.sliderElem.children(),function(e,i){var o=t.element(e);switch(i){case 0:this.fullBar=o;break;case 1:this.selBar=o;break;case 2:this.minH=o;break;case 3:this.maxH=o;break;case 4:this.flrLab=o;break;case 5:this.ceilLab=o;break;case 6:this.minLab=o;break;case 7:this.maxLab=o;break;case 8:this.cmbLab=o;break;case 9:this.ticks=o}},this),this.selBar.rzsp=0,this.minH.rzsp=0,this.maxH.rzsp=0,this.flrLab.rzsp=0,this.ceilLab.rzsp=0,this.minLab.rzsp=0,this.maxLab.rzsp=0,this.cmbLab.rzsp=0},manageElementsStyle:function(){this.range?this.maxH.css("display",""):this.maxH.css("display","none"),this.alwaysHide(this.flrLab,this.options.showTicksValues||this.options.hideLimitLabels),this.alwaysHide(this.ceilLab,this.options.showTicksValues||this.options.hideLimitLabels);var t=this.options.showTicksValues&&!this.intermediateTicks;this.alwaysHide(this.minLab,t||this.options.hidePointerLabels),this.alwaysHide(this.maxLab,t||!this.range||this.options.hidePointerLabels),this.alwaysHide(this.cmbLab,t||!this.range||this.options.hidePointerLabels),this.alwaysHide(this.selBar,!this.range&&!this.options.showSelectionBar),this.options.vertical&&this.sliderElem.addClass("rz-vertical"),this.options.draggableRange?this.selBar.addClass("rz-draggable"):this.selBar.removeClass("rz-draggable"),this.intermediateTicks&&this.options.showTicksValues&&this.ticks.addClass("rz-ticks-values-under")},alwaysHide:function(t,e){t.rzAlwaysHide=e,e?this.hideEl(t):this.showEl(t)},manageEventsBindings:function(){this.options.disabled||this.options.readOnly?this.unbindEvents():this.bindEvents()},setDisabledState:function(){this.options.disabled?this.sliderElem.attr("disabled","disabled"):this.sliderElem.attr("disabled",null)},resetLabelsValue:function(){this.minLab.rzsv=void 0,this.maxLab.rzsv=void 0},initHandles:function(){this.updateLowHandle(this.valueToOffset(this.lowValue)),this.range&&this.updateHighHandle(this.valueToOffset(this.highValue)),this.updateSelectionBar(),this.range&&this.updateCmbLabel(),this.updateTicksScale()},translateFn:function(t,e,i,o){o=void 0===o||o;var n="",a=!1;o?(this.options.stepsArray&&(t=this.getStepValue(t)),n=String(this.customTrFn(t,this.options.id,i))):n=String(t),(void 0===e.rzsv||e.rzsv.length!==n.length||e.rzsv.length>0&&0===e.rzsd)&&(a=!0,e.rzsv=n),e.html(n),a&&this.getDimension(e)},setMinAndMax:function(){this.step=+this.options.step,this.precision=+this.options.precision,this.minValue=this.options.floor,this.options.enforceStep&&(this.lowValue=this.roundStep(this.lowValue),this.range&&(this.highValue=this.roundStep(this.highValue))),null!=this.options.ceil?this.maxValue=this.options.ceil:this.maxValue=this.options.ceil=this.range?this.highValue:this.lowValue,this.options.enforceRange&&(this.lowValue=this.sanitizeValue(this.lowValue),this.range&&(this.highValue=this.sanitizeValue(this.highValue))),this.applyLowValue(),this.range&&this.applyHighValue(),this.valueRange=this.maxValue-this.minValue},addAccessibility:function(){this.minH.attr("role","slider"),this.updateAriaAttributes(),!this.options.keyboardSupport||this.options.readOnly||this.options.disabled?this.minH.attr("tabindex",""):this.minH.attr("tabindex","0"),this.options.vertical&&this.minH.attr("aria-orientation","vertical"),this.range&&(this.maxH.attr("role","slider"),!this.options.keyboardSupport||this.options.readOnly||this.options.disabled?this.maxH.attr("tabindex",""):this.maxH.attr("tabindex","0"),this.options.vertical&&this.maxH.attr("aria-orientation","vertical"))},updateAriaAttributes:function(){this.minH.attr({"aria-valuenow":this.scope.rzSliderModel,"aria-valuetext":this.customTrFn(this.scope.rzSliderModel,this.options.id,"model"),"aria-valuemin":this.minValue,"aria-valuemax":this.maxValue}),this.range&&this.maxH.attr({"aria-valuenow":this.scope.rzSliderHigh,"aria-valuetext":this.customTrFn(this.scope.rzSliderHigh,this.options.id,"high"),"aria-valuemin":this.minValue,"aria-valuemax":this.maxValue})},calcViewDimensions:function(){var t=this.getDimension(this.minH);this.handleHalfDim=t/2,this.barDimension=this.getDimension(this.fullBar),this.maxPos=this.barDimension-t,this.getDimension(this.sliderElem),this.sliderElem.rzsp=this.sliderElem[0].getBoundingClientRect()[this.positionProperty],this.initHasRun&&(this.updateFloorLab(),this.updateCeilLab(),this.initHandles())},updateTicksScale:function(){if(this.options.showTicks){var t=this.step;this.intermediateTicks&&(t=this.options.showTicks);var e=Math.round((this.maxValue-this.minValue)/t)+1;this.scope.ticks=[];for(var i=0;e>i;i++){var o=this.roundStep(this.minValue+i*t),n={selected:this.isTickSelected(o)};if(n.selected&&this.options.getSelectionBarColor&&(n.style={"background-color":this.getSelectionBarColor()}),this.options.ticksTooltip&&(n.tooltip=this.options.ticksTooltip(o),n.tooltipPlacement=this.options.vertical?"right":"top"),this.options.showTicksValues&&(n.value=this.getDisplayValue(o,"tick-value"),this.options.ticksValuesTooltip&&(n.valueTooltip=this.options.ticksValuesTooltip(o),n.valueTooltipPlacement=this.options.vertical?"right":"top")),this.getLegend){var a=this.getLegend(o,this.options.id);a&&(n.legend=a)}this.options.rightToLeft?this.scope.ticks.unshift(n):this.scope.ticks.push(n)}}},isTickSelected:function(t){if(!this.range)if(null!==this.options.showSelectionBarFromValue){var e=this.options.showSelectionBarFromValue;if(this.lowValue>e&&t>=e&&t<=this.lowValue)return!0;if(this.lowValue<e&&e>=t&&t>=this.lowValue)return!0}else if(this.options.showSelectionBarEnd){if(t>=this.lowValue)return!0}else if(this.options.showSelectionBar&&t<=this.lowValue)return!0;return!!(this.range&&t>=this.lowValue&&t<=this.highValue)},updateFloorLab:function(){this.translateFn(this.minValue,this.flrLab,"floor"),this.getDimension(this.flrLab);var t=this.options.rightToLeft?this.barDimension-this.flrLab.rzsd:0;this.setPosition(this.flrLab,t)},updateCeilLab:function(){this.translateFn(this.maxValue,this.ceilLab,"ceil"),this.getDimension(this.ceilLab);var t=this.options.rightToLeft?0:this.barDimension-this.ceilLab.rzsd;this.setPosition(this.ceilLab,t)},updateHandles:function(t,e){"lowValue"===t?this.updateLowHandle(e):this.updateHighHandle(e),this.updateSelectionBar(),this.updateTicksScale(),this.range&&this.updateCmbLabel()},getHandleLabelPos:function(t,e){var i=this[t].rzsd,o=e-i/2+this.handleHalfDim,n=this.barDimension-i;return this.options.boundPointerLabels?this.options.rightToLeft&&"minLab"===t||!this.options.rightToLeft&&"maxLab"===t?Math.min(o,n):Math.min(Math.max(o,0),n):o},updateLowHandle:function(t){if(this.setPosition(this.minH,t),this.translateFn(this.lowValue,this.minLab,"model"),this.setPosition(this.minLab,this.getHandleLabelPos("minLab",t)),this.options.getPointerColor){var e=this.getPointerColor("min");this.scope.minPointerStyle={backgroundColor:e}}this.shFloorCeil()},updateHighHandle:function(t){if(this.setPosition(this.maxH,t),this.translateFn(this.highValue,this.maxLab,"high"),this.setPosition(this.maxLab,this.getHandleLabelPos("maxLab",t)),this.options.getPointerColor){var e=this.getPointerColor("max");this.scope.maxPointerStyle={backgroundColor:e}}this.shFloorCeil()},shFloorCeil:function(){var t=!1,e=!1,i=this.options.rightToLeft,o=this.flrLab.rzsp,n=this.flrLab.rzsd,a=this.minLab.rzsp,s=this.minLab.rzsd,r=this.maxLab.rzsp,l=this.maxLab.rzsd,c=this.ceilLab.rzsp,u=this.handleHalfDim,d=i?a+s>=o-n-5:o+n+5>=a,p=i?c+u+10>=a-s:a+s>=c-u-10,h=i?r>=o-n-u:o+n+u>=r,g=i?c+10>=r-l:r+l>=c-10;d?(t=!0,this.hideEl(this.flrLab)):(t=!1,this.showEl(this.flrLab)),p?(e=!0,this.hideEl(this.ceilLab)):(e=!1,this.showEl(this.ceilLab)),this.range&&(g?this.hideEl(this.ceilLab):e||this.showEl(this.ceilLab),h?this.hideEl(this.flrLab):t||this.showEl(this.flrLab))},updateSelectionBar:function(){var t=0,e=0,i=this.options.rightToLeft?!this.options.showSelectionBarEnd:this.options.showSelectionBarEnd,o=this.options.rightToLeft?this.maxH.rzsp+this.handleHalfDim:this.minH.rzsp+this.handleHalfDim;if(this.range)e=Math.abs(this.maxH.rzsp-this.minH.rzsp),t=o;else if(null!==this.options.showSelectionBarFromValue){var n=this.options.showSelectionBarFromValue,a=this.valueToOffset(n),s=this.options.rightToLeft?this.lowValue<=n:this.lowValue>n;s?(e=this.minH.rzsp-a,t=a+this.handleHalfDim):(e=a-this.minH.rzsp,t=this.minH.rzsp+this.handleHalfDim)}else i?(e=Math.abs(this.maxPos-this.minH.rzsp)+this.handleHalfDim,t=this.minH.rzsp+this.handleHalfDim):(e=Math.abs(this.maxH.rzsp-this.minH.rzsp)+this.handleHalfDim,t=0);if(this.setDimension(this.selBar,e),this.setPosition(this.selBar,t),this.options.getSelectionBarColor){var r=this.getSelectionBarColor();this.scope.barStyle={backgroundColor:r}}},getSelectionBarColor:function(){return this.range?this.options.getSelectionBarColor(this.scope.rzSliderModel,this.scope.rzSliderHigh):this.options.getSelectionBarColor(this.scope.rzSliderModel)},getPointerColor:function(t){return"max"===t?this.options.getPointerColor(this.scope.rzSliderHigh,t):this.options.getPointerColor(this.scope.rzSliderModel,t)},updateCmbLabel:function(){var t=null;if(t=this.options.rightToLeft?this.minLab.rzsp-this.minLab.rzsd-10<=this.maxLab.rzsp:this.minLab.rzsp+this.minLab.rzsd+10>=this.maxLab.rzsp){var e=this.getDisplayValue(this.lowValue,"model"),i=this.getDisplayValue(this.highValue,"high"),o="";o=e===i?e:this.options.rightToLeft?i+" - "+e:e+" - "+i,this.translateFn(o,this.cmbLab,"cmb",!1);var n=this.options.boundPointerLabels?Math.min(Math.max(this.selBar.rzsp+this.selBar.rzsd/2-this.cmbLab.rzsd/2,0),this.barDimension-this.cmbLab.rzsd):this.selBar.rzsp+this.selBar.rzsd/2-this.cmbLab.rzsd/2;this.setPosition(this.cmbLab,n),this.hideEl(this.minLab),this.hideEl(this.maxLab),this.showEl(this.cmbLab)}else this.showEl(this.maxLab),this.showEl(this.minLab),this.hideEl(this.cmbLab)},getDisplayValue:function(t,e){return this.options.stepsArray&&(t=this.getStepValue(t)),this.customTrFn(t,this.options.id,e)},roundStep:function(t,e){var i=e?e:this.step,o=parseFloat((t-this.minValue)/i).toPrecision(12);o=Math.round(+o)*i;var n=(this.minValue+o).toFixed(this.precision);return+n},hideEl:function(t){return t.css({opacity:0})},showEl:function(t){return t.rzAlwaysHide?t:t.css({opacity:1})},setPosition:function(t,e){t.rzsp=e;var i={};return i[this.positionProperty]=e+"px",t.css(i),e},getDimension:function(t){var e=t[0].getBoundingClientRect();return this.options.vertical?t.rzsd=(e.bottom-e.top)*this.options.scale:t.rzsd=(e.right-e.left)*this.options.scale,t.rzsd},setDimension:function(t,e){t.rzsd=e;var i={};return i[this.dimensionProperty]=e+"px",t.css(i),e},valueToOffset:function(t){return this.options.rightToLeft?(this.maxValue-this.sanitizeValue(t))*this.maxPos/this.valueRange||0:(this.sanitizeValue(t)-this.minValue)*this.maxPos/this.valueRange||0},sanitizeValue:function(t){return Math.min(Math.max(t,this.minValue),this.maxValue)},offsetToValue:function(t){return this.options.rightToLeft?(1-t/this.maxPos)*this.valueRange+this.minValue:t/this.maxPos*this.valueRange+this.minValue},getEventXY:function(t){var e=this.options.vertical?"clientY":"clientX";return e in t?t[e]:void 0===t.originalEvent?t.touches[0][e]:t.originalEvent.touches[0][e]},getEventPosition:function(t){var e=this.sliderElem.rzsp,i=0;return i=this.options.vertical?-this.getEventXY(t)+e:this.getEventXY(t)-e,(i-this.handleHalfDim)*this.options.scale},getEventNames:function(t){var e={moveEvent:"",endEvent:""};return t.touches||void 0!==t.originalEvent&&t.originalEvent.touches?(e.moveEvent="touchmove",e.endEvent="touchend"):(e.moveEvent="mousemove",e.endEvent="mouseup"),e},getNearestHandle:function(t){if(!this.range)return this.minH;var e=this.getEventPosition(t),i=Math.abs(e-this.minH.rzsp),o=Math.abs(e-this.maxH.rzsp);return o>i?this.minH:i>o?this.maxH:this.options.rightToLeft?e>this.minH.rzsp?this.minH:this.maxH:e<this.minH.rzsp?this.minH:this.maxH},focusElement:function(t){var e=0;t[e].focus()},bindEvents:function(){var e,i,o;this.options.draggableRange?(e="rzSliderDrag",i=this.onDragStart,o=this.onDragMove):(e="lowValue",i=this.onStart,o=this.onMove),this.options.onlyBindHandles||(this.selBar.on("mousedown",t.bind(this,i,null,e)),this.selBar.on("mousedown",t.bind(this,o,this.selBar))),this.options.draggableRangeOnly?(this.minH.on("mousedown",t.bind(this,i,null,e)),this.maxH.on("mousedown",t.bind(this,i,null,e))):(this.minH.on("mousedown",t.bind(this,this.onStart,this.minH,"lowValue")),this.range&&this.maxH.on("mousedown",t.bind(this,this.onStart,this.maxH,"highValue")),this.options.onlyBindHandles||(this.fullBar.on("mousedown",t.bind(this,this.onStart,null,null)),this.fullBar.on("mousedown",t.bind(this,this.onMove,this.fullBar)),this.ticks.on("mousedown",t.bind(this,this.onStart,null,null)),this.ticks.on("mousedown",t.bind(this,this.onTickClick,this.ticks)))),this.options.onlyBindHandles||(this.selBar.on("touchstart",t.bind(this,i,null,e)),this.selBar.on("touchstart",t.bind(this,o,this.selBar))),this.options.draggableRangeOnly?(this.minH.on("touchstart",t.bind(this,i,null,e)),this.maxH.on("touchstart",t.bind(this,i,null,e))):(this.minH.on("touchstart",t.bind(this,this.onStart,this.minH,"lowValue")),this.range&&this.maxH.on("touchstart",t.bind(this,this.onStart,this.maxH,"highValue")),this.options.onlyBindHandles||(this.fullBar.on("touchstart",t.bind(this,this.onStart,null,null)),this.fullBar.on("touchstart",t.bind(this,this.onMove,this.fullBar)),this.ticks.on("touchstart",t.bind(this,this.onStart,null,null)),this.ticks.on("touchstart",t.bind(this,this.onTickClick,this.ticks)))),this.options.keyboardSupport&&(this.minH.on("focus",t.bind(this,this.onPointerFocus,this.minH,"lowValue")),this.range&&this.maxH.on("focus",t.bind(this,this.onPointerFocus,this.maxH,"highValue")))},unbindEvents:function(){this.minH.off(),this.maxH.off(),this.fullBar.off(),this.selBar.off(),this.ticks.off()},onStart:function(e,o,n){var a,s,r=this.getEventNames(n);n.stopPropagation(),n.preventDefault(),this.calcViewDimensions(),e?this.tracking=o:(e=this.getNearestHandle(n),this.tracking=e===this.minH?"lowValue":"highValue"),e.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(e),a=t.bind(this,this.dragging.active?this.onDragMove:this.onMove,e),s=t.bind(this,this.onEnd,a),i.on(r.moveEvent,a),i.one(r.endEvent,s),this.callOnStart()},onMove:function(e,i,o){var n,a=this.getEventPosition(i),s=this.options.rightToLeft?this.minValue:this.maxValue,r=this.options.rightToLeft?this.maxValue:this.minValue;0>=a?n=r:a>=this.maxPos?n=s:(n=this.offsetToValue(a),n=o&&t.isNumber(this.options.showTicks)?this.roundStep(n,this.options.showTicks):this.roundStep(n)),this.positionTrackingHandle(n)},onEnd:function(t,e){var o=this.getEventNames(e).moveEvent;this.options.keyboardSupport||(this.minH.removeClass("rz-active"),this.maxH.removeClass("rz-active"),this.tracking=""),this.dragging.active=!1,i.off(o,t),this.callOnEnd()},onTickClick:function(t,e){this.onMove(t,e,!0)},onPointerFocus:function(e,i){this.tracking=i,e.one("blur",t.bind(this,this.onPointerBlur,e)),e.on("keydown",t.bind(this,this.onKeyboardEvent)),e.on("keyup",t.bind(this,this.onKeyUp)),this.firstKeyDown=!0,e.addClass("rz-active")},onKeyUp:function(){this.firstKeyDown=!0,this.callOnEnd()},onPointerBlur:function(t){t.off("keydown"),t.off("keyup"),this.tracking="",t.removeClass("rz-active")},getKeyActions:function(t){var e=t+this.step,i=t-this.step,o=t+this.valueRange/10,n=t-this.valueRange/10,a={UP:e,DOWN:i,LEFT:i,RIGHT:e,PAGEUP:o,PAGEDOWN:n,HOME:this.minValue,END:this.maxValue};return this.options.rightToLeft&&(a.LEFT=e,a.RIGHT=i,this.options.vertical&&(a.UP=i,a.DOWN=e)),a},onKeyboardEvent:function(t){var i=this[this.tracking],o=t.keyCode||t.which,n={38:"UP",40:"DOWN",37:"LEFT",39:"RIGHT",33:"PAGEUP",34:"PAGEDOWN",36:"HOME",35:"END"},a=this.getKeyActions(i),s=n[o],r=a[s];if(null!=r&&""!==this.tracking){t.preventDefault(),this.firstKeyDown&&(this.firstKeyDown=!1,this.callOnStart());var l=this;e(function(){var t=l.roundStep(l.sanitizeValue(r));if(l.options.draggableRangeOnly){var e,i,o=l.highValue-l.lowValue;"lowValue"===l.tracking?(e=t,i=t+o,i>l.maxValue&&(i=l.maxValue,e=i-o)):(i=t,e=t-o,e<l.minValue&&(e=l.minValue,i=e+o)),l.positionTrackingBar(e,i)}else l.positionTrackingHandle(t)})}},onDragStart:function(t,e,i){var o=this.getEventPosition(i);this.dragging={active:!0,value:this.offsetToValue(o),difference:this.highValue-this.lowValue,lowLimit:this.options.rightToLeft?this.minH.rzsp-o:o-this.minH.rzsp,highLimit:this.options.rightToLeft?o-this.maxH.rzsp:this.maxH.rzsp-o},this.onStart(t,e,i)},getValue:function(t,e,i,o){var n=this.options.rightToLeft,a=null;return a="min"===t?i?o?n?this.minValue:this.maxValue-this.dragging.difference:n?this.maxValue-this.dragging.difference:this.minValue:n?this.offsetToValue(e+this.dragging.lowLimit):this.offsetToValue(e-this.dragging.lowLimit):i?o?n?this.minValue+this.dragging.difference:this.maxValue:n?this.maxValue:this.minValue+this.dragging.difference:n?this.offsetToValue(e+this.dragging.lowLimit)+this.dragging.difference:this.offsetToValue(e-this.dragging.lowLimit)+this.dragging.difference,this.roundStep(a)},onDragMove:function(t,e){var i,o,n,a,s,r,l,c,u=this.getEventPosition(e);if(this.options.rightToLeft?(n=this.dragging.lowLimit,a=this.dragging.highLimit,l=this.maxH,c=this.minH):(n=this.dragging.highLimit,a=this.dragging.lowLimit,l=this.minH,c=this.maxH),s=a>=u,r=u>=this.maxPos-n,s){if(0===l.rzsp)return;i=this.getValue("min",u,!0,!1),o=this.getValue("max",u,!0,!1)}else if(r){if(c.rzsp===this.maxPos)return;o=this.getValue("max",u,!0,!0),i=this.getValue("min",u,!0,!0)}else i=this.getValue("min",u,!1),o=this.getValue("max",u,!1);this.positionTrackingBar(i,o)},positionTrackingBar:function(t,e){this.lowValue=t,this.highValue=e,this.applyLowValue(),this.range&&this.applyHighValue(),this.applyModel(),this.updateHandles("lowValue",this.valueToOffset(t)),this.updateHandles("highValue",this.valueToOffset(e))},positionTrackingHandle:function(t){var e=!1;t=this.applyMinMaxLimit(t),this.range&&(t=this.applyMinMaxRange(t),"lowValue"===this.tracking&&t>this.highValue?(this.options.noSwitching&&this.highValue!==this.minValue?t=this.applyMinMaxRange(this.highValue):(this.lowValue=this.highValue,this.applyLowValue(),this.updateHandles(this.tracking,this.maxH.rzsp),this.updateAriaAttributes(),this.tracking="highValue",this.minH.removeClass("rz-active"),this.maxH.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(this.maxH)),e=!0):"highValue"===this.tracking&&t<this.lowValue&&(this.options.noSwitching&&this.lowValue!==this.maxValue?t=this.applyMinMaxRange(this.lowValue):(this.highValue=this.lowValue,this.applyHighValue(),this.updateHandles(this.tracking,this.minH.rzsp),this.updateAriaAttributes(),this.tracking="lowValue",this.maxH.removeClass("rz-active"),this.minH.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(this.minH)),e=!0)),this[this.tracking]!==t&&(this[this.tracking]=t,"lowValue"===this.tracking?this.applyLowValue():this.applyHighValue(),this.updateHandles(this.tracking,this.valueToOffset(t)),this.updateAriaAttributes(),e=!0),e&&this.applyModel()},applyMinMaxLimit:function(t){return null!=this.options.minLimit&&t<this.options.minLimit?this.options.minLimit:null!=this.options.maxLimit&&t>this.options.maxLimit?this.options.maxLimit:t},applyMinMaxRange:function(t){var e="lowValue"===this.tracking?this.highValue:this.lowValue,i=Math.abs(t-e);return null!=this.options.minRange&&i<this.options.minRange?"lowValue"===this.tracking?this.highValue-this.options.minRange:this.lowValue+this.options.minRange:null!=this.options.maxRange&&i>this.options.maxRange?"lowValue"===this.tracking?this.highValue-this.options.maxRange:this.lowValue+this.options.maxRange:t},applyModel:function(){this.internalChange=!0,this.scope.$apply(),this.callOnChange(),this.internalChange=!1},callOnStart:function(){if(this.options.onStart){var t=this,e="lowValue"===this.tracking?"min":"max";this.scope.$evalAsync(function(){t.options.onStart(t.options.id,t.scope.rzSliderModel,t.scope.rzSliderHigh,e)})}},callOnChange:function(){if(this.options.onChange){var t=this,e="lowValue"===this.tracking?"min":"max";this.scope.$evalAsync(function(){t.options.onChange(t.options.id,t.scope.rzSliderModel,t.scope.rzSliderHigh,e)})}},callOnEnd:function(){if(this.options.onEnd){var t=this,e="lowValue"===this.tracking?"min":"max";this.scope.$evalAsync(function(){t.options.onEnd(t.options.id,t.scope.rzSliderModel,t.scope.rzSliderHigh,e);
})}this.scope.$emit("slideEnded")}},r}]).directive("rzslider",["RzSlider",function(t){return{restrict:"AE",replace:!0,scope:{rzSliderModel:"=?",rzSliderHigh:"=?",rzSliderOptions:"&?",rzSliderTplUrl:"@"},templateUrl:function(t,e){return e.rzSliderTplUrl||"rzSliderTpl.html"},link:function(e,i){e.slider=new t(e,i)}}}]);return e.run(["$templateCache",function(t){t.put("rzSliderTpl.html",'<div class=rzslider><span class=rz-bar-wrapper><span class=rz-bar></span></span> <span class=rz-bar-wrapper><span class="rz-bar rz-selection" ng-style=barStyle></span></span> <span class="rz-pointer rz-pointer-min" ng-style=minPointerStyle></span> <span class="rz-pointer rz-pointer-max" ng-style=maxPointerStyle></span> <span class="rz-bubble rz-limit rz-floor"></span> <span class="rz-bubble rz-limit rz-ceil"></span> <span class=rz-bubble></span> <span class=rz-bubble></span> <span class=rz-bubble></span><ul ng-show=showTicks class=rz-ticks><li ng-repeat="t in ticks track by $index" class=rz-tick ng-class="{\'rz-selected\': t.selected}" ng-style=t.style ng-attr-uib-tooltip="{{ t.tooltip }}" ng-attr-tooltip-placement={{t.tooltipPlacement}} ng-attr-tooltip-append-to-body="{{ t.tooltip ? true : undefined}}"><span ng-if="t.value != null" class=rz-tick-value ng-attr-uib-tooltip="{{ t.valueTooltip }}" ng-attr-tooltip-placement={{t.valueTooltipPlacement}}>{{ t.value }}</span> <span ng-if="t.legend != null" class=rz-tick-legend>{{ t.legend }}</span></li></ul></div>')}]),e}),angular.module("infinite-scroll",[]).value("THROTTLE_MILLISECONDS",null).directive("infiniteScroll",["$rootScope","$window","$interval","THROTTLE_MILLISECONDS",function(t,e,i,o){return{scope:{infiniteScroll:"&",infiniteScrollContainer:"=",infiniteScrollDistance:"=",infiniteScrollDisabled:"=",infiniteScrollUseDocumentBottom:"=",infiniteScrollListenForEvent:"@"},link:function(n,a,s){var r,l,c,u,d,p,h,g,f,m,v,w,_,b,y,$,k,S,C;return C=angular.element(e),b=null,y=null,c=null,u=null,v=!0,S=!1,k=null,l=!1,m=function(t){return t=t[0]||t,isNaN(t.offsetHeight)?t.document.documentElement.clientHeight:t.offsetHeight},w=function(t){if(t[0].getBoundingClientRect&&!t.css("none"))return t[0].getBoundingClientRect().top+_(t)},_=function(t){return t=t[0]||t,isNaN(window.pageYOffset)?t.document.documentElement.scrollTop:t.ownerDocument.defaultView.pageYOffset},f=function(){var e,o,s,r,d;return u===C?(e=m(u)+_(u[0].document.documentElement),s=w(a)+m(a)):(e=m(u),o=0,void 0!==w(u)&&(o=w(u)),s=w(a)-o+m(a)),S&&(s=m((a[0].ownerDocument||a[0].document).documentElement)),r=s-e,d=r<=m(u)*b+1,d?(c=!0,y?n.$$phase||t.$$phase?n.infiniteScroll():n.$apply(n.infiniteScroll):void 0):(l&&i.cancel(l),c=!1)},$=function(t,e){var o,n,a;return a=null,n=0,o=function(){return n=(new Date).getTime(),i.cancel(a),a=null,t.call()},function(){var s,r;return s=(new Date).getTime(),r=e-(s-n),r<=0?(i.cancel(a),a=null,n=s,t.call()):a?void 0:a=i(o,r,1)}},null!=o&&(f=$(f,o)),n.$on("$destroy",function(){if(u.unbind("scroll",f),null!=k&&(k(),k=null),l)return i.cancel(l)}),h=function(t){return b=parseFloat(t)||0},n.$watch("infiniteScrollDistance",h),h(n.infiniteScrollDistance),p=function(t){if(y=!t,y&&c)return c=!1,f()},n.$watch("infiniteScrollDisabled",p),p(n.infiniteScrollDisabled),g=function(t){return S=t},n.$watch("infiniteScrollUseDocumentBottom",g),g(n.infiniteScrollUseDocumentBottom),r=function(t){if(null!=u&&u.unbind("scroll",f),u=t,null!=t)return u.bind("scroll",f)},r(C),n.infiniteScrollListenForEvent&&(k=t.$on(n.infiniteScrollListenForEvent,f)),d=function(t){if(null!=t&&0!==t.length){if(t.nodeType&&1===t.nodeType?t=angular.element(t):"function"==typeof t.append?t=angular.element(t[t.length-1]):"string"==typeof t&&(t=angular.element(document.querySelector(t))),null!=t)return r(t);throw new Error("invalid infinite-scroll-container attribute.")}},n.$watch("infiniteScrollContainer",d),d(n.infiniteScrollContainer||[]),null!=s.infiniteScrollParent&&r(angular.element(a.parent())),null!=s.infiniteScrollImmediateCheck&&(v=n.$eval(s.infiniteScrollImmediateCheck)),l=i(function(){return v&&f(),i.cancel(l)})}}}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="infinite-scroll"),function(t,e){"use strict";function i(){function t(t,i){return e.extend(Object.create(t),i)}function i(t,e){var i=e.caseInsensitiveMatch,o={originalPath:t,regexp:t},n=o.keys=[];return t=t.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)(\*\?|[\?\*])?/g,function(t,e,i,o){var a="?"===o||"*?"===o?"?":null,s="*"===o||"*?"===o?"*":null;return n.push({name:i,optional:!!a}),e=e||"",""+(a?"":e)+"(?:"+(a?e:"")+(s&&"(.+?)"||"([^/]+)")+(a||"")+")"+(a||"")}).replace(/([\/$\*])/g,"\\$1"),o.regexp=new RegExp("^"+t+"$",i?"i":""),o}var o={};this.when=function(t,n){var a=e.copy(n);if(e.isUndefined(a.reloadOnSearch)&&(a.reloadOnSearch=!0),e.isUndefined(a.caseInsensitiveMatch)&&(a.caseInsensitiveMatch=this.caseInsensitiveMatch),o[t]=e.extend(a,t&&i(t,a)),t){var s="/"==t[t.length-1]?t.substr(0,t.length-1):t+"/";o[s]=e.extend({redirectTo:t},i(s,a))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(t){return"string"==typeof t&&(t={redirectTo:t}),this.when(null,t),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(i,n,a,s,l,c,u){function d(t,e){var i=e.keys,o={};if(!e.regexp)return null;var n=e.regexp.exec(t);if(!n)return null;for(var a=1,s=n.length;a<s;++a){var r=i[a-1],l=n[a];r&&l&&(o[r.name]=l)}return o}function p(t){var o=y.current;w=m(),_=w&&o&&w.$$route===o.$$route&&e.equals(w.pathParams,o.pathParams)&&!w.reloadOnSearch&&!b,_||!o&&!w||i.$broadcast("$routeChangeStart",w,o).defaultPrevented&&t&&t.preventDefault()}function h(){var t=y.current,o=w;_?(t.params=o.params,e.copy(t.params,a),i.$broadcast("$routeUpdate",t)):(o||t)&&(b=!1,y.current=o,o&&o.redirectTo&&(e.isString(o.redirectTo)?n.path(v(o.redirectTo,o.params)).search(o.params).replace():n.url(o.redirectTo(o.pathParams,n.path(),n.search())).replace()),s.when(o).then(g).then(function(n){o==y.current&&(o&&(o.locals=n,e.copy(o.params,a)),i.$broadcast("$routeChangeSuccess",o,t))},function(e){o==y.current&&i.$broadcast("$routeChangeError",o,t,e)}))}function g(t){if(t){var i=e.extend({},t.resolve);e.forEach(i,function(t,o){i[o]=e.isString(t)?l.get(t):l.invoke(t,null,null,o)});var o=f(t);return e.isDefined(o)&&(i.$template=o),s.all(i)}}function f(t){var i,o;return e.isDefined(i=t.template)?e.isFunction(i)&&(i=i(t.params)):e.isDefined(o=t.templateUrl)&&(e.isFunction(o)&&(o=o(t.params)),e.isDefined(o)&&(t.loadedTemplateUrl=u.valueOf(o),i=c(o))),i}function m(){var i,a;return e.forEach(o,function(o,s){!a&&(i=d(n.path(),o))&&(a=t(o,{params:e.extend({},n.search(),i),pathParams:i}),a.$$route=o)}),a||o[null]&&t(o[null],{params:{},pathParams:{}})}function v(t,i){var o=[];return e.forEach((t||"").split(":"),function(t,e){if(0===e)o.push(t);else{var n=t.match(/(\w+)(?:[?*])?(.*)/),a=n[1];o.push(i[a]),o.push(n[2]||""),delete i[a]}}),o.join("")}var w,_,b=!1,y={routes:o,reload:function(){b=!0;var t={defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0,b=!1}};i.$evalAsync(function(){p(t),t.defaultPrevented||h()})},updateParams:function(t){if(!this.current||!this.current.$$route)throw r("norout","Tried updating route when with no current route");t=e.extend({},this.current.params,t),n.path(v(this.current.$$route.originalPath,t)),n.search(t)}};return i.$on("$locationChangeStart",p),i.$on("$locationChangeSuccess",h),y}]}function o(){this.$get=function(){return{}}}function n(t,i,o){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(n,a,s,r,l){function c(){h&&(o.cancel(h),h=null),d&&(d.$destroy(),d=null),p&&(h=o.leave(p),h.then(function(){h=null}),p=null)}function u(){var s=t.current&&t.current.locals,r=s&&s.$template;if(e.isDefined(r)){var u=n.$new(),h=t.current,m=l(u,function(t){o.enter(t,null,p||a).then(function(){!e.isDefined(g)||g&&!n.$eval(g)||i()}),c()});p=m,d=h.scope=u,d.$emit("$viewContentLoaded"),d.$eval(f)}else c()}var d,p,h,g=s.autoscroll,f=s.onload||"";n.$on("$routeChangeSuccess",u),u()}}}function a(t,e,i){return{restrict:"ECA",priority:-400,link:function(o,n){var a=i.current,s=a.locals;n.html(s.$template);var r=t(n.contents());if(a.controller){s.$scope=o;var l=e(a.controller,s);a.controllerAs&&(o[a.controllerAs]=l),n.data("$ngControllerController",l),n.children().data("$ngControllerController",l)}o[a.resolveAs||"$resolve"]=s,r(o)}}}var s=e.module("ngRoute",["ng"]).provider("$route",i),r=e.$$minErr("ngRoute");s.provider("$routeParams",o),s.directive("ngView",n),s.directive("ngView",a),n.$inject=["$route","$anchorScroll","$animate"],a.$inject=["$compile","$controller","$route"]}(window,window.angular);var app=angular.module("myApp",["myApp.filters","myApp.services","myApp.directives","ngRoute","infinite-scroll","rzModule","ngCookies","angulartics","angulartics.google.analytics","angulartics.facebook.pixel","ezfb","vcRecaptcha","angularModalService","angular-img-cropper"]);app.config(["$routeProvider","$locationProvider",function(t,e){t.when("/gifts/:list/",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:list/",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/:list/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:list/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/:list/sort/:sort",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:list/sort/:sort",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/:parent_list/:list/",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:parent_list/:list/",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/:parent_list/:list",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:parent_list/:list",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/:parent_list/:list/sort/:sort",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:parent_list/:list/sort/:sort",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/:list/sort/:sort/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:list/sort/:sort/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/:parent_list/:list/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/sort/:sort/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/sort/:sort/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/gifts/sort/:sort",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/sort/:sort",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/:country/gifts/:parent_list/:list/page/:page",{templateUrl:"partials/gifts",controller:GiftsCtrl,default_sort:"clicks_score_amazon_available"}).when("/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/"}).when("/uk/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/",international_canonical_path:"/uk/",country:"uk"}).when("/ca/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/",international_canonical_path:"/ca/",country:"ca"}).when("/!/",{redirectTo:"/"}).when("/{{::og.image}}/",{redirectTo:"/"}).when("/page/:page",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/"}).when("/uk/page/:page",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/",international_canonical_path:"/uk/",country:"uk"}).when("/ca/page/:page",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/",international_canonical_path:"/ca/",country:"ca"}).when("/new/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/new/"}).when("/uk/new/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/new/",international_canonical_path:"/uk/new/",country:"uk"}).when("/ca/new/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/new/",international_canonical_path:"/ca/new/",country:"ca"}).when("/new/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/new/"}).when("/uk/new/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/new/",international_canonical_path:"/uk/new/",country:"uk"}).when("/ca/new/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"new",canonical_path:"/new/",international_canonical_path:"/ca/new/",country:"ca"}).when("/popular/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/popular/"}).when("/all-time-popular/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_all",canonical_path:"/popular/"}).when("/uk/popular/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/popular/",international_canonical_path:"/uk/popular/",country:"uk"}).when("/ca/popular/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/popular/",international_canonical_path:"/ca/popular/",country:"ca"}).when("/popular/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/popular/"}).when("/uk/popular/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/popular/",international_canonical_path:"/uk/popular/"}).when("/ca/popular/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/popular/",international_canonical_path:"/ca/popular/"}).when("/random/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"random",canonical_path:"/random/"}).when("/over1k/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"over1k",canonical_path:"/over1k/"}).when("/wctr/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_week",canonical_path:"/wctr/"}).when("/mctr/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"clicks_score_month",canonical_path:"/mctr/"}).when("/uk/random/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"random",canonical_path:"/random/",international_canonical_path:"/uk/random/",country:"uk"}).when("/ca/random/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"random",canonical_path:"/random/",international_canonical_path:"/ca/random/",country:"ca"}).when("/random/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"random",canonical_path:"/random/"}).when("/uk/random/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"random",canonical_path:"/random/",international_canonical_path:"/uk/random/"}).when("/ca/random/page/:page/",{templateUrl:"partials/list-header",controller:IndexCtrl,default_sort:"random",canonical_path:"/random/",international_canonical_path:"/ca/random/"}).when("/wishlisted-price/:sort?",{templateUrl:"partials/list-slider",controller:PriceCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/wishlisted-price/"}).when("/:country/wishlisted-price/:sort?",{templateUrl:"partials/list-slider",controller:PriceCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/wishlisted-price/"}).when("/wishlisted-price/page/:page/",{templateUrl:"partials/list-slider",controller:PriceCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/wishlisted-price/"}).when("/:country/wishlisted-price/page/:page/",{templateUrl:"partials/list-slider",controller:PriceCtrl,default_sort:"clicks_score_amazon_available",canonical_path:"/wishlisted-price/"}).when("/wishlist/:user_id?",{templateUrl:"partials/list-wishlist",controller:WishlistCtrl,default_sort:"new"}).when("/search/:search_term",{templateUrl:"partials/list-search",controller:SearchCtrl,reloadOnSearch:!1}).when("/search/",{redirectTo:"/"}).when("/login/",{templateUrl:"partials/login",controller:LogInCtrl}).when("/logout/",{templateUrl:"partials/login",controller:LogOutCtrl}).when("/register/",{templateUrl:"partials/register",controller:RegisterCtrl}).when("/404/",{templateUrl:"partials/404",controller:ErrorCtrl}).when("/about/",{templateUrl:"partials/about",controller:ContactCtrl}).when("/privacy-policy/",{templateUrl:"partials/privacy",controller:SimpleCtrl}).when("/profile/",{templateUrl:"partials/profile",controller:ProfileCtrl}).when("/forgot/",{templateUrl:"partials/forgot",controller:ForgotCtrl}).when("/product-pitch-terms-and-conditions/",{templateUrl:"partials/terms",controller:SimpleCtrl}).when("/ssna/",{redirectTo:"/product-pitch"}).when("/product-pitch",{templateUrl:"partials/advertising",controller:Advertising}).when("/product-pitch/create/:temp_id/:creative",{templateUrl:"partials/creative",controller:CreativeCtrl}).when("/product-pitch/creative/:creative",{templateUrl:"partials/creative",controller:CreativeCtrl}).when("/product-pitch/confirmation/:campaign",{templateUrl:"partials/confirmation",controller:ConfirmationCtrl}).when("/product-pitch/payment/:campaign",{templateUrl:"partials/payment",controller:PaymentCtrl}).when("/product-pitch/dashboard/",{templateUrl:"partials/dashboard",controller:DashboardCtrl}).when("/product-pitch/admin-dashboard/",{templateUrl:"partials/admin-dashboard",controller:DashboardCtrl,global:!0}).when("/product-pitch/dropoffs/",{templateUrl:"partials/dropoffs",controller:DropoffsCtrl}).when("/product-pitch/dropoffs/:page",{templateUrl:"partials/dropoffs",controller:DropoffsCtrl}).when("/product-pitch/creative/:creative/edit/",{templateUrl:"partials/creative-crud",controller:CreativeCtrl}).when("/promo-setup/",{templateUrl:"partials/editorial-setup",controller:EditorialSetupCtrl}).when("/admin/approve/",{templateUrl:"partials/admin-approve",controller:AdminApproveCtrl}).when("/unlisted-content/:id/",{templateUrl:"partials/unlisted-content",controller:UnlistedContentCtrl}).when("/submit/",{redirectTo:"/product-pitch"}).when("/reset/:reset_code",{templateUrl:"partials/reset",controller:ResetCtrl}).when("/confirm-subscribe/:code/",{templateUrl:"partials/confirm-subscription",controller:ConfirmSubscriptionCtrl}).when("/blog/",{templateUrl:"partials/blog",controller:BlogCtrl}).when("/:slug/boost",{templateUrl:"partials/boost",controller:BoostCtrl}).when("/admin/boosted-checklist",{templateUrl:"partials/admin-boost-checklist",controller:AdminBoostChecklistCtrl}).when("/aff/",{templateUrl:"partials/affiliates",controller:AffiliateCtrl}).when("/blog/:slug",{templateUrl:"partials/blog-post",controller:BlogPostCtrl}).when("/shop-instagram/",{templateUrl:"partials/list-instagram",controller:IndexCtrl,default_sort:"instagram",canonical_path:"/shop-instagram"}).when("/giveaways/",{templateUrl:"partials/giveaway-list",controller:GiveawayListCtrl}).when("/giveaways/:page",{templateUrl:"partials/giveaway-list",controller:GiveawayListCtrl}).when("/:slug/",{templateUrl:"partials/post",controller:PostCtrl}).when("/uk/:slug/",{templateUrl:"partials/post",controller:PostCtrl,country:"uk"}).when("/ca/:slug/",{templateUrl:"partials/post",controller:PostCtrl,country:"ca"}).when("/giveaway/:slug",{templateUrl:"partials/giveaway",controller:GiveawayCtrl}).when("/admin/pitchpost/",{templateUrl:"partials/pitchpost",controller:PitchPostCtrl}).otherwise({redirectTo:"/"}),e.html5Mode(!0)}]),angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",100),app.config(["$httpProvider",function(t){t.interceptors.push(["$q",function(t){return{responseError:function(e){var i=t.defer();return i.reject(e),i.promise}}}])}]),app.config(["ezfbProvider",function(t){t.setInitParams({appId:"156176611132582"})}]),app.run(["$rootScope","$timeout",function(t,e){t.$watch(function(){e(function(){if("undefined"!=typeof dataLayer){var t=$("body").attr("data-country");"US"!=t&&"us"!=t||dataLayer.push({event:"optimize.activate"})}},0,!1)})}]),angular.module("myApp").controller("ModifyWishlistCtrl",ModifyWishlistCtrl),angular.module("myApp").controller("GiveawayEntryCtrl",GiveawayEntryCtrl),angular.module("myApp").controller("GiveawayEntryModalCtrl",GiveawayEntryModalCtrl),angular.module("myApp").controller("NewsletterCTACtrl",NewsletterCTACtrl),angular.module("myApp").controller("ModifyAdWishlistCtrl",ModifyAdWishlistCtrl),angular.module("myApp").controller("LoginRegisterModalCtrl",LoginRegisterModalCtrl),angular.module("myApp").controller("PurchaseNotificationCtrl",PurchaseNotificationCtrl),angular.module("myApp").controller("SearchPartialCtrl",SearchPartialCtrl),angular.module("myApp").controller("SimpleCtrl",SimpleCtrl),angular.module("myApp").controller("DisapproveModalCtrl",DisapproveModalCtrl);var app=angular.module("myApp.directives",[]);app.directive("keepScrollPos",["$route","$window","$timeout","$location","$anchorScroll",function(t,e,i,o,n){var a={},s={};return function(r,l,c){r.$on("$routeChangeStart",function(){t.current&&(a[JSON.stringify(t.current.params)]=e.pageYOffset,s[JSON.stringify(t.current.params)]=r.p)}),r.$on("$routeChangeSuccess",function(){function l(){var t=!1,o=Math.abs(e.pageYOffset-c);return o<.1?(t=!0,void i(function(){r.scrollingFinished=!0},1e3)):void(t||(e.scrollTo(0,c),i(l,200)))}if(o.hash())n();else{r.scrollingFinished=!1;var c=a[JSON.stringify(t.current.params)]||0,u=s[JSON.stringify(t.current.params)];u&&u>2&&(r.skeletonPages=parseInt(u)-2),l()}})}}]),app.directive("storeLastUrl",["$route","$window","$timeout","$location","$anchorScroll",function(t,e,i,o,n){return function(t,e,i){t.$on("$locationChangeStart",function(t,e,i){window.referrer_url=i})}}]),app.directive("wishlist",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$rootScope",function(e,i,o,n){e.$watch("posts",function(i){if(n.is_logged_in){var o=[];e.post&&!e.post.checked_for_save&&(o.push(e.post.id),e.post.checked_for_save=!0),n.featured_post&&!n.featured_post.checked_for_save&&(o.push(n.featured_post.id),n.featured_post.checked_for_save=!0,console.log("Checking featured post save "+n.featured_post.id)),angular.forEach(i,function(t,e){t.checked_for_save||0==t.id||(o.push(t.id),t.checked_for_save=!0)}),!o||o.length<1||t({method:"POST",url:"/api/user/wishlist",data:{post_ids:o}}).success(function(t){"success"!=t.meta.status||angular.forEach(t.posts,function(t,i){angular.forEach(e.posts,function(e,i){t.post_id==e.id&&(e.saved=!0)}),n.featured_post&&n.featured_post.id==t.post_id&&(n.featured_post.saved=!0),e.post&&t.post_id==e.post.id&&(e.post.saved=!0)})})}},!0)}]}}]),app.directive("adWishlist",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$rootScope",function(e,i,o,n){e.$watch("native_ads",function(i){if(n.is_logged_in&&e.native_ads){var o=[];angular.forEach(e.native_ads,function(t,e){t.checked_for_save||(o.push(t.id),t.checked_for_save=!0)}),t({method:"POST",url:"/api/user/ad_wishlist",data:{ad_ids:o}}).success(function(t){"success"!=t.meta.status||angular.forEach(t.ads,function(t,i){angular.forEach(e.native_ads,function(e,i){t.ad_id==e.id&&(e.saved=!0)})})})}},!0)}]}}]),app.directive("nativeAd",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$rootScope",function(t,e,i,o){function n(e){if(t.show_native&&t.native_ads_container&&t.native_ads_container.length>0&&t.native_ads&&t.native_ads.length>0){if(t.native_ad_count>=t.native_ads.length)return;angular.forEach(t.posts,function(e,i){1==e.native_ad&&!e.has_content&&t.native_ads[e.ad_id]&&(t.native_ads[e.ad_id].type="ad",t.native_ads[e.ad_id].ad=!0,t.native_ads[e.ad_id].page=e.page,t.native_ads[e.ad_id].has_content=!0,t.posts[i]=t.native_ads[e.ad_id],t.native_ad_count+=1)})}}t.$watch("native_ads",n,!0),t.$watch("native_ads_container",n,!0),t.native_ad_count=0}]}}]),app.directive("affiliate",["$http",function(t){return{restrict:"E",controller:["$scope","$rootScope","$timeout","$document","$cookies","$analytics",function(t,e,i,o,n,a){function s(t){for(var e=null,i=[],o=location.search.substr(1).split("&"),n=0;n<o.length;n++)i=o[n].split("="),i[0]===t&&(e=decodeURIComponent(i[1]));return e}function r(){t.Session&&e.auth_finished?l():i(r,50)}function l(){var i=n.get("scroll");if(i)return t.Scroll=i,void a.eventTrack("scroll",{category:"scroll",label:"scroll"});if(s("scroll")||s("v")){if(e.is_logged_in&&426221==e.user_id);else if("returning"==t.Session.session_type)return;var o=s("scroll");if("y"==s("scroll"))o="x02",a.eventTrack("scroll",{category:"scroll",label:"scroll"});else{if("dlc3"!=s("v"))return;o="x03",a.eventTrack("dlc3",{category:"dlc3",label:"dlc3"})}var r=new Date;visited_cookie_expiry=new Date(r.getFullYear(),r.getMonth(),r.getDate()+30),n.put("scroll",o,{expires:visited_cookie_expiry}),t.Scroll=o}}"n"==s("scroll")&&(t.disable_infinite_scroll=!0,console.log("DISABLED INFINITE SCROLL")),t.Scroll||r()}]}}]),app.directive("session",["$http",function(t){return{restrict:"E",controller:["$scope","$rootScope","$timeout","$document","$cookies",function(t,e,i,o,n){function a(t){for(var e=null,i=[],o=location.search.substr(1).split("&"),n=0;n<o.length;n++)i=o[n].split("="),i[0]===t&&(e=decodeURIComponent(i[1]));return e}function s(){return a("utm_campaign")?"newsletter_"+a("utm_campaign"):a("utm_source")?a("utm_source"):document.referrer?(url=document.referrer,ref=url.match(/:\/\/(.[^\/]+)/)[1],ref):"direct"}function r(){var e=n.get("visited"),i=e?"returning":"first time";if(!e){var o=new Date;visited_cookie_expiry=new Date(o.getFullYear()+10,o.getMonth(),o.getDate()),n.put("visited","1",{expires:visited_cookie_expiry}),t.first_time_viewer=!0}return i}if(!t.Session){var l=n.getObject("subtag_session_v2");if(l)return t.Session=l,void(e.Session=t.Session);var c={};c.referrer=s(),c.session_type=r();var u=new Date;session_cookie_expiry=new Date(u.getFullYear(),u.getMonth(),u.getDate()),session_cookie_expiry.setTime(u.getTime()+864e5),n.putObject("subtag_session_v2",c,{expires:session_cookie_expiry}),t.Session=c,e.Session=t.Session}}]}}]),app.directive("trackingSession",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$cookies","$rootScope",function(e,i,o,n,a,s){function r(){e.Session?l():i(r,250)}function l(){var i=a.getObject("session_id_v2"),o=a.getObject("user_id");return i?(s.tracking_session_id=i,void(s.tracking_user_id=o)):void t({method:"POST",url:"/api/user/sessionid",data:{device:navigator.userAgent,referrer:e.Session.referrer,device_width:window.screen.width,device_height:window.screen.height,user_id:o}}).success(function(t){var e=new Date;session_cookie_expiry=new Date(e.getFullYear(),e.getMonth(),e.getDate()),session_cookie_expiry.setTime(e.getTime()+864e5),s.tracking_session_id=t.session_id,a.putObject("session_id_v2",t.session_id,{expires:session_cookie_expiry});var e=new Date;user_id_cookie_expiry=new Date(e.getFullYear()+10,e.getMonth(),e.getDate()),a.put("user_id",t.user_id,{expires:user_id_cookie_expiry})})}r()}]}}]),app.directive("subtag",["$http",function(t){return{restrict:"E",controller:["$scope","$rootScope","$timeout","$document","$location",function(e,i,o,n,a){function s(){e.Session?r():o(s,50)}function r(){t({method:"GET",url:"/api/subtag",params:{session:e.Session.session_type,referrer:e.Session.referrer,prev_url:window.referrer_url?window.referrer_url:document.referrer,current_url:a.path()}}).success(function(t){e.subtag=t.subtag,i.subtag=t.subtag,l(e.posts),e.banner&&c(e.banner),e.post&&l(e.post)})}function l(t){e.subtag&&t&&(t.constructor!==Array&&(t={0:t}),angular.forEach(t,function(t,i){if(!(t.subtagged||t.ad||t.ghost||"post"!=t.type&&"banner"!=t.type)){var o=e.subtag;o=o.replace("P000000",t.id.toString(36)),o=o.replace("P0",t.id.toString(36)),e.subtagOptimizeMeta&&(o+="_"+e.subtagOptimizeMeta.toString()),t.link=t.link.replace(/ascsubtag=(.*)$/,"ascsubtag="+o),e.Scroll&&(t.link=t.link.replace("x01",e.Scroll)),t.subtagged=!0}}))}function c(t){e.subtag&&t&&(t.constructor!==Array&&(t={0:t}),angular.forEach(t,function(t,o){if(!t.subtagged){var n=i.subtag;e.subtagOptimizelyMeta&&(n+="_"+e.subtagOptimizelyMeta),t.link=t.link.replace(/ascsubtag=(.*)$/,"ascsubtag="+n),e.Scroll&&(t.link=t.link.replace("x01",e.Scroll)),t.subtagged=!0}}))}function u(){e.subtag&&e.posts&&e.sort&&(console.log("Subtag sort "+e.sort),angular.forEach(e.posts,function(t,i){if(t.link){var o=e.sort_codes[e.sort];o||(o="unkown"),t.link=t.link.replace(/-srt(.*)-/,"-srt"+o+"-")}}))}s(),e.$watch("posts",l,!0),e.$watch("post",l,!0),e.$watch("banner",c,!0),window.apply_subtags=l,window.apply_subtags_simple=c,e.$watch("posts",u,!0),e.$watch("sort",u,!0),window.apply_subtag_sort=u,e.sort_codes={"new":1,high:2,low:3,random:4,clicks_score_amazon_available:5,clicks_score_week_amazon_available:6,clicks_score_week_amazon:7,clicks_score_week:8,clicks_score_week_weighted_amazon_available:9,related_items_clicks_score_amazon_available:10,instagram:11}}]}}]),app.directive("ghosts",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location",function(t,e,i,o){}]}}]),app.directive("schemaOrg",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location",function(t,e,i,o){function n(e){e&&(t.productSchema={"@context":"http://schema.org","@type":"Product",image:e.image,name:e.title},e.price&&(t.productSchema.offers={"@type":"Offer",price:e.price,priceCurrency:"USD"}))}t.$watch("post",n,!0)}]}}]),app.directive("jsonld",["$filter","$sce",function(t,e){return{restrict:"E",template:function(){return'<script type="application/ld+json" ng-bind-html="onGetJson()"></script>'},scope:{json:"=json"},link:function(i,o,n){i.onGetJson=function(){return e.trustAsHtml(t("json")(i.json))}},replace:!0}}]),app.directive("addthisToolbox",["$timeout",function(t){return{restrict:"A",transclude:!0,replace:!0,template:"<div ng-transclude></div>",link:function(e,i,o){function n(){addthis.init(),addthis.layers&&"function"==typeof addthis.layers.refresh&&addthis.layers.refresh(),addthis.toolbox($(i).get())}t(n,500)}}}]),app.directive("stickyDetails",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$interval",function(t,e,i,o,n){function a(){t.ready?$("#page .flex-details.details").length&&window.innerWidth>990&&s():e(a,1500)}function s(){var t=$("#page .flex-details.details"),e=$(window),i=t.offset(),o=184,n=$("article.post .flex-image"),a=n.offset().top+n.height();e.bind("scroll",function(){
$(window).width()<800||(e.scrollTop()>i.top?e.scrollTop()+o<a-t.height()?t.css("margin-top",e.scrollTop()-i.top+o+"px"):t.offset().top+t.height()>a-t.height()&&(t.stop(),t.css("margin-top",a-t.height()-o+"px")):t.css("margin-top","0px"))})}a();var r;t.$on("$routeChangeStart",function(){n.cancel(r),$(window).unbind("scroll")})}]}}]),app.directive("optimize",["$route","$window","$timeout","$interval",function(t,e,i,o){return{restrict:"E",controller:["$scope","$element","$attrs",function(t,e,i){t.$on("$routeChangeStart",function(){window.OptimizeMetaInterval&&o.cancel(window.OptimizeMetaInterval)}),t.$on("$viewContentLoaded",function(){window.OptimizeMetaInterval=o(function(){var e="UA-2572246-9";if(window.gaData&&window.gaData[e]&&window.gaData[e].experiments){var i=Object.keys(window.gaData[e].experiments)[0],n=window.gaData[e].experiments[i];if(t.subtag&&!t.optimizeSubtagged){var a="exp."+i.toString().replace(/_/g,"")+"var."+n.toString();a=a.toString(),console.log("Optimize meta info:"),console.log(a),a&&(o.cancel(window.OptimizeMetaInterval),t.subtagOptimizeMeta=a,t.optimizeSubtagged=!0,angular.forEach(t.posts,function(t,e){t.subtagged=!1}),$rootScope.banner&&$rootScope.banner.link&&!t.optimize_tagged_banner&&$rootScope.banner.link.indexOf("amazon.com")!==-1&&(t.optimize_tagged_banner=!0,$rootScope.banner.link+="_"+t.subtagOptimizeMeta),t.post&&(t.post.subtagged=!1),$(".localize-done").removeClass("localize-done"),window.apply_subtags(),window.localize(),window.optimize_subtag_finished=!0)}}},200)})}]}}]),app.directive("localize",["$route","$window","$timeout",function(t,e,i){return{restrict:"E",controller:["$scope","$element","$attrs","$rootScope",function(t,e,o,n){function a(t){function e(){$("body").attr("data-country")?s(t):i(e,150)}e()}function s(e){t.subtag?r($("body").attr("data-country"),e):i(s,150)}function r(e,i){var o=$(".localize:not(.localize-done)");if(angular.forEach(o,function(i,o){var n=$(i).attr("data-"+e.toLowerCase()+"-href");n||"uk"!=e.toLowerCase()||(n=$(i).attr("data-gb-href")),n||"gb"!=e.toLowerCase()||(n=$(i).attr("data-uk-href")),n&&$(i).attr("href",n);var a=t.subtag;t.subtagOptimizeMeta&&(a+="_"+t.subtagOptimizeMeta.toString()),$(i).attr("href",$(i).attr("href").replace(/ascsubtag=(.*)$/,"ascsubtag="+a)),$(i).addClass("localize-done"),t.Scroll&&$(i).attr("href",$(i).attr("href").replace("x01",t.Scroll))}),"US"!=e.toUpperCase()&&("CA"==e.toUpperCase()||"UK"==e.toUpperCase()||"GB"==e.toUpperCase())){var n=e.toLowerCase();"gb"==n&&(n="uk");var o=$(".auto-localize:not(.localize-done)");angular.forEach(o,function(t,e){$(t).attr("href").toLowerCase().indexOf("/ca/")===-1&&$(t).attr("href").toLowerCase().indexOf("/uk/")===-1&&($(t).attr("href","/"+n+$(t).attr("href")),$(t).addClass("localize-done"))}),angular.forEach(i,function(t,e){t&&(t.localized||(t.uri="/"+n+t.uri,t.localized=!0))})}}t.$on("$viewContentLoaded",a),t.$watch("posts",a,!0),t.$watch("post",a,!0),t.$watch("banner",a,!0),window.localize=a}]}}]),app.directive("adImpressions",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$interval","$rootScope","$cookieStore",function(e,i,o,n,a,s,r){window.ad_send_impressions=[],e.$on("$routeChangeStart",function(){window.ad_imp_timer&&a.cancel(window.ad_imp_timer)}),e.$on("$routeChangeSuccess",function(){window.ad_imp_timer=a(function(){e.native_ads&&angular.forEach(e.native_ads,function(i,o){if($("article div[data-nativead='"+i.id+"'] .image").visible(!0)){if(i.impression=!0,e.native_ad_impressions=r.get("native_ad_impressions"),e.native_ad_impressions&&e.native_ad_impressions[i.id])return;t({method:"POST",url:"/api/user/native_ad/tracking/impression/",data:{ad_id:i.id},headers:{"Content-Type":"application/json"}}).success(function(t){}),e.native_ad_impressions||(e.native_ad_impressions={}),e.native_ad_impressions[i.id]=!0,r.put("native_ad_impressions",e.native_ad_impressions)}})},250)})}]}}]),app.directive("editorialImpressions",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$interval","$rootScope",function(e,i,o,n,a,s){window.send_editorial_impressions=[],e.$on("$routeChangeStart",function(){window.editorial_imp_timer&&a.cancel(window.editorial_imp_timer)}),e.$on("$routeChangeSuccess",function(){window.editorial_imp_timer=a(function(){s.featured_post&&(s.featured_post.impression||!$("#paid-editorial-"+s.featured_post.id+" .paid-editorial-img .desktop-show img").visible(!1)&&!$("#paid-editorial-"+s.featured_post.id+" .paid-editorial-img .mobile-show img").visible(!1)||(s.featured_post.impression=!0,t({method:"POST",url:"/api/user/tracking",data:{post_id:s.featured_post.id,type:"impression-editorial",session_id:s.tracking_session_id},headers:{"Content-Type":"application/json"}}).success(function(t){})))},250)})}]}}]),app.directive("postpageImpressions",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$interval","$rootScope",function(e,i,o,n,a,s){window.send_postpage_impressions=[],e.$on("$routeChangeStart",function(){window.postpage_imp_timer&&a.cancel(window.postpage_imp_timer)}),e.$on("$routeChangeSuccess",function(){window.postpage_imp_timer=a(function(){e.post&&!e.post.impression&&$("#postpage-"+e.post.id+" img").visible(!1)&&(e.post.impression=!0,t({method:"POST",url:"/api/user/tracking",data:{post_id:e.post.id,type:"impression-postpage",session_id:s.tracking_session_id},headers:{"Content-Type":"application/json"}}).success(function(t){}))},250)})}]}}]),app.directive("bottomBannerImpressions",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$interval","$rootScope","$analytics",function(e,i,o,n,a,s,r){e.$on("$routeChangeStart",function(){window.bottom_banner_imp_timer&&a.cancel(window.bottom_banner_imp_timer)}),e.$on("$routeChangeSuccess",function(){window.bottom_banner_imp_timer=a(function(){s.bottom_banner&&!s.bottom_banner.impression&&$("#bottom-banner-"+s.bottom_banner.id+" a .image:visible").visible(!0)&&(s.bottom_banner.impression=!0,t({method:"POST",url:"/api/user/tracking",data:{post_id:s.bottom_banner.id,type:"impression-bottom-banner",session_id:s.tracking_session_id},headers:{"Content-Type":"application/json"}}).success(function(t){}))},250)})}]}}]),app.directive("impressions",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$interval","$rootScope",function(e,i,o,n,a,s){window.send_impressions=[],e.$on("$routeChangeStart",function(){window.imp_timer&&a.cancel(window.imp_timer),window.send_timer&&a.cancel(window.send_timer)}),e.$on("$routeChangeSuccess",function(){window.imp_timer=a(function(){e.track_impressions&&angular.forEach(e.posts,function(t,e){t.impression||$("article[data-post='"+t.id+"'] .image").visible(!1)&&(t.impression=!0,window.send_impressions.push(t.id))})},250),window.send_timer=a(function(){window.send_impressions.length<1||(t({method:"POST",url:"/api/user/tracking",data:{impressions:window.send_impressions,type:"impression",session_id:s.tracking_session_id},headers:{"Content-Type":"application/json"}}).success(function(t){}),send_impressions=[])},1e3)})}]}}]),app.directive("gdprCookieBanner",["$http","$rootScope","$cookies",function(t,e,i){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$timeout","$rootScope","$cookies",function(t,e,i,o,e,n,a){var s=$("body").attr("data-country"),r=["AD","AL","AT","AX","BA","BE","BG","BY","CH","CZ","DE","DK","EE","ES","FI","FO","FR","GB","UK","GG","GI","GR","HR","HU","IE","IM","IS","IT","JE","LI","LT","LU","LV","MC","MD","ME","MK","MT","NL","NO","PL","PT","RO","RS","RU","SE","SI","SJ","SK","SM","UA","VA"];if(r.indexOf(s)>-1){var l=a.get("hide_cookie_banner");l?n.show_cookie_banner=!1:n.show_cookie_banner=!0}else n.show_cookie_banner=!1;n.hide_cookie_banner=function(){var t=new Date,e=new Date(t.getFullYear()+10,t.getMonth(),t.getDate());a.put("hide_cookie_banner","true",{expires:e}),n.show_cookie_banner=!1}}]}}]),app.directive("bottomBanner",["$http","$rootScope","$cookies",function(t,e,i){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$timeout","$rootScope","$cookies",function(e,i,o,n,i,a,s){var r=n.absUrl();if(r.indexOf("/about")!==-1||r.indexOf("/product-pitch")!==-1)return a.show_bottom_banner=!1,void(a.show_newsletter_cta=!1);var l=$("body").attr("data-country"),c=["AD","AL","AT","AX","BA","BE","BG","BY","CH","CZ","DE","DK","EE","ES","FI","FO","FR","GB","UK","GG","GI","GR","HR","HU","IE","IM","IS","IT","JE","LI","LT","LU","LV","MC","MD","ME","MK","MT","NL","NO","PL","PT","RO","RS","RU","SE","SI","SJ","SK","SM","UA","VA"];return c.indexOf(l)>-1?void(a.show_bottom_banner=!1):(a.bottom_banner_finished=!1,t.get("/api/bottom-banner/").then(function(t){a.bottom_banner_finished=!0,a.bottom_banner=t.data.banner;var e=s.get("hide_bottom_banner"+a.bottom_banner.id);e?a.show_bottom_banner=!1:a.show_bottom_banner=!0,a.bottom_banner.link=a.bottom_banner.link.split("?")[0],a.bottom_banner.utm_campaign?a.bottom_banner.link+="?utm_source=thisiswhyimbroke.com&utm_medium=referral&utm_campaign="+a.bottom_banner.utm_campaign+"&utm_content=bottom":a.bottom_banner.link+="?utm_source=thisiswhyimbroke.com&utm_medium=referral&utm_campaign=feature&utm_content=bottom"},function(t){a.show_bottom_banner=!1,a.bottom_banner_finished=!0}),a.hide_bottom_banner=function(){var t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()+30);s.put("hide_bottom_banner"+a.bottom_banner.id,"true",{expires:e}),a.show_bottom_banner=!1},void e.$on("$routeChangeSuccess",function(){i(function(){a.bottom_banner_scroll=!0},7e3)}))}]}}]),app.directive("mobileHideNavbarOnScroll",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$timeout","$rootScope","$cookies",function(t,e,i,o,e,n,a){t.$on("$routeChangeStart",function(){}),t.$on("$routeChangeSuccess",function(){})}]}}]),app.directive("newsletterCta",["$http",function(t){return{restrict:"E",controller:["$scope","$timeout","$document","$location","$timeout","$rootScope","$cookies",function(t,e,i,o,e,n,a){t.$on("$routeChangeStart",function(){}),t.$on("$routeChangeSuccess",function(){})}]}}]),app.directive("enterKey",function(){return function(t,e,i){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(i.enterKey)}),e.preventDefault())})}}),app.run(["$http","$rootScope","$cookieStore","$analytics",function(t,e,i,o,n){e.outbound_click=function(t){if(console.log(t.categories),t.categories){var e=JSON.parse(t.categories);angular.forEach(e,function(t,e){o.eventTrack("outbound-category",{category:"outbound-category",label:t})})}},e.click=function(i){i.ugly_link&&(i.link=i.ugly_link),t({method:"POST",url:"/api/user/tracking",data:{type:"click",session_id:e.tracking_session_id,post_id:i.id},headers:{"Content-Type":"application/json"}}).success(function(t){})},e.editorial_click=function(i){i.ugly_link&&(i.link=i.ugly_link),t({method:"POST",url:"/api/user/tracking",data:{type:"click-editorial",session_id:e.tracking_session_id,post_id:i.id},headers:{"Content-Type":"application/json"}}).success(function(t){})},e.postpage_click=function(i){i.ugly_link&&(i.link=i.ugly_link),t({method:"POST",url:"/api/user/tracking",data:{type:"click-postpage",session_id:e.tracking_session_id,post_id:i.id},headers:{"Content-Type":"application/json"}}).success(function(t){})},e.bottom_banner_click=function(i){t({method:"POST",url:"/api/user/tracking",data:{type:"click-bottom-banner",session_id:e.tracking_session_id,post_id:i.id},headers:{"Content-Type":"application/json"}}).success(function(t){})},e.native_ad_click=function(o){e.native_ad_clicks=i.get("native_ad_clicks"),e.native_ad_clicks&&e.native_ad_clicks[o.id]||(t({method:"POST",url:"/api/user/native_ad/tracking/click/",data:{ad_id:o.id,session:e.Session},headers:{"Content-Type":"application/json"}}).success(function(t){}),e.native_ad_clicks||(e.native_ad_clicks={}),e.native_ad_clicks[o.id]=!0,o.clicked=!0,i.put("native_ad_clicks",e.native_ad_clicks))},e.dev_purge=function(){t({method:"POST",url:"/api/user/dev_purge/",data:{urls:e.purge_tool_urls},headers:{"Content-Type":"application/json"}}).success(function(t){e.purge_success=!0})},e.format_date_nice=function(t){var t=Date.parse(t),e=Math.floor((new Date-t)/1e3),i=Math.floor(e/31536e3);return i>1?i+" years":(i=Math.floor(e/2592e3),i>1?i+" months":(i=Math.floor(e/86400),i>1?i+" days":(i=Math.floor(e/3600),i>1?i+" hours":(i=Math.floor(e/60),i>1?i+" minutes":Math.floor(e)+" seconds"))))},e.format_giveaway_date=function(t){var t=Date.parse(t),e=Math.floor((t-new Date)/1e3),i=Math.floor(e/31536e3);i=Math.floor(e/86400);var o=Math.floor(e/3600);return o<24?"less than 1 day remaining!":i+" days remaining"}}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(t){return function(e){return String(e).replace(/\%VERSION\%/gm,t)}}]),angular.module("myApp").filter("cut",function(){return function(t,e,i,o){if(!t)return"";if(i=parseInt(i,10),!i)return t;if(t.length<=i)return t;if(t=t.substr(0,i),e){var n=t.lastIndexOf(" ");n!=-1&&("."!=t.charAt(n-1)&&","!=t.charAt(n-1)||(n-=1),t=t.substr(0,n))}return t+(o||" â€¦")}}),angular.module("myApp").filter("decodeBase64",function(){return function(t){return atob(t)}}),angular.module("myApp").filter("encodeBase64",function(){return function(t){return btoa(t)}}),angular.module("myApp").filter("ssnaId",function(){return function(t){if(t)return"x101"+t.toString(36)}});var app=angular.module("myApp.services",[]);if(app.factory("AuthService",["$rootScope","$http","$q",function(t,e,i){function o(t){return i(function(i,o){e({method:"POST",url:"/api/user/login",data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){"success"!=t.data.meta.status?o(t.data.meta.error):i(t.data.meta.status)},function(t){o("You could not be logged in")})})}function n(t){return i(function(i,o){e({method:"POST",url:"/api/user/register",data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){"success"!=t.data.meta.status?o(t.data.meta.error):i(t.data.meta.status)},function(t){o("Register did not work")})})}function a(t){return i(function(i,o){e({method:"POST",url:"/api/user/subscribe",data:{email:t},headers:{"Content-Type":"application/json"}}).then(function(t){"success"!=t.data.meta.status?o(t.data.meta.error):i(t.data.meta.status)},function(t){o("Subscribe did not work")})})}function s(){return i(function(t,i){e.get("/api/user/me?now="+(new Date).getTime()).then(function(e){"success"==e.data.meta.status?t(e.data.data):i()},function(t){i()})})}function r(){var e=s();e.then(function(e){t.is_logged_in=!0,t.wishlist_count=e.wishlist_count,t.user_id=e.user_id,t.email=e.email,t.dob=e.dob,t.username=e.username,t.auth_finished=!0,t.access=e.access,t.editor=e.editor,t.advertiser=e.advertiser,window.access=e.access,window.editor=e.editor,window.auth_finished=t.auth_finished},function(){t.is_logged_in=!1,t.auth_finished=!0,t.access=!1,t.editor=!1,window.auth_finished=t.auth_finished})}return r(),{isLoggedIn:r,logIn:o,register:n,subscribe:a}}]),app.factory("flash",["$rootScope",function(t){var e=[],i="";return t.$on("$routeChangeSuccess",function(){i=e.shift()||""}),{setMessage:function(t){e.push(t)},getMessage:function(){return i}}}]),app.service("Page",["$rootScope","$location","$sce",function(t,e,i){return{setTitle:function(e){t.title=e},setCanonical:function(i){t.canonical=e.protocol()+"://"+e.host()+i},setNoIndex:function(){t.noindex=!0},setIndex:function(){t.noindex=!1},setOpenGraph:function(e){function i(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/â€/g,"&quot;").replace(/â€œ/g,"&quot;").replace(/'/g,"&#039;")}e.title&&(e.title=i(e.title)),e.description&&(e.description=i(e.description)),t.og=e},setRelPrev:function(i){t.relprev=e.protocol()+"://"+e.host()+i},setRelNext:function(i){t.relnext=e.protocol()+"://"+e.host()+i},init:function(){t.relnext=void 0,t.relprev=void 0,t.og=void 0,t.noindex=void 0,t.canonical=void 0,t.post_footer=void 0,t.meta_desc=void 0,t.meta_keywords=void 0,t.redirect=void 0,t.status_code=void 0,t.hreflang={},t.title="ThisIsWhyImBroke :: The Internet's Mall",t.hide_header=!1,t.hide_support_button=!1,t.ad_counter=0,t.featured_counter=0,t.show_banner=!1,t.large_container=!1},setHrefLang:function(i){t.hreflang={"en-GB":e.protocol()+"://"+e.host()+"/uk"+i,"en-CA":e.protocol()+"://"+e.host()+"/ca"+i,"en-US":e.protocol()+"://"+e.host()+i,en:e.protocol()+"://"+e.host()+i}},setPostFooter:function(){t.post_footer=!0},setMetaDescription:function(e){t.meta_desc=e},setMetaKeywords:function(e){t.meta_keywords=e},setStatusCode:function(e){t.status_code=parseInt(e)},setRedirect:function(i){t.redirect=e.protocol()+"://"+e.host()+i},renderHtml:function(t){return i.trustAsHtml(t)}}}]),function(t,e){"use strict";function i(t,i,o){function n(t,o,n){var s,r;n=n||{},r=n.expires,s=e.isDefined(n.path)?n.path:a,e.isUndefined(o)&&(r="Thu, 01 Jan 1970 00:00:00 GMT",o=""),e.isString(r)&&(r=new Date(r));var l=encodeURIComponent(t)+"="+encodeURIComponent(o);l+=s?";path="+s:"",l+=n.domain?";domain="+n.domain:"",l+=r?";expires="+r.toUTCString():"",l+=n.secure?";secure":"";var c=l.length+1;return c>4096&&i.warn("Cookie '"+t+"' possibly not set or overflowed because it was too large ("+c+" > 4096 bytes)!"),l}var a=o.baseHref(),s=t[0];return function(t,e,i){s.cookie=n(t,e,i)}}e.module("ngCookies",["ng"]).provider("$cookies",[function(){function t(t){return t?e.extend({},i,t):i}var i=this.defaults={};this.$get=["$$cookieReader","$$cookieWriter",function(i,o){return{get:function(t){return i()[t]},getObject:function(t){var i=this.get(t);return i?e.fromJson(i):i},getAll:function(){return i()},put:function(e,i,n){o(e,i,t(n))},putObject:function(t,i,o){this.put(t,e.toJson(i),o)},remove:function(e,i){o(e,void 0,t(i))}}}]}]),e.module("ngCookies").factory("$cookieStore",["$cookies",function(t){return{get:function(e){return t.getObject(e)},put:function(e,i){t.putObject(e,i)},remove:function(e){t.remove(e)}}}]),i.$inject=["$document","$log","$browser"],e.module("ngCookies").provider("$$cookieWriter",function(){this.$get=i})}(window,window.angular),!function(t){function e(e,i){var o="ezfb-social-plugin-wrap",n="display: inline-block; width: 0; height: 0; overflow: hidden;",a=["fbPage","fbComments"],s=function(t){var e='<span class="'+o+'" style="'+n+'">';return t.wrap(e).parent()},r=function(t){var e='<div class="'+o+'">';return t.wrap(e).parent()},l=function(t){return t.parent().hasClass(o)},c=function(t){var e=t.parent();return e.after(t).remove(),t};t.directive(i,["ezfb","$q","$document",function(t,o,n){var u=a.indexOf(i)>=0,d=i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return{restrict:"EC",require:"?^ezfbXfbml",compile:function(i,o){return i.removeClass(d),function(i,o,n,a){function p(t){return function(){var e;h&&t===g&&(e=n.onrender,e&&i.$eval(e),h=!1,c(o))}}if(!a){var h=!1,g=0;t.$rendered().then(function(){o.addClass(d),i.$watch(function(){var t=[];return angular.forEach(e,function(e){t.push(n[e])}),t},function(e){var i;g++,h?t.XFBML.parse(o.parent()[0],p(g)):(h=!0,i=u?r:s,t.XFBML.parse(i(o)[0],p(g)))},!0)}),o.bind("$destroy",function(){l(o)&&c(o)})}}}}}])}t.provider("ezfb",function(){function t(t,e){return angular.isObject(e)?void angular.extend(t,e):angular.copy(t)}function e(t,e,i){return function(){return t.apply(e,i)}}var i={COMPLETED_REGISTRATION:"fb_mobile_complete_registration",VIEWED_CONTENT:"fb_mobile_content_view",SEARCHED:"fb_mobile_search",RATED:"fb_mobile_rate",COMPLETED_TUTORIAL:"fb_mobile_tutorial_completion",ADDED_TO_CART:"fb_mobile_add_to_cart",ADDED_TO_WISHLIST:"fb_mobile_add_to_wishlist",INITIATED_CHECKOUT:"fb_mobile_initiated_checkout",ADDED_PAYMENT_INFO:"fb_mobile_add_payment_info",ACHIEVED_LEVEL:"fb_mobile_level_achieved",UNLOCKED_ACHIEVEMENT:"fb_mobile_achievement_unlocked",SPENT_CREDITS:"fb_mobile_spent_credits"},o={CURRENCY:"fb_currency",REGISTRATION_METHOD:"fb_registration_method",CONTENT_TYPE:"fb_content_type",CONTENT_ID:"fb_content_id",SEARCH_STRING:"fb_search_string",SUCCESS:"fb_success",MAX_RATING_VALUE:"fb_max_rating_value",PAYMENT_INFO_AVAILABLE:"fb_payment_info_available",NUM_ITEMS:"fb_num_items",LEVEL:"fb_level",DESCRIPTION:"fb_description"},n=-1,a={api:[1,2,3],ui:1,getAuthResponse:n,getLoginStatus:0,login:0,logout:0,"Event.subscribe":1,"Event.unsubscribe":1,"XFBML.parse":1,"Canvas.Prefetcher.addStaticResource":n,"Canvas.Prefetcher.setCollectionMode":n,"Canvas.getPageInfo":0,"Canvas.hideFlashElement":n,"Canvas.scrollTo":n,"Canvas.setAutoGrow":n,"Canvas.setDoneLoading":0,"Canvas.setSize":n,"Canvas.setUrlHandler":0,"Canvas.showFlashElement":n,"Canvas.startTimer":n,"Canvas.stopTimer":0,"AppEvents.logEvent":n,"AppEvents.logPurchase":n,"AppEvents.activateApp":n},s="en_US",r={status:!0,cookie:!0,xfbml:!0,version:"v2.6"},l=["$window","$document","$timeout","ezfbAsyncInit","ezfbLocale",function(t,e,i,o,n){!function(t){var e=function(){var e,i="facebook-jssdk",o=t.getElementsByTagName("script")[0];t.getElementById(i)||(e=t.createElement("script"),e.id=i,e.async=!0,e.src="//connect.facebook.net/"+n+"/sdk.js",o.parentNode.insertBefore(e,o))};i(e,0,!1)}(e[0]),t.fbAsyncInit=o}],c=l,u=["$window","ezfbInitParams",function(t,e){t.FB.init(e)}],d=u;return{setInitParams:function(e){t(r,e)},getInitParams:function(){return t(r)},setLocale:function(t){s=t},getLocale:function(){return s},setLoadSDKFunction:function(t){if(!angular.isArray(t)&&!angular.isFunction(t))throw new Error("Init function type error.");c=t},getLoadSDKFunction:function(){return c},setInitFunction:function(t){if(!angular.isArray(t)&&!angular.isFunction(t))throw new Error("Init function type error.");d=t},getInitFunction:function(){return d},$get:["$window","$q","$document","$parse","$rootScope","$injector","$timeout",function(l,p,h,g,f,m,v){var w,_,b,y,$,k;return y={},$=p.defer(),(r.appId||d!==u)&&$.resolve(),w=p.defer(),_=p.defer(),h[0].getElementById("fb-root")||h.find("body").append('<div id="fb-root"></div>'),k=function(){$.promise.then(function(){if(r.xfbml){var t=function(){b.$$xfbmlRendered=!0,v(function(){_.resolve(!0)}),b.Event.unsubscribe("xfbml.render",t)};b.Event.subscribe("xfbml.render",t)}else v(function(){_.resolve(!1)});m.invoke(d,null,{ezfbInitParams:r}),b.$$ready=!0,w.resolve()})},m.invoke(c,null,{ezfbAsyncInit:k,ezfbLocale:s}),b={$$ready:!1,$$xfbmlRendered:!1,$ready:function(t){return angular.isFunction(t)&&w.promise.then(t),w.promise},$rendered:function(t){return angular.isFunction(t)&&_.promise.then(t),_.promise},init:function(e){t(r,e),$.resolve()},AppEvents:{EventNames:i,ParameterNames:o}},angular.forEach(a,function(t,i){var o=g(i),a=o.assign;a(b,function(){var a=e(function(e){var a,s;if(a=p.defer(),s=function(t){var o,n;for(o=angular.isFunction(e[t])?e[t]:angular.noop,n=function(){var t=Array.prototype.slice.call(arguments);f.$$phase?(o.apply(null,t),a.resolve.apply(a,t)):f.$apply(function(){o.apply(null,t),a.resolve.apply(a,t)})};e.length<=t;)e.push(null);var s;if("Event.subscribe"===i)s=e[0],angular.isUndefined(y[s])&&(y[s]=[]),y[s].push({original:o,wrapped:n});else if("Event.unsubscribe"===i&&(s=e[0],angular.isArray(y[s]))){var r,l,c=y[s].length;for(r=0;c>r;r++)if(l=y[s][r],l.original===o){n=l.wrapped,y[s].splice(r,1);break}}e[t]=n},t!==n)if(angular.isNumber(t))s(t);else if(angular.isArray(t)){var r,c;for(r=0;r<t.length;r++)if(c=t[r],e.length==c||e.length==c+1&&angular.isFunction(e[c])){s(c);break}}var u=o(l.FB);if(!u)throw new Error("Facebook API `FB."+i+"` doesn't exist.");return u.apply(l.FB,e),a.promise},null,[Array.prototype.slice.call(arguments)]);if("getAuthResponse"===i){if(angular.isUndefined(l.FB))throw new Error("`FB` is not ready.");return l.FB.getAuthResponse()}return t!==n?w.promise.then(a):void w.promise.then(a)})}),b}]}}).directive("ezfbXfbml",["ezfb","$parse","$compile","$timeout",function(t,e,i,o){return{restrict:"EAC",controller:function(){},compile:function(n,a){var s=n.html();return function(n,a,r){var l=!0,c=r.onrender,u=function(){l&&(c&&n.$eval(c),l=!1)};t.XFBML.parse(a[0],u);var d=e(r.ezfbXfbml).assign;n.$watch(r.ezfbXfbml,function(e){e&&(l=!0,a.html(s),i(a.contents())(n),o(function(){t.XFBML.parse(a[0],u)}),(d||angular.noop)(n,!1))},!0)}}}}]);var i={fbLike:["action","colorscheme","href","kidDirectedSite","layout","ref","share","showFaces","width"],fbShareButton:["href","layout","width"],fbSend:["colorscheme","href","kidDirectedSite","ref"],fbPost:["href","width"],fbFollow:["colorscheme","href","kidDirectedSite","layout","showFaces","width"],fbComments:["colorscheme","href","mobile","numPosts","orderBy","width"],fbCommentsCount:["href"],fbActivity:["action","appId","colorscheme","filter","header","height","linktarget","maxAge","recommendations","ref","site","width"],fbRecommendations:["action","appId","colorscheme","header","height","linktarget","maxAge","ref","site","width"],fbRecommendationsBar:["action","href","maxAge","numRecommendations","readTime","ref","side","site","trigger"],fbLikeBox:["colorscheme","forceWall","header","height","href","showBorder","showFaces","stream","width"],fbFacepile:["action","appId","colorscheme","href","maxRows","size","width"],fbPage:["href","width","height","hideCover","showFacepile","showPosts"],fbVideo:["href","width","allowfullscreen"],fbAdPreview:["adAccountId","adgroupId","creative","creativeId","adFormat","pageType","targeting","post"],fbSendToMessenger:["messengerAppId","pageId","ref","color","size"],fbMessengermessageus:["messengerAppId","pageId","color","size"]};angular.forEach(i,e)}(angular.module("ezfb",[])),$(document).ready(function(){function t(){$("#mobile-dropdown").removeClass("open"),$(".login-overlay").css("display","none"),$("#open-dropdown-mobile").removeClass("selected")}function e(){$("#mobile-dropdown").addClass("open"),$(".login-overlay").css("display","block"),$("#open-dropdown-mobile").addClass("selected")}function i(){"Max"!=$(".rz-ceil").text()?$(".rz-ceil").text("Max"):setTimeout(i,50)}function o(){if(window.auth_finished){if((window.access||window.editor)&&!window.post_debugger){if(!getUrlParameter("dev"))return;window.post_debugger=$("body").on({mouseenter:function(){if(getUrlParameter("dev")){$(this).addClass("inside");var t=$(this).data("post");window.active_debug_post=t,$("#debug-clicks").text(0),$("#debug-published").text(""),$("#debug-ctr").text(0),$("#debug-impressions").text(0),$("#debug-sales-score").text(0),$("#debug-clicks-week-score").text(0),$("#debug-editorial-clicks").text(0),$("#debug-editorial-impressions").text(0),$("#debug-editorial-ctr").text(0),$("#debug-postpage-clicks").text(0),$("#debug-postpage-impressions").text(0),$("#debug-postpage-ctr").text(0),window.debug_loading=!0,$.get("/api/user/debug/"+t,function(t){var e=t.data;try{if(window.debug_loading=!1,e.id!=window.active_debug_post)return;if(e.first_published){var i=new Date(e.first_published);$("#debug-published").text(formatDate(i))}else if(e.published){var i=new Date(e.published);$("#debug-published").text(formatDate(i))}$("#debug-saves").text(e.saves),e.clicks&&$("#debug-clicks").text(e.clicks.toLocaleString()),$("#debug-ctr").text((100*parseFloat(e.clicks/e.impressions)).toFixed(2)+"%"),e.impressions&&$("#debug-impressions").text(e.impressions.toLocaleString()),e.earnings_score&&$("#debug-sales-score").text(e.earnings_score.toFixed(4)),e.week_score&&$("#debug-clicks-week-score").text((100*parseFloat(e.week_score)).toFixed(2)+"%"),e.editorial_clicks&&$("#debug-editorial-clicks").text(e.editorial_clicks.toLocaleString()),e.editorial_impressions&&$("#debug-editorial-impressions").text(e.editorial_impressions.toLocaleString()),e.editorial_impressions&&$("#debug-editorial-ctr").text((100*parseFloat(e.editorial_clicks/e.editorial_impressions)).toFixed(2)+"%"),e.postpage_clicks&&$("#debug-postpage-clicks").text(e.postpage_clicks.toLocaleString()),e.postpage_impressions&&$("#debug-postpage-impressions").text(e.postpage_impressions.toLocaleString()),e.postpage_impressions&&$("#debug-postpage-ctr").text((100*parseFloat(e.postpage_clicks/e.postpage_impressions)).toFixed(2)+"%")}catch(o){console.log(o)}}),$("#post-debug").css("display","block")}},mouseleave:function(){$(this).removeClass("inside"),$("#post-debug").css("display","none")}},"article")}}else setTimeout(o,1e3)}window.addEventListener("mousewheel",function(){}),console.log("here");var n;$(document).on("scroll",function(){var t=$(window).scrollTop();t>n?$("#mobile-nav").removeClass("shrink"):$(document).scrollTop()>100?$("#mobile-nav").addClass("shrink"):$("#mobile-nav").removeClass("shrink"),n=t}),$(document).on("scroll",function(){$(document).scrollTop()>100?$("#masthead").addClass("shrink"):$("#masthead").removeClass("shrink")}),$("#open-mobile-search").on("click",function(t){t.preventDefault(),$(".mobile-search-box").hasClass("open")?($(".mobile-search-box").removeClass("open"),$(".login-overlay").css("display","none"),$(this).removeClass("selected")):($(".mobile-search-box").addClass("open"),$("#mobile-search-input").focus(),$(".login-overlay").css("display","block"),$(this).addClass("selected"))}),$(".login-overlay").on("click",function(){$(".mobile-search-box").hasClass("open")&&($(".mobile-search-box").removeClass("open"),$(".login-overlay").css("display","none"),$("#open-mobile-search").removeClass("selected")),$("#mobile-dropdown").hasClass("open")&&t()}),$("#open-dropdown-mobile").on("click",function(i){$("#mobile-dropdown").hasClass("open")?t():e()}),$("#mobile-dropdown a").on("click",function(e){t()}),i(),setTimeout(o,1e3)}),!function(t){var e=t(window);t.fn.visible=function(t,i,o){if(!(this.length<1)){var n=this.length>1?this.eq(0):this,a=n.get(0),s=e.width(),r=e.height(),o=o?o:"both",l=i!==!0||a.offsetWidth*a.offsetHeight;if("function"==typeof a.getBoundingClientRect){var c=a.getBoundingClientRect(),u=c.top>=0&&c.top<r,d=c.bottom>0&&c.bottom<=r,p=c.left>=0&&c.left<s,h=c.right>0&&c.right<=s,g=t?u||d:u&&d,f=t?p||h:p&&h;if("both"===o)return l&&g&&f;if("vertical"===o)return l&&g;if("horizontal"===o)return l&&f}else{var m=e.scrollTop(),v=m+r,w=e.scrollLeft(),_=w+s,b=n.offset(),y=b.top,$=y+n.height(),k=b.left,S=k+n.width(),C=t===!0?$:y,x=t===!0?y:$,T=t===!0?S:k,P=t===!0?k:S;if("both"===o)return!!l&&v>=x&&C>=m&&_>=P&&T>=w;if("vertical"===o)return!!l&&v>=x&&C>=m;if("horizontal"===o)return!!l&&_>=P&&T>=w}}}}(jQuery),!function(t){"use strict";t.module("vcRecaptcha",[])}(angular),function(t){"use strict";function e(){throw new Error('You need to set the "key" attribute to your public reCaptcha key. If you don\'t have a key, please get one from https://www.google.com/recaptcha/admin/create')}var i=t.module("vcRecaptcha");i.provider("vcRecaptchaService",function(){var i=this,o={};i.onLoadFunctionName="vcRecaptchaApiLoaded",i.setDefaults=function(e){t.copy(e,o)},i.setSiteKey=function(t){o.key=t},i.setTheme=function(t){o.theme=t},i.setStoken=function(t){o.stoken=t},i.setSize=function(t){o.size=t},i.setType=function(t){o.type=t},i.setLang=function(t){o.lang=t},i.setOnLoadFunctionName=function(t){i.onLoadFunctionName=t},i.$get=["$rootScope","$window","$q","$document",function(n,a,s,r){function l(){return u?s.when(u):p}function c(){if(!u)throw new Error("reCaptcha has not been loaded yet.")}var u,d=s.defer(),p=d.promise,h={};a.vcRecaptchaApiLoadedCallback=a.vcRecaptchaApiLoadedCallback||[];var g=function(){u=a.grecaptcha,d.resolve(u)};if(a.vcRecaptchaApiLoadedCallback.push(g),a[i.onLoadFunctionName]=function(){a.vcRecaptchaApiLoadedCallback.forEach(function(t){t()})},t.isDefined(a.grecaptcha))g();else{var f=a.document.createElement("script");f.async=!0,f.defer=!0,f.src="https://www.google.com/recaptcha/api.js?onload="+i.onLoadFunctionName+"&render=explicit",r.find("body").append(f)}return{create:function(t,i){return i.sitekey=i.key||o.key,i.theme=i.theme||o.theme,i.stoken=i.stoken||o.stoken,i.size=i.size||o.size,i.type=i.type||o.type,i.hl=i.lang||o.lang,i.sitekey&&40===i.sitekey.length||e(),
l().then(function(e){var o=e.render(t,i);return h[o]=t,o})},reload:function(t){c(),u.reset(t),n.$broadcast("reCaptchaReset",t)},useLang:function(t,e){var i=h[t];if(!i)throw new Error("reCaptcha Widget ID not exists",t);var o=i.querySelector("iframe");if(!e)return o&&o.src&&/[?&]hl=\w+/.test(o.src)?o.src.replace(/.+[?&]hl=(\w+)([^\w].+)?/,"$1"):null;if(o&&o.src){var n=o.src;/[?&]hl=/.test(n)?n=n.replace(/([?&]hl=)\w+/,"$1"+e):n+=(n.indexOf("?")===-1?"?":"&")+"hl="+e,o.src=n}},getResponse:function(t){return c(),u.getResponse(t)},getInstance:function(t){return h[t]},destroy:function(t){delete h[t]}}}]})}(angular),function(t){"use strict";var e=t.module("vcRecaptcha");e.directive("vcRecaptcha",["$document","$timeout","vcRecaptchaService",function(e,i,o){return{restrict:"A",require:"?^^form",scope:{response:"=?ngModel",key:"=?",stoken:"=?",theme:"=?",size:"=?",type:"=?",lang:"=?",tabindex:"=?",required:"=?",onCreate:"&",onSuccess:"&",onExpire:"&"},link:function(n,a,s,r){function l(){r&&r.$setValidity("recaptcha",null),d()}function c(){i(function(){n.response="",u(),n.onExpire({widgetId:n.widgetId})})}function u(){r&&r.$setValidity("recaptcha",n.required===!1?null:Boolean(n.response))}function d(){o.destroy(n.widgetId),t.element(e[0].querySelectorAll(".pls-container")).parent().remove()}n.widgetId=null,r&&t.isDefined(s.required)&&n.$watch("required",u);var p=n.$watch("key",function(e){var r=function(t){i(function(){n.response=t,u(),n.onSuccess({response:t,widgetId:n.widgetId})})};o.create(a[0],{callback:r,key:e,stoken:n.stoken||s.stoken||null,theme:n.theme||s.theme||null,type:n.type||s.type||null,lang:n.lang||s.lang||null,tabindex:n.tabindex||s.tabindex||null,size:n.size||s.size||null,"expired-callback":c}).then(function(e){u(),n.widgetId=e,n.onCreate({widgetId:e}),n.$on("$destroy",l),n.$on("reCaptchaReset",function(i,o){(t.isUndefined(o)||e===o)&&(n.response="",u())})}),p()})}}}])}(angular),!function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};e.m=t,e.c=i,e.p="",e(0)}([function(t,e){"use strict";angular.module("angularModalService",[]).factory("ModalService",["$animate","$document","$compile","$controller","$http","$rootScope","$q","$templateRequest","$timeout",function(t,e,i,o,n,a,s,r,l){function c(){var n=this,c=function(t,e){var i=s.defer();return t?i.resolve(t):e?r(e,!0).then(function(t){i.resolve(t)},function(t){i.reject(t)}):i.reject("No template or templateUrl has been specified."),i.promise},u=function(e,i){var o=e.children();return o.length>0?t.enter(i,e,o[o.length-1]):t.enter(i,e)};n.showModal=function(n){var r=angular.element(e[0].body),d=s.defer();return n.controller?(c(n.template,n.templateUrl).then(function(e){function c(e){g.resolve(e),n.bodyClass&&r[0].classList.remove(n.bodyClass),t.leave(w).then(function(){f.resolve(e),p.$destroy(),m.close=null,d=null,g=null,y=null,m=null,w=null,p=null}),h&&h()}var p=(n.scope||a).$new(),h=a.$on("$locationChangeSuccess",c),g=s.defer(),f=s.defer(),m={$scope:p,close:function(t,e){void 0!==e&&null!==e||(e=0),l(function(){c(t)},e)}};n.inputs&&angular.extend(m,n.inputs);var v=i(e),w=v(p);m.$element=w;var _=p[n.controllerAs],b=o(n.controller,m,!1,n.controllerAs);n.controllerAs&&_&&angular.extend(b,_),n.appendElement?u(n.appendElement,w):u(r,w),n.bodyClass&&r[0].classList.add(n.bodyClass);var y={controller:b,scope:p,element:w,close:g.promise,closed:f.promise};d.resolve(y)}).then(null,function(t){d.reject(t)}),d.promise):(d.reject("No controller has been specified."),d.promise)}}return new c}])}]),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(t){"use strict";function e(e,o){return this.each(function(){var n=t(this),a=n.data("bs.modal"),s=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);a||n.data("bs.modal",a=new i(this,s)),"string"==typeof e?a[e](o):s.show&&a.show(o)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var o=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){o.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(o.$element)&&(o.ignoreBackdropClick=!0)})}),this.backdrop(function(){var n=t.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),o.adjustDialog(),n&&o.$element[0].offsetWidth,o.$element.addClass("in"),o.enforceFocus();var a=t.Event("shown.bs.modal",{relatedTarget:e});n?o.$dialog.one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(a)}).emulateTransitionEnd(i.TRANSITION_DURATION):o.$element.trigger("focus").trigger(a)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var o=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var a=t.support.transition&&n;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+n).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),a&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;a?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){o.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var o=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=o,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var o=t(this),n=o.attr("href"),a=t(o.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),s=a.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},a.data(),o.data());o.is("a")&&i.preventDefault(),a.one("show.bs.modal",function(t){t.isDefaultPrevented()||a.one("hidden.bs.modal",function(){o.is(":visible")&&o.trigger("focus")})}),e.call(a,s,this)})}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,o=this;t(this).one("bsTransitionEnd",function(){i=!0});var n=function(){i||t(o).trigger(t.support.transition.end)};return setTimeout(n,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){return t(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),angular.module("angular-img-cropper",[]).directive("imageCropper",["$document","$window","imageCropperDataShare",function(t,e,i){return{scope:{image:"=",croppedImage:"=",cropWidth:"=",cropHeight:"=",keepAspect:"=",touchRadius:"=",cropAreaBounds:"=",minWidth:"=",minHeight:"="},restrict:"A",link:function(t,e,o){function n(i,o){if(!s||i!==o){var n=e[0],r=t.cropWidth,l=t.cropHeight,c=t.keepAspect,u=t.touchRadius,d=s&&s.srcImage;s=new m(n,n.width/2-r/2,n.height/2-l/2,r,l,c,u),$(n).data("crop.angular-img-cropper",s),d?s.setImage(d):a(t.image)}}function a(e){if(e){var i=new Image;void 0!==o.cors&&"no"!==o.cors&&(i.crossOrigin="Anonymous"),i.addEventListener("load",function(){s.setImage(i),t.$apply()},!1),i.src=e}}var s,r=r||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},l=function(){function t(t,e,i){this.over=!1,this.drag=!1,this.position=new g(t,e),this.offset=new g(0,0),this.radius=i}return t.prototype.setDrag=function(t){this.drag=t,this.setOver(t)},t.prototype.draw=function(){},t.prototype.setOver=function(t){this.over=t},t.prototype.touchInBounds=function(t,e){return t>this.position.x-this.radius&&this.position.x+this.radius>t&&e>this.position.y-this.radius&&this.position.y+this.radius>e},t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t,e){this.position.x=t,this.position.y=e},t}(),c=function(){function t(e){this.borrowed=0,t.instance=this;for(var i=null,o=0;e>o;o++)if(0===o)this.firstAvailable=new g,i=this.firstAvailable;else{var n=new g;i.setNext(n),i=n}}return t.prototype.borrow=function(t,e){if(null==this.firstAvailable)throw"Pool exhausted";this.borrowed++;var i=this.firstAvailable;return this.firstAvailable=i.getNext(),i.x=t,i.y=e,i},t.prototype.returnPoint=function(t){this.borrowed--,t.x=0,t.y=0,t.setNext(this.firstAvailable),this.firstAvailable=t},t}(),u=function(){function t(){}return t.init=function(t){this.canvas=t,this.ctx=this.canvas.getContext("2d")},t.DEG2RAD=.0174532925,t}(),d=function(t){function e(e,i,o){t.call(this,e,i,o),this.iconPoints=[],this.scaledIconPoints=[],this.getDragIconPoints(this.iconPoints,1),this.getDragIconPoints(this.scaledIconPoints,1.2)}return r(e,t),e.prototype.draw=function(t){this.over||this.drag?this.drawIcon(t,this.scaledIconPoints):this.drawIcon(t,this.iconPoints)},e.prototype.getDragIconPoints=function(t,e){var i=17*e,o=14*e,n=8*e,a=4*e;t.push(c.instance.borrow(-a/2,i-n)),t.push(c.instance.borrow(-o/2,i-n)),t.push(c.instance.borrow(0,i)),t.push(c.instance.borrow(o/2,i-n)),t.push(c.instance.borrow(a/2,i-n)),t.push(c.instance.borrow(a/2,a/2)),t.push(c.instance.borrow(i-n,a/2)),t.push(c.instance.borrow(i-n,o/2)),t.push(c.instance.borrow(i,0)),t.push(c.instance.borrow(i-n,-o/2)),t.push(c.instance.borrow(i-n,-a/2)),t.push(c.instance.borrow(a/2,-a/2)),t.push(c.instance.borrow(a/2,-i+n)),t.push(c.instance.borrow(o/2,-i+n)),t.push(c.instance.borrow(0,-i)),t.push(c.instance.borrow(-o/2,-i+n)),t.push(c.instance.borrow(-a/2,-i+n)),t.push(c.instance.borrow(-a/2,-a/2)),t.push(c.instance.borrow(-i+n,-a/2)),t.push(c.instance.borrow(-i+n,-o/2)),t.push(c.instance.borrow(-i,0)),t.push(c.instance.borrow(-i+n,o/2)),t.push(c.instance.borrow(-i+n,a/2)),t.push(c.instance.borrow(-a/2,a/2))},e.prototype.drawIcon=function(t,e){t.beginPath(),t.moveTo(e[0].x+this.position.x,e[0].y+this.position.y);for(var i=0;e.length>i;i++){var o=e[i];t.lineTo(o.x+this.position.x,o.y+this.position.y)}t.closePath(),t.fillStyle="rgba(255,228,0,1)",t.fill()},e.prototype.recalculatePosition=function(t){var e=t.getCentre();this.setPosition(e.x,e.y),c.instance.returnPoint(e)},e}(l),p=function(t){function e(e,i,o){t.call(this,e,i,o)}return r(e,t),e.prototype.drawCornerBorder=function(t){var e=10;(this.over||this.drag)&&(e=12);var i=1,o=1;this.horizontalNeighbour.position.x<this.position.x&&(i=-1),this.verticalNeighbour.position.y<this.position.y&&(o=-1),t.beginPath(),t.lineJoin="miter",t.moveTo(this.position.x,this.position.y),t.lineTo(this.position.x+e*i,this.position.y),t.lineTo(this.position.x+e*i,this.position.y+e*o),t.lineTo(this.position.x,this.position.y+e*o),t.lineTo(this.position.x,this.position.y),t.closePath(),t.lineWidth=2,t.strokeStyle="rgba(255,228,0,1)",t.stroke()},e.prototype.drawCornerFill=function(t){var e=10;(this.over||this.drag)&&(e=12);var i=1,o=1;this.horizontalNeighbour.position.x<this.position.x&&(i=-1),this.verticalNeighbour.position.y<this.position.y&&(o=-1),t.beginPath(),t.moveTo(this.position.x,this.position.y),t.lineTo(this.position.x+e*i,this.position.y),t.lineTo(this.position.x+e*i,this.position.y+e*o),t.lineTo(this.position.x,this.position.y+e*o),t.lineTo(this.position.x,this.position.y),t.closePath(),t.fillStyle="rgba(0,0,0,1)",t.fill()},e.prototype.moveX=function(t){this.setPosition(t,this.position.y)},e.prototype.moveY=function(t){this.setPosition(this.position.x,t)},e.prototype.move=function(t,e){this.setPosition(t,e),this.verticalNeighbour.moveX(t),this.horizontalNeighbour.moveY(e)},e.prototype.addHorizontalNeighbour=function(t){this.horizontalNeighbour=t},e.prototype.addVerticalNeighbour=function(t){this.verticalNeighbour=t},e.prototype.getHorizontalNeighbour=function(){return this.horizontalNeighbour},e.prototype.getVerticalNeighbour=function(){return this.verticalNeighbour},e.prototype.draw=function(t){this.drawCornerFill(t),this.drawCornerBorder(t)},e}(l),h=function(){function t(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0),this.left=t,this.right=t+i,this.top=e,this.bottom=e+o}return t.prototype.getWidth=function(){return this.right-this.left},t.prototype.getHeight=function(){return this.bottom-this.top},t.prototype.getCentre=function(){var t=this.getWidth(),e=this.getHeight();return c.instance.borrow(this.left+t/2,this.top+e/2)},t}(),g=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.setNext=function(t){this.next=t},t.prototype.getNext=function(){return this.next},t}(),f=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.id=0,this.x=t,this.y=e,this.id=i}return t}(),m=function(){function e(t,e,i,o,n,a,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=100),void 0===n&&(n=50),void 0===a&&(a=!0),void 0===s&&(s=20),this.keepAspect=!1,this.aspectRatio=0,this.currentDragTouches=[],this.isMouseDown=!1,this.ratioW=1,this.ratioH=1,this.fileType="png",this.imageSet=!1,this.pointPool=new c(200),u.init(t),this.buffer=document.createElement("canvas"),this.cropCanvas=document.createElement("canvas"),this.buffer.width=t.width,this.buffer.height=t.height,this.tl=new p(e,i,s),this.tr=new p(e+o,i,s),this.bl=new p(e,i+n,s),this.br=new p(e+o,i+n,s),this.tl.addHorizontalNeighbour(this.tr),this.tl.addVerticalNeighbour(this.bl),this.tr.addHorizontalNeighbour(this.tl),this.tr.addVerticalNeighbour(this.br),this.bl.addHorizontalNeighbour(this.br),this.bl.addVerticalNeighbour(this.tl),this.br.addHorizontalNeighbour(this.bl),this.br.addVerticalNeighbour(this.tr),this.markers=[this.tl,this.tr,this.bl,this.br],this.center=new d(e+o/2,i+n/2,s),this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.keepAspect=a,this.aspectRatio=n/o,this.draw(this.ctx),this.croppedImage=new Image,this.currentlyInteracting=!1,angular.element(window).off("mousemove.angular-img-cropper mouseup.angular-img-cropper touchmove.angular-img-cropper touchend.angular-img-cropper").on("mousemove.angular-img-cropper",this.onMouseMove.bind(this)).on("mouseup.angular-img-cropper",this.onMouseUp.bind(this)).on("touchmove.angular-img-cropper",this.onTouchMove.bind(this)).on("touchend.angular-img-cropper",this.onTouchEnd.bind(this)),angular.element(t).off("mousedown.angular-img-cropper touchstart.angular-img-cropper").on("mousedown.angular-img-cropper",this.onMouseDown.bind(this)).on("touchstart.angular-img-cropper",this.onTouchStart.bind(this))}return e.prototype.resizeCanvas=function(t,e){this.canvas.width=t,this.canvas.height=e,this.buffer.width=t,this.buffer.height=e,this.draw(this.ctx)},e.prototype.draw=function(t){var e=this.getBounds();if(this.srcImage){t.clearRect(0,0,this.canvasWidth,this.canvasHeight);var i=this.srcImage.height/this.srcImage.width,o=this.canvasHeight/this.canvasWidth,n=this.canvasWidth,a=this.canvasHeight;o>i?(n=this.canvasWidth,a=this.canvasWidth*i):(a=this.canvasHeight,n=this.canvasHeight/i),this.ratioW=n/this.srcImage.width,this.ratioH=a/this.srcImage.height,i>o?this.drawImageIOSFix(t,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,this.buffer.width/2-n/2,0,n,a):this.drawImageIOSFix(t,this.srcImage,0,0,this.srcImage.width,this.srcImage.height,0,this.buffer.height/2-a/2,n,a),this.buffer.getContext("2d").drawImage(this.canvas,0,0,this.canvasWidth,this.canvasHeight),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,this.canvasWidth,this.canvasHeight),t.drawImage(this.buffer,e.left,e.top,Math.max(e.getWidth(),1),Math.max(e.getHeight(),1),e.left,e.top,e.getWidth(),e.getHeight());for(var s,r=0;this.markers.length>r;r++)s=this.markers[r],s.draw(t);this.center.draw(t),t.lineWidth=2,t.strokeStyle="rgba(255,228,0,1)",t.strokeRect(e.left,e.top,e.getWidth(),e.getHeight())}else t.fillStyle="rgba(192,192,192,1)",t.fillRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.dragCrop=function(e,i,o){var n=this.getBounds(),a=e-n.getWidth()/2,s=e+n.getWidth()/2,r=i-n.getHeight()/2,l=i+n.getHeight()/2;s>=this.maxXClamp&&(e=this.maxXClamp-n.getWidth()/2),this.minXClamp>=a&&(e=n.getWidth()/2+this.minXClamp),this.minYClamp>r&&(i=n.getHeight()/2+this.minYClamp),l>=this.maxYClamp&&(i=this.maxYClamp-n.getHeight()/2),this.tl.moveX(e-n.getWidth()/2),this.tl.moveY(i-n.getHeight()/2),this.tr.moveX(e+n.getWidth()/2),this.tr.moveY(i-n.getHeight()/2),this.bl.moveX(e-n.getWidth()/2),this.bl.moveY(i+n.getHeight()/2),this.br.moveX(e+n.getWidth()/2),this.br.moveY(i+n.getHeight()/2),o.setPosition(e,i),t.cropAreaBounds&&this.imageSet&&(t.cropAreaBounds=this.getCropBounds(),t.$apply())},e.prototype.enforceMinSize=function(e,i,o){var n=e-o.getHorizontalNeighbour().getPosition().x,a=i-o.getVerticalNeighbour().getPosition().y,s=t.minWidth-Math.abs(n),r=t.minHeight-Math.abs(a);return 0==n||0==a?(e=o.getPosition().x,i=o.getPosition().y,c.instance.borrow(e,i)):(t.keepAspect?s>0&&r/this.aspectRatio>0?s>r/this.aspectRatio?0>n?(e-=s,0>a?i-=s*this.aspectRatio:i+=s*this.aspectRatio):(e+=s,0>a?i-=s*this.aspectRatio:i+=s*this.aspectRatio):0>a?(i-=r,0>n?e-=r/this.aspectRatio:e+=r/this.aspectRatio):(i+=r,0>n?e-=r/this.aspectRatio:e+=r/this.aspectRatio):s>0?0>n?(e-=s,0>a?i-=s*this.aspectRatio:i+=s*this.aspectRatio):(e+=s,0>a?i-=s*this.aspectRatio:i+=s*this.aspectRatio):r>0&&(0>a?(i-=r,0>n?e-=r/this.aspectRatio:e+=r/this.aspectRatio):(i+=r,0>n?e-=r/this.aspectRatio:e+=r/this.aspectRatio)):(s>0&&(0>n?e-=s:e+=s),r>0&&(0>a?i-=r:i+=r)),(this.minXClamp>e||e>this.maxXClamp||this.minYClamp>i||i>this.maxYClamp)&&(e=o.getPosition().x,i=o.getPosition().y),c.instance.borrow(e,i))},e.prototype.dragCorner=function(e,i,o){var n,a=0,s=0,r=0,l=0,u=0,d=0,p=0,h=0,g=0;if(t.keepAspect){if(n=o.getHorizontalNeighbour().getVerticalNeighbour(),r=n.getPosition().x,l=n.getPosition().y,n.getPosition().x>=e){if(n.getPosition().y>=i){if(a=r-100/this.aspectRatio,s=l-100/this.aspectRatio*this.aspectRatio,g=this.getSide(c.instance.borrow(a,s),n.getPosition(),c.instance.borrow(e,i)),g>0){u=Math.abs(n.getPosition().y-i),d=u/this.aspectRatio,p=n.getPosition().y-u,h=n.getPosition().x-d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}else if(0>g){d=Math.abs(n.getPosition().x-e),u=d*this.aspectRatio,p=n.getPosition().y-u,h=n.getPosition().x-d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}}else if(a=r-100/this.aspectRatio,s=l+100/this.aspectRatio*this.aspectRatio,g=this.getSide(c.instance.borrow(a,s),n.getPosition(),c.instance.borrow(e,i)),g>0){d=Math.abs(n.getPosition().x-e),u=d*this.aspectRatio,p=n.getPosition().y+u,h=n.getPosition().x-d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}else if(0>g){u=Math.abs(n.getPosition().y-i),d=u/this.aspectRatio,p=n.getPosition().y+u,h=n.getPosition().x-d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}}else if(n.getPosition().y>=i){if(a=r+100/this.aspectRatio,s=l-100/this.aspectRatio*this.aspectRatio,g=this.getSide(c.instance.borrow(a,s),n.getPosition(),c.instance.borrow(e,i)),0>g){u=Math.abs(n.getPosition().y-i),d=u/this.aspectRatio,p=n.getPosition().y-u,h=n.getPosition().x+d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}else if(g>0){d=Math.abs(n.getPosition().x-e),u=d*this.aspectRatio,p=n.getPosition().y-u,h=n.getPosition().x+d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}}else if(a=r+100/this.aspectRatio,s=l+100/this.aspectRatio*this.aspectRatio,g=this.getSide(c.instance.borrow(a,s),n.getPosition(),c.instance.borrow(e,i)),0>g){d=Math.abs(n.getPosition().x-e),u=d*this.aspectRatio,p=n.getPosition().y+u,h=n.getPosition().x+d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}else if(g>0){u=Math.abs(n.getPosition().y-i),d=u/this.aspectRatio,p=n.getPosition().y+u,h=n.getPosition().x+d;var f=this.enforceMinSize(h,p,o);o.move(f.x,f.y),c.instance.returnPoint(f)}}else{var f=this.enforceMinSize(e,i,o);o.move(f.x,f.y),c.instance.returnPoint(f)}this.center.recalculatePosition(this.getBounds()),t.cropAreaBounds&&this.imageSet&&(t.cropAreaBounds=this.getCropBounds(),t.$apply())},e.prototype.getSide=function(t,e,i){var o=this.sign((e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x));return c.instance.returnPoint(t),c.instance.returnPoint(i),o},e.prototype.sign=function(t){return+t===t?0===t?t:t>0?1:-1:NaN},e.prototype.handleRelease=function(t){if(null!=t){for(var e=0,i=0;this.currentDragTouches.length>i;i++)t.id==this.currentDragTouches[i].id&&(this.currentDragTouches[i].dragHandle.setDrag(!1),t.dragHandle=null,e=i);this.currentDragTouches.splice(e,1),this.draw(this.ctx)}},e.prototype.handleMove=function(t){for(var e=!1,o=0;this.currentDragTouches.length>o;o++)if(t.id==this.currentDragTouches[o].id&&null!=this.currentDragTouches[o].dragHandle){var n=this.currentDragTouches[o],a=this.clampPosition(t.x-n.dragHandle.offset.x,t.y-n.dragHandle.offset.y);t.x=a.x,t.y=a.y,c.instance.returnPoint(a),n.dragHandle instanceof p?this.dragCorner(t.x,t.y,n.dragHandle):this.dragCrop(t.x,t.y,n.dragHandle),this.currentlyInteracting=!0,e=!0,i.setPressed(this.canvas);break}if(!e){for(var s=0;this.markers.length>s;s++){var r=this.markers[s];if(r.touchInBounds(t.x,t.y)){t.dragHandle=r,this.currentDragTouches.push(t),r.setDrag(!0),t.dragHandle.offset.x=t.x-t.dragHandle.getPosition().x,t.dragHandle.offset.y=t.y-t.dragHandle.getPosition().y,this.dragCorner(t.x-t.dragHandle.offset.x,t.y-t.dragHandle.offset.y,t.dragHandle);break}}null==t.dragHandle&&this.center.touchInBounds(t.x,t.y)&&(t.dragHandle=this.center,this.currentDragTouches.push(t),t.dragHandle.setDrag(!0),t.dragHandle.offset.x=t.x-t.dragHandle.getPosition().x,t.dragHandle.offset.y=t.y-t.dragHandle.getPosition().y,this.dragCrop(t.x-t.dragHandle.offset.x,t.y-t.dragHandle.offset.y,t.dragHandle))}},e.prototype.updateClampBounds=function(){var t=this.srcImage.height/this.srcImage.width,e=this.canvas.height/this.canvas.width,i=this.canvas.width,o=this.canvas.height;e>t?(i=this.canvas.width,o=this.canvas.width*t):(o=this.canvas.height,i=this.canvas.height/t),this.minXClamp=this.canvas.width/2-i/2,this.minYClamp=this.canvas.height/2-o/2,this.maxXClamp=this.canvas.width/2+i/2,this.maxYClamp=this.canvas.height/2+o/2},e.prototype.getCropBounds=function(){var t=this.canvas.height-2*this.minYClamp,e=this.getBounds();return e.top=Math.round((t-e.top+this.minYClamp)/this.ratioH),e.bottom=Math.round((t-e.bottom+this.minYClamp)/this.ratioH),e.left=Math.round((e.left-this.minXClamp)/this.ratioW),e.right=Math.round((e.right-this.minXClamp)/this.ratioW),e},e.prototype.clampPosition=function(t,e){return this.minXClamp>t&&(t=this.minXClamp),t>this.maxXClamp&&(t=this.maxXClamp),this.minYClamp>e&&(e=this.minYClamp),e>this.maxYClamp&&(e=this.maxYClamp),c.instance.borrow(t,e)},e.prototype.isImageSet=function(){return this.imageSet},e.prototype.setImage=function(e){if(!e)throw"Image is null";this.imageSet=!0,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var i=this.buffer.getContext("2d");i.clearRect(0,0,this.buffer.width,this.buffer.height);var n=e.src.split("."),a=n[1];("png"==a||"jpg"==a)&&(this.fileType=a),this.srcImage=e,this.updateClampBounds();var s=this.srcImage.height/this.srcImage.width,r=this.getBounds(),l=r.getHeight()/r.getWidth(),u=this.canvas.width,d=this.canvas.height;this.canvasWidth=u,this.canvasHeight=d;var p=this.canvas.width/2,g=this.canvas.height/2,f=c.instance.borrow(p-r.getWidth()/2,g+r.getHeight()/2),m=c.instance.borrow(p+r.getWidth()/2,g+r.getHeight()/2),v=c.instance.borrow(p-r.getWidth()/2,g-r.getHeight()/2),w=c.instance.borrow(p+r.getWidth()/2,g-r.getHeight()/2);if(this.tl.setPosition(f.x,f.y),this.tr.setPosition(m.x,m.y),this.bl.setPosition(v.x,v.y),this.br.setPosition(w.x,w.y),c.instance.returnPoint(f),c.instance.returnPoint(m),c.instance.returnPoint(v),c.instance.returnPoint(w),this.center.setPosition(p,g),l>s){var _=Math.min(u*s,d),b=_/l;f=c.instance.borrow(p-b/2,g+_/2),m=c.instance.borrow(p+b/2,g+_/2),v=c.instance.borrow(p-b/2,g-_/2),w=c.instance.borrow(p+b/2,g-_/2)}else if(s>l){var y=Math.min(d/s,u),$=y*l;f=c.instance.borrow(p-y/2,g+$/2),m=c.instance.borrow(p+y/2,g+$/2),v=c.instance.borrow(p-y/2,g-$/2),w=c.instance.borrow(p+y/2,g-$/2)}else{var y=Math.min(d,u),$=y*l;f=c.instance.borrow(p-y/2,g+$/2),m=c.instance.borrow(p+y/2,g+$/2),v=c.instance.borrow(p-y/2,g-$/2),w=c.instance.borrow(p+y/2,g-$/2)}if(this.tl.setPosition(f.x,f.y),this.tr.setPosition(m.x,m.y),this.bl.setPosition(v.x,v.y),this.br.setPosition(w.x,w.y),c.instance.returnPoint(f),c.instance.returnPoint(m),c.instance.returnPoint(v),c.instance.returnPoint(w),t.cropAreaBounds&&void 0!==t.cropAreaBounds.left&&void 0!==t.cropAreaBounds.top&&void 0!==t.cropAreaBounds.right&&void 0!==t.cropAreaBounds.bottom){var k=this.canvasHeight/this.canvasWidth;k>s?(u=this.canvasWidth,d=this.canvasWidth*s):(d=this.canvasHeight,u=this.canvasHeight/s),this.ratioW=u/this.srcImage.width,this.ratioH=d/this.srcImage.height;var S=new h;S.top=Math.round(d+this.minYClamp-this.ratioH*t.cropAreaBounds.top),S.bottom=Math.round(d+this.minYClamp-this.ratioH*t.cropAreaBounds.bottom),S.left=Math.round(this.ratioW*t.cropAreaBounds.left+this.minXClamp),S.right=Math.round(this.ratioW*t.cropAreaBounds.right+this.minXClamp),this.tl.setPosition(S.left,S.top),this.tr.setPosition(S.right,S.top),this.bl.setPosition(S.left,S.bottom),this.br.setPosition(S.right,S.bottom),this.center.setPosition(S.left+S.getWidth()/2,S.top+S.getHeight()/2)}this.vertSquashRatio=this.detectVerticalSquash(this.srcImage),this.draw(this.ctx);var C=this.getCroppedImage(t.cropWidth,t.cropHeight);void 0!==o.croppedImage&&(t.croppedImage=C.src),t.cropAreaBounds&&this.imageSet&&(t.cropAreaBounds=this.getCropBounds())},e.prototype.getCroppedImage=function(t,e){var i=this.getBounds();if(!this.srcImage)throw"Source image not set.";if(t&&e){var o=this.srcImage.height/this.srcImage.width,n=this.canvas.height/this.canvas.width,a=this.canvas.width,s=this.canvas.height;n>o?(a=this.canvas.width,s=this.canvas.width*o):o>n?(s=this.canvas.height,a=this.canvas.height/o):(s=this.canvas.height,a=this.canvas.width),this.ratioW=a/this.srcImage.width,this.ratioH=s/this.srcImage.height,this.cropCanvas.width=t,this.cropCanvas.height=e;var r=(this.buffer.height-s)/2/this.ratioH,l=(this.buffer.width-a)/2/this.ratioW;this.drawImageIOSFix(this.cropCanvas.getContext("2d"),this.srcImage,Math.max(Math.round(i.left/this.ratioW-l),0),Math.max(Math.round(i.top/this.ratioH-r),0),Math.max(Math.round(i.getWidth()/this.ratioW),1),Math.max(Math.round(i.getHeight()/this.ratioH),1),0,0,t,e),this.croppedImage.width=t,this.croppedImage.height=e}else this.cropCanvas.width=Math.max(i.getWidth(),1),this.cropCanvas.height=Math.max(i.getHeight(),1),this.cropCanvas.getContext("2d").drawImage(this.buffer,i.left,i.top,Math.max(i.getWidth(),1),Math.max(i.getHeight(),1),0,0,i.getWidth(),i.getHeight()),this.croppedImage.width=this.cropCanvas.width,this.croppedImage.height=this.cropCanvas.height;return this.croppedImage.src=this.cropCanvas.toDataURL("image/"+this.fileType),this.croppedImage},e.prototype.getBounds=function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=-Number.MAX_VALUE,n=0;this.markers.length>n;n++){var a=this.markers[n];t>a.getPosition().x&&(t=a.getPosition().x),a.getPosition().x>i&&(i=a.getPosition().x),e>a.getPosition().y&&(e=a.getPosition().y),a.getPosition().y>o&&(o=a.getPosition().y)}var s=new h;return s.left=t,s.right=i,s.top=e,s.bottom=o,s},e.prototype.setBounds=function(t){for(var e,i,o,n,a=this.getBounds(),s=0;this.markers.length>s;s++){var r=this.markers[s];r.getPosition().x==a.left?r.getPosition().y==a.top?e=r:o=r:r.getPosition().y==a.top?i=r:n=r}e.setPosition(t.left,t.top),i.setPosition(t.right,t.top),o.setPosition(t.left,t.bottom),n.setPosition(t.right,t.bottom),this.center.recalculatePosition(t),this.center.draw(this.ctx)},e.prototype.getMousePos=function(t,e){var i=t.getBoundingClientRect();
return c.instance.borrow(e.clientX-i.left,e.clientY-i.top)},e.prototype.getTouchPos=function(t,e){var i=t.getBoundingClientRect();return c.instance.borrow(e.clientX-i.left,e.clientY-i.top)},e.prototype.onTouchMove=function(t){if(s.isImageSet()){if(t.preventDefault(),t.touches.length>=1)for(var e=0;t.touches.length>e;e++){var i=t.touches[e],o=this.getTouchPos(this.canvas,i),n=new f(o.x,o.y,i.identifier);c.instance.returnPoint(o),this.move(n,t)}this.draw(this.ctx)}},e.prototype.onMouseMove=function(t){if(s.isImageSet()){var e=this.getMousePos(this.canvas,t);this.move(new f(e.x,e.y,0),t);var i=this.getDragTouchForID(0);i?(i.x=e.x,i.y=e.y):i=new f(e.x,e.y,0),c.instance.returnPoint(e),this.drawCursors(i,t),this.draw(this.ctx)}},e.prototype.move=function(t){this.isMouseDown&&this.handleMove(t)},e.prototype.getDragTouchForID=function(t){for(var e=0;this.currentDragTouches.length>e;e++)if(t==this.currentDragTouches[e].id)return this.currentDragTouches[e]},e.prototype.drawCursors=function(t,e){var o=!1;null!=t&&(t.dragHandle==this.center&&(i.setStyle(this.canvas,"move"),o=!0),null!=t.dragHandle&&t.dragHandle instanceof p&&(this.drawCornerCursor(t.dragHandle,t.dragHandle.getPosition().x,t.dragHandle.getPosition().y,e),o=!0));var n=!1;if(!o){for(var a=0;this.markers.length>a;a++)n=n||this.drawCornerCursor(this.markers[a],t.x,t.y,e);n||i.setStyle(this.canvas,"initial")}n||o||!this.center.touchInBounds(t.x,t.y)?this.center.setOver(!1):(this.center.setOver(!0),i.setOver(this.canvas),i.setStyle(this.canvas,"move"))},e.prototype.drawCornerCursor=function(t,e,o){return t.touchInBounds(e,o)?(t.setOver(!0),t.getHorizontalNeighbour().getPosition().x>t.getPosition().x?t.getVerticalNeighbour().getPosition().y>t.getPosition().y?(i.setOver(this.canvas),i.setStyle(this.canvas,"nwse-resize")):(i.setOver(this.canvas),i.setStyle(this.canvas,"nesw-resize")):t.getVerticalNeighbour().getPosition().y>t.getPosition().y?(i.setOver(this.canvas),i.setStyle(this.canvas,"nesw-resize")):(i.setOver(this.canvas),i.setStyle(this.canvas,"nwse-resize")),!0):(t.setOver(!1),!1)},e.prototype.onTouchStart=function(){s.isImageSet()&&(this.isMouseDown=!0)},e.prototype.onTouchEnd=function(e){if(s.isImageSet()){for(var i=0;e.changedTouches.length>i;i++){var n=e.changedTouches[i],a=this.getDragTouchForID(n.identifier);null!=a&&((a.dragHandle instanceof p||a.dragHandle instanceof d)&&a.dragHandle.setOver(!1),this.handleRelease(a))}if(s.isImageSet()&&this.currentlyInteracting){var r=this.getCroppedImage(t.cropWidth,t.cropHeight);void 0!==o.croppedImage&&(t.croppedImage=r.src),t.$apply()}0==this.currentDragTouches.length&&(this.isMouseDown=!1,this.currentlyInteracting=!1)}},e.prototype.drawImageIOSFix=function(t,e,i,o,n,a,s,r,l,c){t.drawImage(e,i*this.vertSquashRatio,o*this.vertSquashRatio,n*this.vertSquashRatio,a*this.vertSquashRatio,s,r,l,c)},e.prototype.detectVerticalSquash=function(t){var e=(t.naturalWidth,t.naturalHeight),i=document.createElement("canvas");i.width=1,i.height=e;var o=i.getContext("2d");o.drawImage(t,0,0);for(var n=o.getImageData(0,0,1,e).data,a=0,s=e,r=e;r>a;){var l=n[4*(r-1)+3];0===l?s=r:a=r,r=s+a>>1}var c=r/e;return 0===c?1:c},e.prototype.onMouseDown=function(){s.isImageSet()&&(this.isMouseDown=!0)},e.prototype.onMouseUp=function(){if(s.isImageSet()){if(i.setReleased(this.canvas),this.isMouseDown=!1,this.handleRelease(new f(0,0,0)),1==this.currentlyInteracting){var e=this.getCroppedImage(t.cropWidth,t.cropHeight);void 0!==o.croppedImage&&(t.croppedImage=e.src),t.$apply()}this.currentlyInteracting=!1}},e}();t.$watch("cropWidth",n),t.$watch("cropHeight",n),t.$watch("keepAspect",n),t.$watch("touchRadius",n),t.$watch("image",a)}}}]),angular.module("angular-img-cropper").directive("imgCropperFileread",["$timeout",function(t){return{scope:{image:"="},link:function(e,i){i.bind("change",function(i){var o=new FileReader;o.onload=function(i){t(function(){e.image=i.target.result},0)},i.target.files[0]&&o.readAsDataURL(i.target.files[0])})}}}]),angular.module("angular-img-cropper").directive("imgCropperFilereadCall",function(){return{scope:{control:"="},link:function(t){t.internalControl=t.control||{},t.internalControl.load=function(t){var e=angular.element(document.querySelector(t)),i=document.createEvent("MouseEvent");i.initEvent("click",!0,!1),e[0].dispatchEvent(i)}}}}),angular.module("angular-img-cropper").factory("imageCropperDataShare",function(){var t,e,i={};return i.setPressed=function(e){t=e},i.setReleased=function(e){e===t&&(t=void 0)},i.setOver=function(t){e=t},i.setStyle=function(i,o){void 0!==t?t===i&&angular.element(document.documentElement).css("cursor",o):i===e&&angular.element(document.documentElement).css("cursor",o)},i});